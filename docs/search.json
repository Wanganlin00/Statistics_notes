[
  {
    "objectID": "repeated_measures_ANOVA.html",
    "href": "repeated_measures_ANOVA.html",
    "title": "\n12  重复测量方差分析\n",
    "section": "",
    "text": "12.1 假设",
    "crumbs": [
      "统计推断",
      "<span class='chapter-number'>12</span>  <span class='chapter-title'>重复测量方差分析</span>"
    ]
  },
  {
    "objectID": "repeated_measures_ANOVA.html#假设",
    "href": "repeated_measures_ANOVA.html#假设",
    "title": "\n12  重复测量方差分析\n",
    "section": "",
    "text": "独立性，即不同受试者之间的观测值是独立的。\n正态性，观测值在每个时间点或条件下的正态分布。\n各组内的方差齐性（sphericity），即组内相关性结构是已知的，通常假设为复合对称（compound symmetry）。协方差矩阵的球形检验（W=1）\n\n\n\n\n\n\n\nNote\n\n\n\n\n复合对称假设：RM-ANOVA假设误差项具有复合对称性，即组内相关性和方差齐性。如果复合对称假设不成立，结果可能不准确，可以使用更为灵活的线性混合模型（LMM）或广义估计方程（GEE）进行分析。\n检验方法：RM-ANOVA的主要检验方法包括F检验，用于检验组效应、时间效应和交互作用是否显著。",
    "crumbs": [
      "统计推断",
      "<span class='chapter-number'>12</span>  <span class='chapter-title'>重复测量方差分析</span>"
    ]
  },
  {
    "objectID": "repeated_measures_ANOVA.html#单因素重复测量方差分析",
    "href": "repeated_measures_ANOVA.html#单因素重复测量方差分析",
    "title": "\n12  重复测量方差分析\n",
    "section": "\n12.2 单因素重复测量方差分析",
    "text": "12.2 单因素重复测量方差分析\n\n12.2.1 公式\n\\[\nSS_T=\\sum_{j=1}^{t}\\sum_{i=1}^{n}X_{ij}^2-\\frac{(\\sum_{j=1}^{t}\\sum_{i=1}^{n}X_{ij})^2}{nt}=SS_{受试者间}+SS_{不同时间点}+SS_{E\\ \\ 随机误差}，\\nu_T=nt-1\n\\]\n\\[\nSS_{受试者间}=\\frac{\\sum_{i}(\\sum_{j}X_{ij})^2}{t}-C，\\nu_{受试者}=n-1\n\\]反映了在受试者间的变异。\n\\[\nSS_{不同时间点}=\\frac{\\sum_{j}(\\sum_{i}X_{ij})^2}{n}-C ，\\nu_{时间点}=t-1\n\\]反映了在每个受试者内不同时间点的重复测量变异。\n\\[\nSS_E=SS_T-SS_{受试者间}-SS_{不同时间点}，\\nu_E=(n-1)(t-1)\n\\]\n\\(H_0:\\mu_1=\\mu_2=...=\\mu_t\\)，检验统计量\n\\[\nF=\\frac{MS_{不同时间点}}{MS_E}=\\frac{SS_{不同时间点}/(t-1)}{SS_E/((n-1)(t-1))}\n\\]\n\nShow the codeALT &lt;- tribble(\n    ~id,~zero,~ten,~twenty,~thirty,\n    1,186,122,134,110,\n    2,345,312,268,176,\n    3,98,84,52,61,\n    4,288,98,91,85,\n    5,176,86,130,99,\n    6,210,188,143,120,\n    7,271,322,86,65,\n    8,415,332,265,186,\n    9,171,126,130,135,\n    10,243,330,95,64,\n)\nALT_long &lt;-\n    ALT |&gt; pivot_longer(cols = -1,\n                       names_to = \"week\",\n                       values_to = \"ALT\") |&gt; \n    mutate(week = factor(week, levels = c(\"zero\",\"ten\", \"twenty\", \"thirty\")))\n\n\n# 假设检验\nALT_long %&gt;% \n    group_by(week) %&gt;% \n    rstatix::shapiro_test(ALT)\n#&gt; # A tibble: 4 × 4\n#&gt;   week   variable statistic      p\n#&gt;   &lt;fct&gt;  &lt;chr&gt;        &lt;dbl&gt;  &lt;dbl&gt;\n#&gt; 1 zero   ALT          0.972 0.906 \n#&gt; 2 ten    ALT          0.796 0.0131\n#&gt; 3 twenty ALT          0.834 0.0378\n#&gt; 4 thirty ALT          0.907 0.262\n\n\n\nShow the code# 总变异\nxij_sum &lt;- sum(ALT_long$ALT)\nxij_square_sum &lt;- sum(ALT_long$ALT^2)\nC &lt;- xij_sum^2/40\nSS_T &lt;- xij_square_sum-C\n\n# 受试者间  \nxi._sum &lt;- rowSums(ALT[,-1])\nxi._sum\n#&gt;  [1]  552 1101  295  562  491  661  744 1198  562  732\nSS_B &lt;- sum(xi._sum^2)/4-C #行和平方和\nMS_B &lt;- SS_B/9\n\n# 不同时间点\nx.j_sum &lt;- colSums(ALT[,-1])\nx.j_sum\n#&gt;   zero    ten twenty thirty \n#&gt;   2403   2000   1394   1101\nSS_W &lt;- sum(x.j_sum^2)/10-C #列和平方和\nMS_W &lt;- SS_W/3\n\n\n\nSS_E &lt;- SS_T-SS_B-SS_W\nMS_E &lt;- SS_E/(9*3)\n\nF_stat &lt;- MS_W/MS_E\nF_stat\n#&gt; [1] 11.13855\n\nv1 = 4-1\nv2 = (4-1)*(10-1)\n\npf(F_stat, df1 = v1, df2 = v2, lower.tail = F)\n#&gt; [1] 6.170758e-05\n\ncat(\"F统计量：\", F_stat, \"\\n\",\n    \"p值：\",pf(F_stat, df1 = v1, df2 = v2, lower.tail = F))\n#&gt; F统计量： 11.13855 \n#&gt;  p值： 6.170758e-05\n\n\n\n12.2.2 nlme::lme()\n\n\nShow the codelibrary(nlme)\nALT_lme &lt;- lme(fixed=ALT ~ week, random = ~1| id/week, data = ALT_long)\n\nALT_aov &lt;- anova.lme(ALT_lme)\nALT_aov \n#&gt;             numDF denDF  F-value p-value\n#&gt; (Intercept)     1    27 62.98194  &lt;.0001\n#&gt; week            3    27 11.13855   1e-04\nALT_aov$`p-value`\n#&gt; [1] 1.569667e-08 6.170758e-05\n\n\n事后检验\n\nShow the code#成对比较\nlibrary(emmeans)\nemmeans(ALT_lme, pairwise ~week, adjust = \"bonferroni\") \n#&gt; $emmeans\n#&gt;  week   emmean   SE df lower.CL upper.CL\n#&gt;  zero      240 26.5  9    180.3      300\n#&gt;  ten       200 26.5  9    140.0      260\n#&gt;  twenty    139 26.5  9     79.4      199\n#&gt;  thirty    110 26.5  9     50.1      170\n#&gt; \n#&gt; Degrees-of-freedom method: containment \n#&gt; Confidence level used: 0.95 \n#&gt; \n#&gt; $contrasts\n#&gt;  contrast        estimate   SE df t.ratio p.value\n#&gt;  zero - ten          40.3 24.9 27   1.620  0.7014\n#&gt;  zero - twenty      100.9 24.9 27   4.055  0.0023\n#&gt;  zero - thirty      130.2 24.9 27   5.233  0.0001\n#&gt;  ten - twenty        60.6 24.9 27   2.436  0.1305\n#&gt;  ten - thirty        89.9 24.9 27   3.613  0.0073\n#&gt;  twenty - thirty     29.3 24.9 27   1.178  1.0000\n#&gt; \n#&gt; Degrees-of-freedom method: containment \n#&gt; P value adjustment: bonferroni method for 6 tests\nemmeans(ALT_lme,  ~week) %&gt;% pairs(., adjust = \"bonferroni\")\n#&gt;  contrast        estimate   SE df t.ratio p.value\n#&gt;  zero - ten          40.3 24.9 27   1.620  0.7014\n#&gt;  zero - twenty      100.9 24.9 27   4.055  0.0023\n#&gt;  zero - thirty      130.2 24.9 27   5.233  0.0001\n#&gt;  ten - twenty        60.6 24.9 27   2.436  0.1305\n#&gt;  ten - thirty        89.9 24.9 27   3.613  0.0073\n#&gt;  twenty - thirty     29.3 24.9 27   1.178  1.0000\n#&gt; \n#&gt; Degrees-of-freedom method: containment \n#&gt; P value adjustment: bonferroni method for 6 tests\n\n\n\nShow the codelibrary(multcomp)\nALT_posthoc &lt;-glht(ALT_lme, linfct = mcp(week =c(\"zero - ten = 0 \",\n                                               \"twenty - zero == 0\",\n                                               \"thirty - zero = 0 \")))\nsummary(ALT_posthoc) %&gt;% broom::tidy()\n#&gt; # A tibble: 3 × 7\n#&gt;   term  contrast      null.value estimate std.error statistic adj.p.value\n#&gt;   &lt;chr&gt; &lt;chr&gt;              &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;       &lt;dbl&gt;\n#&gt; 1 week  zero - ten             0     40.3      24.9      1.62 0.248      \n#&gt; 2 week  twenty - zero          0   -101.       24.9     -4.06 0.000173   \n#&gt; 3 week  thirty - zero          0   -130.       24.9     -5.23 0.000000324",
    "crumbs": [
      "统计推断",
      "<span class='chapter-number'>12</span>  <span class='chapter-title'>重复测量方差分析</span>"
    ]
  },
  {
    "objectID": "repeated_measures_ANOVA.html#含组间因子的重复测量方差分析",
    "href": "repeated_measures_ANOVA.html#含组间因子的重复测量方差分析",
    "title": "\n12  重复测量方差分析\n",
    "section": "\n12.3 含组间因子的重复测量方差分析",
    "text": "12.3 含组间因子的重复测量方差分析\n\n12.3.1 公式\n\\[\n\\begin{aligned}\nSS_总&= SS_{受试对象间}+SS_{受试对象内}  \\\\\n&=（SS_{处理方法}+SS_{个体间差异}）+（SS_{时间}+SS_{处理与时间交互}+SS_{个体内差异}）\n\\end{aligned}\n\\]\nhttps://personality-project.org/r/r.guide/r.anova.html#oneway\n\n12.3.2 案例\n孙振球（医学统计学第四版 人卫版，例12-3，P193）\n\nShow the code# 医学统计学 人卫版 第7版\nSBP &lt;- read_delim(\"data/麻醉诱导时相.txt\")\nSBP\n#&gt; # A tibble: 15 × 7\n#&gt;       id group    t0    t1    t2    t3    t4\n#&gt;    &lt;dbl&gt; &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;\n#&gt;  1     1 A       120   108   112   120   117\n#&gt;  2     2 A       118   109   115   126   123\n#&gt;  3     3 A       119   112   119   124   118\n#&gt;  4     4 A       121   112   119   126   120\n#&gt;  5     5 A       127   121   127   133   126\n#&gt;  6     6 B       121   120   118   131   137\n#&gt;  7     7 B       122   121   119   129   133\n#&gt;  8     8 B       128   129   126   135   142\n#&gt;  9     9 B       117   115   111   123   131\n#&gt; 10    10 B       118   114   116   123   133\n#&gt; 11    11 C       131   119   118   135   129\n#&gt; 12    12 C       129   128   121   148   132\n#&gt; 13    13 C       123   123   120   143   136\n#&gt; 14    14 C       123   121   116   145   126\n#&gt; 15    15 C       125   124   118   142   130\n\n\n\nShow the codeSBP_long &lt;- SBP |&gt; pivot_longer(cols = starts_with(\"t\"),\n                              names_to = \"time\",\n                              values_to = \"SBP\") |&gt; \n    mutate(\n        id=factor(id),\n        group=factor(group),\n        time=factor(time)\n    )\n\nSBP_long %&gt;% head()\n#&gt; # A tibble: 6 × 4\n#&gt;   id    group time    SBP\n#&gt;   &lt;fct&gt; &lt;fct&gt; &lt;fct&gt; &lt;dbl&gt;\n#&gt; 1 1     A     t0      120\n#&gt; 2 1     A     t1      108\n#&gt; 3 1     A     t2      112\n#&gt; 4 1     A     t3      120\n#&gt; 5 1     A     t4      117\n#&gt; 6 2     A     t0      118\n\n\n\nShow the code# 正态性检验\nlibrary(rstatix)\nSBP_long %&gt;% group_by(time,group) %&gt;% \n    shapiro_test(SBP)\n#&gt; # A tibble: 15 × 5\n#&gt;    group time  variable statistic     p\n#&gt;    &lt;fct&gt; &lt;fct&gt; &lt;chr&gt;        &lt;dbl&gt; &lt;dbl&gt;\n#&gt;  1 A     t0    SBP          0.836 0.154\n#&gt;  2 B     t0    SBP          0.916 0.503\n#&gt;  3 C     t0    SBP          0.867 0.254\n#&gt;  4 A     t1    SBP          0.834 0.148\n#&gt;  5 B     t1    SBP          0.913 0.485\n#&gt;  6 C     t1    SBP          0.978 0.921\n#&gt;  7 A     t2    SBP          0.940 0.666\n#&gt;  8 B     t2    SBP          0.969 0.869\n#&gt;  9 C     t2    SBP          0.953 0.758\n#&gt; 10 A     t3    SBP          0.937 0.647\n#&gt; 11 B     t3    SBP          0.902 0.421\n#&gt; 12 C     t3    SBP          0.941 0.672\n#&gt; 13 A     t4    SBP          0.943 0.687\n#&gt; 14 B     t4    SBP          0.892 0.367\n#&gt; 15 C     t4    SBP          0.984 0.955\n\n\n\n12.3.2.1 nlme::lme()\n\n\nShow the code# 第一种方法\nlibrary(nlme)\nSBP_lme &lt;- lme(SBP ~ group*time, random = ~ 1 |id/time, data = SBP_long)\n# summary(SBP_lme)\nanova(SBP_lme)\n#&gt;             numDF denDF   F-value p-value\n#&gt; (Intercept)     1    48 14649.223  &lt;.0001\n#&gt; group           2    12     5.783  0.0174\n#&gt; time            4    48   106.558  &lt;.0001\n#&gt; group:time      8    48    19.101  &lt;.0001\n# 看不到球形检验\n\n\n# 事后检验 成对比较\nlibrary(emmeans)\n# 如果交互效应不显著\n\n## 时间点事后检验\nSBP_long %&gt;%\n  pairwise_t_test(SBP ~ time, p.adjust.method = \"none\", detailed = TRUE)\n#&gt; # A tibble: 10 × 10\n#&gt;    .y.   group1 group2    n1    n2        p method   p.adj p.signif p.adj.signif\n#&gt;  * &lt;chr&gt; &lt;chr&gt;  &lt;chr&gt;  &lt;int&gt; &lt;int&gt;    &lt;dbl&gt; &lt;chr&gt;    &lt;dbl&gt; &lt;chr&gt;    &lt;chr&gt;       \n#&gt;  1 SBP   t0     t1        15    15  6.81e-2 T-test 6.81e-2 ns       ns          \n#&gt;  2 SBP   t0     t2        15    15  6.41e-2 T-test 6.41e-2 ns       ns          \n#&gt;  3 SBP   t1     t2        15    15  9.78e-1 T-test 9.78e-1 ns       ns          \n#&gt;  4 SBP   t0     t3        15    15  1.78e-4 T-test 1.78e-4 ***      ***         \n#&gt;  5 SBP   t1     t3        15    15  1.67e-7 T-test 1.67e-7 ****     ****        \n#&gt;  6 SBP   t2     t3        15    15  1.49e-7 T-test 1.49e-7 ****     ****        \n#&gt;  7 SBP   t0     t4        15    15  1.28e-2 T-test 1.28e-2 *        *           \n#&gt;  8 SBP   t1     t4        15    15  3.68e-5 T-test 3.68e-5 ****     ****        \n#&gt;  9 SBP   t2     t4        15    15  3.32e-5 T-test 3.32e-5 ****     ****        \n#&gt; 10 SBP   t3     t4        15    15  1.65e-1 T-test 1.65e-1 ns       ns\n\nemmeans(SBP_lme,pairwise ~time, adjust = \"none\")  \n#&gt; $emmeans\n#&gt;  time emmean   SE df lower.CL upper.CL\n#&gt;  t0      123 1.16 12      120      125\n#&gt;  t1      118 1.16 12      116      121\n#&gt;  t2      118 1.16 12      116      121\n#&gt;  t3      132 1.16 12      130      135\n#&gt;  t4      129 1.16 12      126      131\n#&gt; \n#&gt; Results are averaged over the levels of: group \n#&gt; Degrees-of-freedom method: containment \n#&gt; Confidence level used: 0.95 \n#&gt; \n#&gt; $contrasts\n#&gt;  contrast estimate    SE df t.ratio p.value\n#&gt;  t0 - t1    4.4000 0.855 48   5.147  &lt;.0001\n#&gt;  t0 - t2    4.4667 0.855 48   5.225  &lt;.0001\n#&gt;  t0 - t3   -9.4000 0.855 48 -10.995  &lt;.0001\n#&gt;  t0 - t4   -6.0667 0.855 48  -7.096  &lt;.0001\n#&gt;  t1 - t2    0.0667 0.855 48   0.078  0.9382\n#&gt;  t1 - t3  -13.8000 0.855 48 -16.142  &lt;.0001\n#&gt;  t1 - t4  -10.4667 0.855 48 -12.243  &lt;.0001\n#&gt;  t2 - t3  -13.8667 0.855 48 -16.220  &lt;.0001\n#&gt;  t2 - t4  -10.5333 0.855 48 -12.321  &lt;.0001\n#&gt;  t3 - t4    3.3333 0.855 48   3.899  0.0003\n#&gt; \n#&gt; Results are averaged over the levels of: group \n#&gt; Degrees-of-freedom method: containment\n\n## 组间事后检验\nemmeans(SBP_lme,pairwise ~group, adjust = \"none\")  # 与spss一样\n#&gt; $emmeans\n#&gt;  group emmean   SE df lower.CL upper.CL\n#&gt;  A        120 1.78 14      116      123\n#&gt;  B        124 1.78 12      121      128\n#&gt;  C        128 1.78 12      124      132\n#&gt; \n#&gt; Results are averaged over the levels of: time \n#&gt; Degrees-of-freedom method: containment \n#&gt; Confidence level used: 0.95 \n#&gt; \n#&gt; $contrasts\n#&gt;  contrast estimate   SE df t.ratio p.value\n#&gt;  A - B       -4.80 2.51 12  -1.911  0.0802\n#&gt;  A - C       -8.52 2.51 12  -3.392  0.0054\n#&gt;  B - C       -3.72 2.51 12  -1.481  0.1644\n#&gt; \n#&gt; Results are averaged over the levels of: time \n#&gt; Degrees-of-freedom method: containment\n\n# 此处交互效应显著\n# 1. 简单组别效应 与SPSS一样\nSBP_long %&gt;% group_by(time) %&gt;% anova_test(SBP~group)\n#&gt; # A tibble: 5 × 8\n#&gt;   time  Effect   DFn   DFd      F        p `p&lt;.05`   ges\n#&gt; * &lt;fct&gt; &lt;chr&gt;  &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;    &lt;dbl&gt; &lt;chr&gt;   &lt;dbl&gt;\n#&gt; 1 t0    group      2    12  2.93  0.092    \"\"      0.328\n#&gt; 2 t1    group      2    12  6.03  0.015    \"*\"     0.501\n#&gt; 3 t2    group      2    12  0.022 0.979    \"\"      0.004\n#&gt; 4 t3    group      2    12 17.0   0.000312 \"*\"     0.74 \n#&gt; 5 t4    group      2    12 17.4   0.000286 \"*\"     0.743\n\n# 2. 各时间点处理组成对比较  用的是未调整的p值，无法观察到标准误\nSBP_long %&gt;%\n  group_by(time) %&gt;%\n  pairwise_t_test(SBP ~ group, \n                  p.adjust.method = \"bonferroni\", detailed = TRUE)\n#&gt; # A tibble: 15 × 11\n#&gt;    time  .y.   group1 group2    n1    n2         p method    p.adj p.signif\n#&gt;  * &lt;fct&gt; &lt;chr&gt; &lt;chr&gt;  &lt;chr&gt;  &lt;int&gt; &lt;int&gt;     &lt;dbl&gt; &lt;chr&gt;     &lt;dbl&gt; &lt;chr&gt;   \n#&gt;  1 t0    SBP   A      B          5     5 0.936     T-test 1        ns      \n#&gt;  2 t0    SBP   A      C          5     5 0.0539    T-test 0.162    ns      \n#&gt;  3 t0    SBP   B      C          5     5 0.0623    T-test 0.187    ns      \n#&gt;  4 t1    SBP   A      B          5     5 0.0358    T-test 0.107    *       \n#&gt;  5 t1    SBP   A      C          5     5 0.00541   T-test 0.0162   **      \n#&gt;  6 t1    SBP   B      C          5     5 0.327     T-test 0.981    ns      \n#&gt;  7 t2    SBP   A      B          5     5 0.894     T-test 1        ns      \n#&gt;  8 t2    SBP   A      C          5     5 0.947     T-test 1        ns      \n#&gt;  9 t2    SBP   B      C          5     5 0.842     T-test 1        ns      \n#&gt; 10 t3    SBP   A      B          5     5 0.456     T-test 1        ns      \n#&gt; 11 t3    SBP   A      C          5     5 0.000161  T-test 0.000483 ***     \n#&gt; 12 t3    SBP   B      C          5     5 0.000585  T-test 0.00175  ***     \n#&gt; 13 t4    SBP   A      B          5     5 0.0000887 T-test 0.000266 ****    \n#&gt; 14 t4    SBP   A      C          5     5 0.00201   T-test 0.00602  **      \n#&gt; 15 t4    SBP   B      C          5     5 0.0901    T-test 0.27     ns      \n#&gt; # ℹ 1 more variable: p.adj.signif &lt;chr&gt;\n\n\n\n12.3.2.2 rstatix::anova_test() 看球形检验 W统计量\n\nShow the codelibrary(rstatix)\naov_SBP &lt;- anova_test(data = SBP_long,\n           dv = SBP,\n           wid = id,\n           within = time,\n           between = group,\n           type = \"3\"\n           )\n\naov_SBP\n#&gt; ANOVA Table (type III tests)\n#&gt; \n#&gt; $ANOVA\n#&gt;       Effect DFn DFd       F        p p&lt;.05   ges\n#&gt; 1      group   2  12   5.783 1.70e-02     * 0.430\n#&gt; 2       time   4  48 106.558 3.02e-23     * 0.659\n#&gt; 3 group:time   8  48  19.101 1.62e-12     * 0.409\n#&gt; \n#&gt; $`Mauchly's Test for Sphericity`\n#&gt;       Effect     W     p p&lt;.05\n#&gt; 1       time 0.293 0.178      \n#&gt; 2 group:time 0.293 0.178      \n#&gt; \n#&gt; $`Sphericity Corrections`\n#&gt;       Effect   GGe      DF[GG]    p[GG] p[GG]&lt;.05   HFe      DF[HF]    p[HF]\n#&gt; 1       time 0.679 2.71, 32.58 1.87e-16         * 0.896 3.59, 43.03 4.65e-21\n#&gt; 2 group:time 0.679 5.43, 32.58 4.26e-09         * 0.896 7.17, 43.03 2.04e-11\n#&gt;   p[HF]&lt;.05\n#&gt; 1         *\n#&gt; 2         *\n\n# 进行事后检验，若交互效应不显著\n\nSBP_long %&gt;%\n  group_by(time) %&gt;%\n  pairwise_t_test(SBP ~ group, p.adjust.method = \"bonferroni\", detailed = TRUE)\n#&gt; # A tibble: 15 × 11\n#&gt;    time  .y.   group1 group2    n1    n2         p method    p.adj p.signif\n#&gt;  * &lt;fct&gt; &lt;chr&gt; &lt;chr&gt;  &lt;chr&gt;  &lt;int&gt; &lt;int&gt;     &lt;dbl&gt; &lt;chr&gt;     &lt;dbl&gt; &lt;chr&gt;   \n#&gt;  1 t0    SBP   A      B          5     5 0.936     T-test 1        ns      \n#&gt;  2 t0    SBP   A      C          5     5 0.0539    T-test 0.162    ns      \n#&gt;  3 t0    SBP   B      C          5     5 0.0623    T-test 0.187    ns      \n#&gt;  4 t1    SBP   A      B          5     5 0.0358    T-test 0.107    *       \n#&gt;  5 t1    SBP   A      C          5     5 0.00541   T-test 0.0162   **      \n#&gt;  6 t1    SBP   B      C          5     5 0.327     T-test 0.981    ns      \n#&gt;  7 t2    SBP   A      B          5     5 0.894     T-test 1        ns      \n#&gt;  8 t2    SBP   A      C          5     5 0.947     T-test 1        ns      \n#&gt;  9 t2    SBP   B      C          5     5 0.842     T-test 1        ns      \n#&gt; 10 t3    SBP   A      B          5     5 0.456     T-test 1        ns      \n#&gt; 11 t3    SBP   A      C          5     5 0.000161  T-test 0.000483 ***     \n#&gt; 12 t3    SBP   B      C          5     5 0.000585  T-test 0.00175  ***     \n#&gt; 13 t4    SBP   A      B          5     5 0.0000887 T-test 0.000266 ****    \n#&gt; 14 t4    SBP   A      C          5     5 0.00201   T-test 0.00602  **      \n#&gt; 15 t4    SBP   B      C          5     5 0.0901    T-test 0.27     ns      \n#&gt; # ℹ 1 more variable: p.adj.signif &lt;chr&gt;\n\n\n\n12.3.2.3 afex::aov_*()看各时间点处理组成对比较和各处理组时间点成对比较\nhttps://cran.r-project.org/web/packages/afex/vignettes/afex_anova_example.html\n\nShow the codelibrary(\"afex\")     # needed for ANOVA functions.\nlibrary(\"emmeans\")  # emmeans must now be loaded explicitly for follow-up tests.\nlibrary(\"multcomp\") # for advanced control for multiple testing/Type 1 errors.\nlibrary(\"ggplot2\")  # for customizing plots.\n\n\n\nSBP_aovez &lt;- aov_ez(\"id\", \"SBP\", SBP_long, between =\"group\" , \n       within = c(\"time\"))\nSBP_aovez\n#&gt; Anova Table (Type 3 tests)\n#&gt; \n#&gt; Response: SBP\n#&gt;       Effect          df   MSE          F  ges p.value\n#&gt; 1      group       2, 12 78.87     5.78 * .430    .017\n#&gt; 2       time 2.71, 32.58  8.08 106.56 *** .659   &lt;.001\n#&gt; 3 group:time 5.43, 32.58  8.08  19.10 *** .409   &lt;.001\n#&gt; ---\n#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '+' 0.1 ' ' 1\n#&gt; \n#&gt; Sphericity correction method: GG\n\nSBP_aovez %&gt;% summary()\n#&gt; \n#&gt; Univariate Type III Repeated-Measures ANOVA Assuming Sphericity\n#&gt; \n#&gt;              Sum Sq num Df Error SS den Df    F value    Pr(&gt;F)    \n#&gt; (Intercept) 1155433      1   946.48     12 14649.2234 &lt; 2.2e-16 ***\n#&gt; group           912      2   946.48     12     5.7829   0.01743 *  \n#&gt; time           2336      4   263.12     48   106.5576 &lt; 2.2e-16 ***\n#&gt; group:time      838      8   263.12     48    19.1006 1.621e-12 ***\n#&gt; ---\n#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n#&gt; \n#&gt; \n#&gt; Mauchly Tests for Sphericity\n#&gt; \n#&gt;            Test statistic p-value\n#&gt; time              0.29307 0.17766\n#&gt; group:time        0.29307 0.17766\n#&gt; \n#&gt; \n#&gt; Greenhouse-Geisser and Huynh-Feldt Corrections\n#&gt;  for Departure from Sphericity\n#&gt; \n#&gt;             GG eps Pr(&gt;F[GG])    \n#&gt; time       0.67869  &lt; 2.2e-16 ***\n#&gt; group:time 0.67869  4.263e-09 ***\n#&gt; ---\n#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n#&gt; \n#&gt;              HF eps   Pr(&gt;F[HF])\n#&gt; time       0.896371 4.649080e-21\n#&gt; group:time 0.896371 2.041727e-11\n\n# aov_car(SBP ~ group + Error(id/time), data = SBP_long)\n# aov_4(SBP ~ group + (time|id), data = SBP_long)\n\n\n# 事后检验 不调整与SPSS一样\n\n## 看各时间点处理组成对比较\nemmeans::emmeans(SBP_aovez , pairwise ~ group|time, adjust = \"none\")\n#&gt; $emmeans\n#&gt; time = t0:\n#&gt;  group emmean   SE df lower.CL upper.CL\n#&gt;  A        121 1.72 12      117      125\n#&gt;  B        121 1.72 12      117      125\n#&gt;  C        126 1.72 12      122      130\n#&gt; \n#&gt; time = t1:\n#&gt;  group emmean   SE df lower.CL upper.CL\n#&gt;  A        112 2.21 12      108      117\n#&gt;  B        120 2.21 12      115      125\n#&gt;  C        123 2.21 12      118      128\n#&gt; \n#&gt; time = t2:\n#&gt;  group emmean   SE df lower.CL upper.CL\n#&gt;  A        118 2.08 12      114      123\n#&gt;  B        118 2.08 12      113      123\n#&gt;  C        119 2.08 12      114      123\n#&gt; \n#&gt; time = t3:\n#&gt;  group emmean   SE df lower.CL upper.CL\n#&gt;  A        126 2.20 12      121      131\n#&gt;  B        128 2.20 12      123      133\n#&gt;  C        143 2.20 12      138      147\n#&gt; \n#&gt; time = t4:\n#&gt;  group emmean   SE df lower.CL upper.CL\n#&gt;  A        121 1.76 12      117      125\n#&gt;  B        135 1.76 12      131      139\n#&gt;  C        131 1.76 12      127      134\n#&gt; \n#&gt; Confidence level used: 0.95 \n#&gt; \n#&gt; $contrasts\n#&gt; time = t0:\n#&gt;  contrast estimate   SE df t.ratio p.value\n#&gt;  A - B        -0.2 2.43 12  -0.082  0.9358\n#&gt;  A - C        -5.2 2.43 12  -2.137  0.0539\n#&gt;  B - C        -5.0 2.43 12  -2.055  0.0623\n#&gt; \n#&gt; time = t1:\n#&gt;  contrast estimate   SE df t.ratio p.value\n#&gt;  A - B        -7.4 3.13 12  -2.364  0.0358\n#&gt;  A - C       -10.6 3.13 12  -3.386  0.0054\n#&gt;  B - C        -3.2 3.13 12  -1.022  0.3269\n#&gt; \n#&gt; time = t2:\n#&gt;  contrast estimate   SE df t.ratio p.value\n#&gt;  A - B         0.4 2.95 12   0.136  0.8943\n#&gt;  A - C        -0.2 2.95 12  -0.068  0.9470\n#&gt;  B - C        -0.6 2.95 12  -0.204  0.8420\n#&gt; \n#&gt; time = t3:\n#&gt;  contrast estimate   SE df t.ratio p.value\n#&gt;  A - B        -2.4 3.11 12  -0.771  0.4557\n#&gt;  A - C       -16.8 3.11 12  -5.396  0.0002\n#&gt;  B - C       -14.4 3.11 12  -4.625  0.0006\n#&gt; \n#&gt; time = t4:\n#&gt;  contrast estimate   SE df t.ratio p.value\n#&gt;  A - B       -14.4 2.50 12  -5.771  0.0001\n#&gt;  A - C        -9.8 2.50 12  -3.927  0.0020\n#&gt;  B - C         4.6 2.50 12   1.843  0.0901\n\n## 看各处理组时间点成对比较\nemmeans::emmeans(SBP_aovez , pairwise ~ time| group, adjust = \"none\")\n#&gt; $emmeans\n#&gt; group = A:\n#&gt;  time emmean   SE df lower.CL upper.CL\n#&gt;  t0      121 1.72 12      117      125\n#&gt;  t1      112 2.21 12      108      117\n#&gt;  t2      118 2.08 12      114      123\n#&gt;  t3      126 2.20 12      121      131\n#&gt;  t4      121 1.76 12      117      125\n#&gt; \n#&gt; group = B:\n#&gt;  time emmean   SE df lower.CL upper.CL\n#&gt;  t0      121 1.72 12      117      125\n#&gt;  t1      120 2.21 12      115      125\n#&gt;  t2      118 2.08 12      113      123\n#&gt;  t3      128 2.20 12      123      133\n#&gt;  t4      135 1.76 12      131      139\n#&gt; \n#&gt; group = C:\n#&gt;  time emmean   SE df lower.CL upper.CL\n#&gt;  t0      126 1.72 12      122      130\n#&gt;  t1      123 2.21 12      118      128\n#&gt;  t2      119 2.08 12      114      123\n#&gt;  t3      143 2.20 12      138      147\n#&gt;  t4      131 1.76 12      127      134\n#&gt; \n#&gt; Confidence level used: 0.95 \n#&gt; \n#&gt; $contrasts\n#&gt; group = A:\n#&gt;  contrast estimate    SE df t.ratio p.value\n#&gt;  t0 - t1       8.6 1.490 12   5.772  0.0001\n#&gt;  t0 - t2       2.6 1.324 12   1.964  0.0732\n#&gt;  t0 - t3      -4.8 2.058 12  -2.333  0.0379\n#&gt;  t0 - t4       0.2 1.683 12   0.119  0.9074\n#&gt;  t1 - t2      -6.0 0.913 12  -6.573  &lt;.0001\n#&gt;  t1 - t3     -13.4 1.061 12 -12.624  &lt;.0001\n#&gt;  t1 - t4      -8.4 1.525 12  -5.507  0.0001\n#&gt;  t2 - t3      -7.4 1.461 12  -5.066  0.0003\n#&gt;  t2 - t4      -2.4 1.342 12  -1.789  0.0989\n#&gt;  t3 - t4       5.0 1.633 12   3.062  0.0099\n#&gt; \n#&gt; group = B:\n#&gt;  contrast estimate    SE df t.ratio p.value\n#&gt;  t0 - t1       1.4 1.490 12   0.940  0.3659\n#&gt;  t0 - t2       3.2 1.324 12   2.417  0.0325\n#&gt;  t0 - t3      -7.0 2.058 12  -3.402  0.0052\n#&gt;  t0 - t4     -14.0 1.683 12  -8.317  &lt;.0001\n#&gt;  t1 - t2       1.8 0.913 12   1.972  0.0721\n#&gt;  t1 - t3      -8.4 1.061 12  -7.914  &lt;.0001\n#&gt;  t1 - t4     -15.4 1.525 12 -10.096  &lt;.0001\n#&gt;  t2 - t3     -10.2 1.461 12  -6.983  &lt;.0001\n#&gt;  t2 - t4     -17.2 1.342 12 -12.820  &lt;.0001\n#&gt;  t3 - t4      -7.0 1.633 12  -4.287  0.0011\n#&gt; \n#&gt; group = C:\n#&gt;  contrast estimate    SE df t.ratio p.value\n#&gt;  t0 - t1       3.2 1.490 12   2.148  0.0529\n#&gt;  t0 - t2       7.6 1.324 12   5.740  0.0001\n#&gt;  t0 - t3     -16.4 2.058 12  -7.971  &lt;.0001\n#&gt;  t0 - t4      -4.4 1.683 12  -2.614  0.0226\n#&gt;  t1 - t2       4.4 0.913 12   4.820  0.0004\n#&gt;  t1 - t3     -19.6 1.061 12 -18.465  &lt;.0001\n#&gt;  t1 - t4      -7.6 1.525 12  -4.982  0.0003\n#&gt;  t2 - t3     -24.0 1.461 12 -16.432  &lt;.0001\n#&gt;  t2 - t4     -12.0 1.342 12  -8.944  &lt;.0001\n#&gt;  t3 - t4      12.0 1.633 12   7.348  &lt;.0001\n\n\n\n12.3.3 分部计算\n\\[\n\\begin{aligned}\nSS_总&= SS_{受试对象间}+SS_{受试对象内}  \\\\\n&=（SS_{处理方法}+SS_{个体间差异}）+（SS_{时间}+SS_{处理与时间交互}+SS_{个体内差异}）\n\\end{aligned}\n\\]\n\\[\n\\begin{aligned}\n\\nu_总&= \\nu_{受试对象间}+\\nu_{受试对象内}  \\\\\n&=（\\nu_{处理方法}+\\nu_{个体差异}）+（\\nu_{时间}+\\nu_{处理与时间交互}+\\nu_{个体差异}）\n\\end{aligned}\n\\]\n\n\n\n\n\n\n\n\n\n\n\nPage 86-87\n变异\nSS\nv\nMS\nF\nCP\n\n\n\n受试对象间\n处理\n912.24\n2\n456.12\n5.78\n0.0174\n\n\n\n个体差异\n946.48\n12\n78.87\n\n\n\n\n\n\n1858.72\n\n\n\n\n\n\n受试对象内\n时间\n2336.45\n4\n584.11\n106.56\n&lt;0.0001\n\n\n\n处理与时间交互\n837.63\n8\n104.70\n19.10\n&lt;0.0001\n\n\n\n个体差异\n263.12\n48\n5.48\n\n\n\n\n\n\n3437.2\n\n\n\n\n\n\n总\n\n5295.92\n3×15-1=74\n\n\n\n\n\n\n\n12.3.3.1 SS总\n\n\\[\nSS_总=\\sum_i^n{（X_i-\\bar X）^2}\n\\]\n其中，n是观测值的总数，Xi 为每个观测值，\\(\\bar X\\) 是所有观测值的均值。\n\nShow the code\nSBP_data &lt;- c(SBP$t0,SBP$t1,SBP$t2,SBP$t3,SBP$t4)\n\nSBP_mean &lt;- mean(SBP_data)\n\nSS_total &lt;- sum((SBP_data-SBP_mean)^2)\n\nSS_total    \n#&gt; [1] 5295.92\n\n\n\n12.3.3.2 SS受试对象间\n\n\\[\nSS_{受试对象间}=\\sum_{j=1}^m n_{.j}(\\bar X_{.j}-\\bar X)^2\n\\]\n其中，m是受试者数量（15），n.j 是第j 个受试对象的观测值数量，\\(\\bar X.j\\)是第j 个受试对象的观测值的均值，\\(\\bar X\\) 是所有观测值的均值。\n\nShow the codeid_mean &lt;- SBP |&gt; dplyr::select(c(-1,-2)) |&gt; rowMeans()\n\nSS_between &lt;- 0\nfor (i in 1:nrow(SBP)) {\n    SS_between &lt;- SS_between + 5*(id_mean[i]-SBP_mean)^2\n}\nSS_between\n#&gt; [1] 1858.72\n\n\n\nShow the codegroup__summary &lt;- SBP_long |&gt; group_by(group) |&gt; \n    summarise(n=n(),mean=mean(SBP),sum=sum(SBP))\ngroup__summary \n#&gt; # A tibble: 3 × 4\n#&gt;   group     n  mean   sum\n#&gt;   &lt;fct&gt; &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt;\n#&gt; 1 A        25  120.  2992\n#&gt; 2 B        25  124.  3112\n#&gt; 3 C        25  128.  3205\n\n\nSS处理\n\n\\[\nSS_{处理}= \\sum_i^k n_k (\\bar X_k - \\bar X)^2\n\\]\n其中，k为不同处理组的组数，nk 为第 k 处理组观测值的总数，\\(\\bar  X_k\\) 为第k 处理组观测值的均数，\\(\\bar X\\) 是所有观测值的均值。\n\nShow the codeSS_处理 &lt;- 25*( (group__summary$mean[1] - SBP_mean )^2 + \n                       (group__summary$mean[2] - SBP_mean )^2 +\n                       (group__summary$mean[3] - SBP_mean )^2) \nSS_处理\n#&gt; [1] 912.24\n\n\n\nShow the codeSS_between_error &lt;- SS_between-SS_处理\n\nSS_between_error\n#&gt; [1] 946.48\n\n\n\n12.3.3.3 SS受试对象内\n\n\\[\nSS_{受试对象内}=SS_总-SS_{受试对象间}\n\\]\n\nShow the codeSS_within &lt;- SS_total-SS_between\nSS_within\n#&gt; [1] 3437.2\n\n\nSS时间\n\n\\[\nSS_{时间}=\\sum _{t=1}^T n_t （\\bar X_{.t}-\\bar X）^2\n\\]\n其中，T是时间点的数量，nt 是在时间点t的观测值数量，\\bar X.t 是在时间点 t 的均值。\n\nShow the codet_mean &lt;- SBP |&gt; dplyr::select(c(-1,-2)) |&gt; colMeans()\n\nSS_time &lt;- 0\nfor (i in seq_along(t_mean)) {\n    \n    SS_time &lt;- SS_time + 15*(t_mean[i]-SBP_mean)^2\n    \n}\nnames(SS_time) &lt;- \"SS_time\"\nSS_time\n#&gt;  SS_time \n#&gt; 2336.453\n\n\nSS处理与时间交互\n\n\\[\nSS_{处理与时间交互}=\\sum_{i=1}^{k}\\sum_{j=1}^{T}n_{ij}\\left (\\bar X_{ij.} -\\bar X_{i..}-\\bar X_{.j.} + \\bar X_{...} \\right )^2\n\\]\n其中，\n\nk 是处理方法的数量，3\nT 是时间点的数量，5\nnij 是第 i 个处理方法和第 j 个时间点的观测次数，25/5=5\nXij . 是第 i 个处理方法、第 j 个时间点的观测值的平均值\nXi . . 是第 i 个处理方法观测值的平均值，不考虑时间点\nX. j . 是第 j 个时间点观测值的平均值，不考虑处理方法\nX. . . 是所有观测值的平均值，不考虑处理方法和时间点\n\n\nShow the codeinteraction_effect_summary &lt;- SBP_long |&gt;\n    summarise(\n        #n = n(),\n        mean = mean(SBP),\n       # sum = sum(SBP),\n        .by = c(group , time)\n    )\ninteraction_effect_mean &lt;- interaction_effect_summary |&gt; pivot_wider(names_from = c(\"time\"),values_from = \"mean\")\n\n\n\nSS_interaction_effect &lt;- 0\nfor (i in 1:3) {\n    for (j in 1:5) {\n        SS_interaction_effect &lt;- SS_interaction_effect + 5 * (interaction_effect_mean[i, j + 1] -group__summary$mean[i] - t_mean[j] + SBP_mean) ^ 2\n    }\n    \n}\nnames(SS_interaction_effect) &lt;- \"SS_interaction_effect\"\nSS_interaction_effect\n#&gt;   SS_interaction_effect\n#&gt; 1              837.6267\n\n\n\nShow the codeSS_within_error &lt;- SS_within-SS_time-SS_interaction_effect\n\nnames(SS_within_error) &lt;- \"SS_within_error\"\nSS_within_error \n#&gt;   SS_within_error\n#&gt; 1          263.12",
    "crumbs": [
      "统计推断",
      "<span class='chapter-number'>12</span>  <span class='chapter-title'>重复测量方差分析</span>"
    ]
  },
  {
    "objectID": "repeated_measures_ANOVA.html#球形度检验-sphericity",
    "href": "repeated_measures_ANOVA.html#球形度检验-sphericity",
    "title": "\n12  重复测量方差分析\n",
    "section": "\n12.4 球形度检验 sphericity",
    "text": "12.4 球形度检验 sphericity\n重复测量方差分析假设相关条件（或组水平）的所有组合之间的差异方差相等。这被称为球形度假设。\nR中球形度检验\n球度仅针对具有两个以上水平的变量进行评估，因为球形度必然适用于只有两个水平的条件。\n违反球形度假设可能会扭曲方差计算，从而导致更宽松的重复测量方差分析检验（即 I 类错误率增加）。在这种情况下，必须根据违反球形度的程度适当校正重复测量方差分析。文献中使用了两种常见的校正：Greenhouse-Geisser epsilon （GGe） 和 Huynh-Feldt epsilon （HFe）。\n球形度的 Mauchly 检验用于评估是否满足球形度的假设。使用rstatix::anova_test() 时，会自动报告此问题。尽管该方法受到严厉批评，通常无法检测到小样本中的球形偏离，而在大样本中则过度检测到它们，但它仍然是一种常用的方法。\n\n12.4.1 计算步骤\n具体操作步骤如下：\n\n计算相关组的每个组合之间的差异\n计算每个组差的方差\n\n\n\n12.4.2 案例\n\n12.4.2.1 rstatix::anova_test()\n\n\nShow the code\naov_SBP &lt;- rstatix::anova_test(data = SBP_long,\n           dv = SBP,\n           wid = id,\n           within = time,\n           between = group\n           )\n\naov_SBP\n#&gt; ANOVA Table (type II tests)\n#&gt; \n#&gt; $ANOVA\n#&gt;       Effect DFn DFd       F        p p&lt;.05   ges\n#&gt; 1      group   2  12   5.783 1.70e-02     * 0.430\n#&gt; 2       time   4  48 106.558 3.02e-23     * 0.659\n#&gt; 3 group:time   8  48  19.101 1.62e-12     * 0.409\n#&gt; \n#&gt; $`Mauchly's Test for Sphericity`\n#&gt;       Effect     W     p p&lt;.05\n#&gt; 1       time 0.293 0.178      \n#&gt; 2 group:time 0.293 0.178      \n#&gt; \n#&gt; $`Sphericity Corrections`\n#&gt;       Effect   GGe      DF[GG]    p[GG] p[GG]&lt;.05   HFe      DF[HF]    p[HF]\n#&gt; 1       time 0.679 2.71, 32.58 1.87e-16         * 0.896 3.59, 43.03 4.65e-21\n#&gt; 2 group:time 0.679 5.43, 32.58 4.26e-09         * 0.896 7.17, 43.03 2.04e-11\n#&gt;   p[HF]&lt;.05\n#&gt; 1         *\n#&gt; 2         *\n\n\n输出是一个包含三个表的列表：\n\n方差分析结果显示标有（generalized eta squared，ges）的列上的 p 值和效应大小;效应大小本质上是由于受试者内因素而忽略受试者效应而导致的变异量。\nMauchly Sphericity检验。仅报告具有 &gt;2 水平的变量或效应，因为球形度必然适用于只有 2 个水平的效应。原假设是组差的方差相等。因此，显著的 p 值 （p &lt; 0.05） 表示组差的方差不相等。\n球度校正结果，以防我们无法维持球形度假设。提供了文献中使用的两种常见校正：Greenhouse-Geisser epsilon （GGe） 和 Huynh-Feldt epsilon （HFe） 及其相应的 p 值\n\n12.4.2.2 ez::ezANOVA()\n\n\nShow the codelibrary(ez)\n\n# 进行重复测量方差分析\naov_ez &lt;- ezANOVA(data = SBP_long,\n                   dv = SBP,\n                   wid = id,\n                   within = time,\n                   between = group,\n                   detailed = TRUE)\n\n# 查看球形检验结果\nprint(aov_ez)\n#&gt; $ANOVA\n#&gt;        Effect DFn DFd          SSn    SSd            F            p p&lt;.05\n#&gt; 1 (Intercept)   1  12 1155433.0800 946.48 14649.223396 6.784700e-20     *\n#&gt; 2       group   2  12     912.2400 946.48     5.782943 1.743351e-02     *\n#&gt; 3        time   4  48    2336.4533 263.12   106.557616 3.017101e-23     *\n#&gt; 4  group:time   8  48     837.6267 263.12    19.100638 1.621310e-12     *\n#&gt;         ges\n#&gt; 1 0.9989542\n#&gt; 2 0.4299287\n#&gt; 3 0.6588884\n#&gt; 4 0.4091519\n#&gt; \n#&gt; $`Mauchly's Test for Sphericity`\n#&gt;       Effect         W         p p&lt;.05\n#&gt; 3       time 0.2930746 0.1776608      \n#&gt; 4 group:time 0.2930746 0.1776608      \n#&gt; \n#&gt; $`Sphericity Corrections`\n#&gt;       Effect      GGe        p[GG] p[GG]&lt;.05      HFe        p[HF] p[HF]&lt;.05\n#&gt; 3       time 0.678693 1.867336e-16         * 0.896371 4.649080e-21         *\n#&gt; 4 group:time 0.678693 4.262529e-09         * 0.896371 2.041727e-11         *\n\n\n\n12.4.3 当满足球形度假设时\n\n球形度的 Mauchly 检验不显著 （p &gt; 0.05）;这表明，受试者内因素水平之间的差异方差是相等的。因此，我们可以假设协方差矩阵的球形度，并解释方差分析表中可用的标准输出。\n\nShow the code# Display ANOVA table\naov_SBP$ANOVA\n#&gt;       Effect DFn DFd       F        p p&lt;.05   ges\n#&gt; 1      group   2  12   5.783 1.70e-02     * 0.430\n#&gt; 2       time   4  48 106.558 3.02e-23     * 0.659\n#&gt; 3 group:time   8  48  19.101 1.62e-12     * 0.409\n\n\n\nF表示我们正在与 F 分布（F 检验）进行比较; 分别表示 time 和 Error（time） 的自由度; 表示得到的 F 统计量值(2, 18)81.8\np指定 p 值\nges（广义 eta 平方，etaov_SBP[g]）是效应大小（由于受试者内因素引起的变异量）\n\n12.4.4 当违反球形度假设时\n\n如果数据违反了球形度假设（即 Mauchly 检验，p &lt;= 0.05），则应解释表sphericity corrections中的结果，其中对自由度进行了调整，这会影响检验的统计显著性（即 p 值）。校正通过乘法和校正估计值（Greenhouse-Geisser （GG） 和 Huynh-Feldt （HF） ε 值）来应用。\n\n\n\n\n\n\nNote\n\n\n\nepsilon 提供了球形度被侵犯的程度的度量。值为 1 表示不偏离球形度（组差的所有方差均相等）。违反球形度会导致 epsilon 值低于 1。epsilon 离 1 越远，违规越严重。\n\n\n可以看出，即使在球形度校正（p[GG] &lt; 0.001，p[HF] &lt; 0.001）之后，平均自尊得分在不同时间点仍存在统计学差异。\n在两种球形度校正方法中，Huynh-Feldt 校正被认为是最不保守的（高估了 epsilon），而 Greenhouse-Geisser 被认为是更保守的（当 epsilon 接近 1 时低估了 epsilon）。\n一般建议使用 Greenhouse-Geisser 校正，特别是当 epsilon &lt; 0.75 时。在 epsilon 大于 0.75 的情况下，一些统计学家建议使用 Huynh-Feldt 校正 （Girden 1992）。",
    "crumbs": [
      "统计推断",
      "<span class='chapter-number'>12</span>  <span class='chapter-title'>重复测量方差分析</span>"
    ]
  },
  {
    "objectID": "LME.html",
    "href": "LME.html",
    "title": "\n18  线性混合模型\n",
    "section": "",
    "text": "18.1 lme4::lmer()\nlmer() 的表达式如下：\n\\[\nlmer (data,formual= DV ~ Fixed\\_Factor + (Random\\_intercept + Random\\_slope | Random\\_Factor))\n\\]\n截距中，1表示随机截距，0表示固定截距，默认截距为1。",
    "crumbs": [
      "统计模型",
      "<span class='chapter-number'>18</span>  <span class='chapter-title'>线性混合模型</span>"
    ]
  },
  {
    "objectID": "LME.html#lme4lmer",
    "href": "LME.html#lme4lmer",
    "title": "\n18  线性混合模型\n",
    "section": "",
    "text": "LME\n表达式\n简写\n\n\n\n随机截距+随机斜率\ny~x+( 1+x | id )\ny~x+( x | id )\n\n\n随机截距+固定斜率\ny~x+( 1+1 | id )\ny~x+( 1 | id )\n\n\n固定截距+随机斜率\ny~x+( 0+x | id )\nNA\n\n\n线性模型：固定截距+固定斜率\ny~x\nNA",
    "crumbs": [
      "统计模型",
      "<span class='chapter-number'>18</span>  <span class='chapter-title'>线性混合模型</span>"
    ]
  },
  {
    "objectID": "LME.html#nlmelme",
    "href": "LME.html#nlmelme",
    "title": "\n18  线性混合模型\n",
    "section": "\n18.2 nlme::lme()\n",
    "text": "18.2 nlme::lme()",
    "crumbs": [
      "统计模型",
      "<span class='chapter-number'>18</span>  <span class='chapter-title'>线性混合模型</span>"
    ]
  },
  {
    "objectID": "LME.html#随机截距随机斜率",
    "href": "LME.html#随机截距随机斜率",
    "title": "\n18  线性混合模型\n",
    "section": "\n18.3 随机截距+随机斜率",
    "text": "18.3 随机截距+随机斜率\n\nShow the codedf_long &lt;- read_delim(\"data/AED/RIKZ.txt\")\ndf_long$Beach &lt;- factor(df_long$Beach)\ndf_long$Exposure &lt;- factor(df_long$Exposure)\nhead(df_long)\n#&gt; # A tibble: 6 × 5\n#&gt;   Sample Richness Exposure    NAP Beach\n#&gt;    &lt;dbl&gt;    &lt;dbl&gt; &lt;fct&gt;     &lt;dbl&gt; &lt;fct&gt;\n#&gt; 1      1       11 10        0.045 1    \n#&gt; 2      2       10 10       -1.04  1    \n#&gt; 3      3       13 10       -1.34  1    \n#&gt; 4      4       11 10        0.616 1    \n#&gt; 5      5       10 10       -0.684 1    \n#&gt; 6      6        8 8         1.19  2\n\n\n\\[\n\\eta_{(nrow \\times 1)} = \\mathbf{X}_{nrow \\times 1} \\beta_{1 \\times 1} + \\mathbf{Z}_{nrow \\times 2n_{subjects}} \\mathbf{\\gamma}_{2n_{subjects} \\times 1} + \\epsilon_i\n\\]\nZ有两倍于受试者数量的列，每个受试者的随机截距和随机斜率\n\nShow the codelibrary(lme4)\nlme1 &lt;- lmer(Richness ~ 1 + NAP * Exposure+ (1 +NAP |Beach) ,data = df_long)\nsummary(lme1)\n#&gt; Linear mixed model fit by REML ['lmerMod']\n#&gt; Formula: Richness ~ 1 + NAP * Exposure + (1 + NAP | Beach)\n#&gt;    Data: df_long\n#&gt; \n#&gt; REML criterion at convergence: 207.2\n#&gt; \n#&gt; Scaled residuals: \n#&gt;      Min       1Q   Median       3Q      Max \n#&gt; -1.92384 -0.36066 -0.13343  0.09819  2.84228 \n#&gt; \n#&gt; Random effects:\n#&gt;  Groups   Name        Variance Std.Dev. Corr \n#&gt;  Beach    (Intercept) 3.758    1.938         \n#&gt;           NAP         2.837    1.684    -1.00\n#&gt;  Residual             6.535    2.556         \n#&gt; Number of obs: 45, groups:  Beach, 9\n#&gt; \n#&gt; Fixed effects:\n#&gt;                Estimate Std. Error t value\n#&gt; (Intercept)     13.3457     2.2784   5.858\n#&gt; NAP             -4.1753     2.1243  -1.965\n#&gt; Exposure10      -5.3273     2.5556  -2.085\n#&gt; Exposure11      -9.7660     2.5653  -3.807\n#&gt; NAP:Exposure10   0.1646     2.3621   0.070\n#&gt; NAP:Exposure11   2.7273     2.3715   1.150\n#&gt; \n#&gt; Correlation of Fixed Effects:\n#&gt;             (Intr) NAP    Exps10 Exps11 NAP:E10\n#&gt; NAP         -0.770                             \n#&gt; Exposure10  -0.892  0.686                      \n#&gt; Exposure11  -0.888  0.683  0.792               \n#&gt; NAP:Expsr10  0.692 -0.899 -0.775 -0.615        \n#&gt; NAP:Expsr11  0.689 -0.896 -0.615 -0.779  0.806 \n#&gt; optimizer (nloptwrap) convergence code: 0 (OK)\n#&gt; boundary (singular) fit: see help('isSingular')\nAIC(lme1)\n#&gt; [1] 227.1558\nBIC(lme1)\n#&gt; [1] 245.2224\nlogLik(lme1)\n#&gt; 'log Lik.' -103.5779 (df=10)\n\n2*(1-pt(-3.914605,35,lower.tail = F))\n#&gt; [1] 0.0003993968\nlibrary(broom.mixed)\ntidy(lme1)\n#&gt; # A tibble: 10 × 6\n#&gt;    effect   group    term                 estimate std.error statistic\n#&gt;    &lt;chr&gt;    &lt;chr&gt;    &lt;chr&gt;                   &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;\n#&gt;  1 fixed    &lt;NA&gt;     (Intercept)            13.3        2.28    5.86  \n#&gt;  2 fixed    &lt;NA&gt;     NAP                    -4.18       2.12   -1.97  \n#&gt;  3 fixed    &lt;NA&gt;     Exposure10             -5.33       2.56   -2.08  \n#&gt;  4 fixed    &lt;NA&gt;     Exposure11             -9.77       2.57   -3.81  \n#&gt;  5 fixed    &lt;NA&gt;     NAP:Exposure10          0.165      2.36    0.0697\n#&gt;  6 fixed    &lt;NA&gt;     NAP:Exposure11          2.73       2.37    1.15  \n#&gt;  7 ran_pars Beach    sd__(Intercept)         1.94      NA      NA     \n#&gt;  8 ran_pars Beach    cor__(Intercept).NAP   -1         NA      NA     \n#&gt;  9 ran_pars Beach    sd__NAP                 1.68      NA      NA     \n#&gt; 10 ran_pars Residual sd__Observation         2.56      NA      NA\n\nlibrary(nlme)\n\nnlme1 &lt;- lme(Richness ~ 1 + NAP * Exposure,\n             random = ~ 1 + NAP | Beach ,\n             data = df_long,\n             control = lmeControl(opt = \"optim\", msMaxIter = 100, msMaxEval = 5000))\nsummary(nlme1)\n#&gt; Linear mixed-effects model fit by REML\n#&gt;   Data: df_long \n#&gt;        AIC      BIC    logLik\n#&gt;   227.2046 243.8402 -103.6023\n#&gt; \n#&gt; Random effects:\n#&gt;  Formula: ~1 + NAP | Beach\n#&gt;  Structure: General positive-definite, Log-Cholesky parametrization\n#&gt;             StdDev   Corr  \n#&gt; (Intercept) 1.939709 (Intr)\n#&gt; NAP         1.689580 -0.996\n#&gt; Residual    2.554676       \n#&gt; \n#&gt; Fixed effects:  Richness ~ 1 + NAP * Exposure \n#&gt;                    Value Std.Error DF   t-value p-value\n#&gt; (Intercept)    13.345694  2.278989 33  5.855970  0.0000\n#&gt; NAP            -4.175271  2.128084 33 -1.961986  0.0582\n#&gt; Exposure10     -5.323695  2.556406  6 -2.082492  0.0825\n#&gt; Exposure11     -9.765613  2.566035  6 -3.805720  0.0089\n#&gt; NAP:Exposure10  0.167146  2.366467 33  0.070631  0.9441\n#&gt; NAP:Exposure11  2.726865  2.375786 33  1.147774  0.2593\n#&gt;  Correlation: \n#&gt;                (Intr) NAP    Exps10 Exps11 NAP:E10\n#&gt; NAP            -0.767                             \n#&gt; Exposure10     -0.891  0.684                      \n#&gt; Exposure11     -0.888  0.682  0.792               \n#&gt; NAP:Exposure10  0.690 -0.899 -0.772 -0.613        \n#&gt; NAP:Exposure11  0.687 -0.896 -0.613 -0.777  0.806 \n#&gt; \n#&gt; Standardized Within-Group Residuals:\n#&gt;        Min         Q1        Med         Q3        Max \n#&gt; -1.9251786 -0.3608959 -0.1327685  0.0992999  2.8420571 \n#&gt; \n#&gt; Number of Observations: 45\n#&gt; Number of Groups: 9\n\ntidy(nlme1)\n#&gt; # A tibble: 10 × 8\n#&gt;    effect   group    term            estimate std.error    df statistic  p.value\n#&gt;    &lt;chr&gt;    &lt;chr&gt;    &lt;chr&gt;              &lt;dbl&gt;     &lt;dbl&gt; &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;\n#&gt;  1 fixed    &lt;NA&gt;     (Intercept)       13.3        2.28    33    5.86    1.47e-6\n#&gt;  2 fixed    &lt;NA&gt;     NAP               -4.18       2.13    33   -1.96    5.82e-2\n#&gt;  3 fixed    &lt;NA&gt;     Exposure10        -5.32       2.56     6   -2.08    8.25e-2\n#&gt;  4 fixed    &lt;NA&gt;     Exposure11        -9.77       2.57     6   -3.81    8.91e-3\n#&gt;  5 fixed    &lt;NA&gt;     NAP:Exposure10     0.167      2.37    33    0.0706  9.44e-1\n#&gt;  6 fixed    &lt;NA&gt;     NAP:Exposure11     2.73       2.38    33    1.15    2.59e-1\n#&gt;  7 ran_pars Beach    sd_(Intercept)     1.94      NA       NA   NA      NA      \n#&gt;  8 ran_pars Beach    cor_NAP.(Inter…   -0.996     NA       NA   NA      NA      \n#&gt;  9 ran_pars Beach    sd_NAP             1.69      NA       NA   NA      NA      \n#&gt; 10 ran_pars Residual sd_Observation     2.55      NA       NA   NA      NA\n\n\n这个模型的公式可以分解为：\n\n固定效应部分：Richness 的预测由截距、NAP（数值变量）和 Exposure（分类变量，包含 Exposure10 和 Exposure11）及其交互项构成。\n随机效应部分：Beach 作为随机因子，包含随机截距和随机斜率（NAP）。\n\n\nShow the code# 标准化模型残差分布\nquantile(residuals(lme1,type=\"pearson\",scaled=T))\n#&gt;         0%        25%        50%        75%       100% \n#&gt; -1.9238372 -0.3606612 -0.1334336  0.0981939  2.8422803\n\n# 随机因子随机效应和显著性检验\nranef(lme1)\n#&gt; $Beach\n#&gt;     (Intercept)           NAP\n#&gt; 1 -4.274356e-02  3.713708e-02\n#&gt; 2 -2.709479e-14  2.354089e-14\n#&gt; 3  3.819348e-03 -3.318381e-03\n#&gt; 4 -2.741786e-01  2.382158e-01\n#&gt; 5  3.269522e+00 -2.840673e+00\n#&gt; 6  2.736093e-01 -2.377212e-01\n#&gt; 7 -3.250033e-03  2.823741e-03\n#&gt; 8 -2.148947e+00  1.867079e+00\n#&gt; 9 -1.077831e+00  9.364564e-01\n#&gt; \n#&gt; with conditional variances for \"Beach\"\nlmerTest::ranova(lme1)\n#&gt; ANOVA-like table for random-effects: Single term deletions\n#&gt; \n#&gt; Model:\n#&gt; Richness ~ NAP + Exposure + (1 + NAP | Beach) + NAP:Exposure\n#&gt;                          npar  logLik    AIC    LRT Df Pr(&gt;Chisq)\n#&gt; &lt;none&gt;                     10 -103.58 227.16                     \n#&gt; NAP in (1 + NAP | Beach)    8 -105.67 227.35 4.1935  2     0.1229\n\n# 查看固定效应和显著性检验\ncoef(lme1)\n#&gt; $Beach\n#&gt;   (Intercept)       NAP Exposure10 Exposure11 NAP:Exposure10 NAP:Exposure11\n#&gt; 1    13.30295 -4.138134  -5.327265  -9.766048      0.1646123       2.727307\n#&gt; 2    13.34569 -4.175271  -5.327265  -9.766048      0.1646123       2.727307\n#&gt; 3    13.34951 -4.178590  -5.327265  -9.766048      0.1646123       2.727307\n#&gt; 4    13.07152 -3.937055  -5.327265  -9.766048      0.1646123       2.727307\n#&gt; 5    16.61522 -7.015944  -5.327265  -9.766048      0.1646123       2.727307\n#&gt; 6    13.61930 -4.412992  -5.327265  -9.766048      0.1646123       2.727307\n#&gt; 7    13.34244 -4.172447  -5.327265  -9.766048      0.1646123       2.727307\n#&gt; 8    11.19675 -2.308192  -5.327265  -9.766048      0.1646123       2.727307\n#&gt; 9    12.26786 -3.238815  -5.327265  -9.766048      0.1646123       2.727307\n#&gt; \n#&gt; attr(,\"class\")\n#&gt; [1] \"coef.mer\"\nanova(lme1)\n#&gt; Analysis of Variance Table\n#&gt;              npar  Sum Sq Mean Sq F value\n#&gt; NAP             1 124.279 124.279 19.0178\n#&gt; Exposure        2 142.983  71.492 10.9400\n#&gt; NAP:Exposure    2  22.308  11.154  1.7068\n\n#  查看 类和方法\nclass(lme1)\n#&gt; [1] \"lmerMod\"\n#&gt; attr(,\"package\")\n#&gt; [1] \"lme4\"\n# methods(class = \"lmerMod\")\n\n# confint(lme1,level = 0.95)",
    "crumbs": [
      "统计模型",
      "<span class='chapter-number'>18</span>  <span class='chapter-title'>线性混合模型</span>"
    ]
  },
  {
    "objectID": "LME.html#随机截距固定斜率",
    "href": "LME.html#随机截距固定斜率",
    "title": "\n18  线性混合模型\n",
    "section": "\n18.4 随机截距+固定斜率",
    "text": "18.4 随机截距+固定斜率\n\\[\n\\eta_{(nrow \\ \\times 1)}=\\mathbf{X_{nrow×1}}\\beta_{1\\times1} +Z_{nrow\\times n_{subjects}} \\mathbf{\\gamma}_{n_{subjects}\\times 1}+\\epsilon_i\n\\]\nZ有一倍于受试者数量的列，每个受试者的随机截距。\n\nShow the codelme2 &lt;- lmer(Richness ~ 1 + NAP+ (1 |Beach) ,data = df_long)\nsummary(lme2)\n#&gt; Linear mixed model fit by REML ['lmerMod']\n#&gt; Formula: Richness ~ 1 + NAP + (1 | Beach)\n#&gt;    Data: df_long\n#&gt; \n#&gt; REML criterion at convergence: 239.5\n#&gt; \n#&gt; Scaled residuals: \n#&gt;     Min      1Q  Median      3Q     Max \n#&gt; -1.4227 -0.4848 -0.1576  0.2519  3.9794 \n#&gt; \n#&gt; Random effects:\n#&gt;  Groups   Name        Variance Std.Dev.\n#&gt;  Beach    (Intercept) 8.668    2.944   \n#&gt;  Residual             9.362    3.060   \n#&gt; Number of obs: 45, groups:  Beach, 9\n#&gt; \n#&gt; Fixed effects:\n#&gt;             Estimate Std. Error t value\n#&gt; (Intercept)   6.5819     1.0958   6.007\n#&gt; NAP          -2.5684     0.4947  -5.192\n#&gt; \n#&gt; Correlation of Fixed Effects:\n#&gt;     (Intr)\n#&gt; NAP -0.157\nAIC(lme2)\n#&gt; [1] 247.4802\nBIC(lme2)\n#&gt; [1] 254.7069\nlogLik(lme2)\n#&gt; 'log Lik.' -119.7401 (df=4)\n\n2*(1-pt(6.007,35,lower.tail = T))\n#&gt; [1] 7.558855e-07\n\n\n\nnlme2 &lt;- lme(Richness ~ 1 + NAP * Exposure,random= ~ 1 |Beach ,data = df_long)\nsummary(nlme2)\n#&gt; Linear mixed-effects model fit by REML\n#&gt;   Data: df_long \n#&gt;        AIC      BIC    logLik\n#&gt;   227.3493 240.6578 -105.6747\n#&gt; \n#&gt; Random effects:\n#&gt;  Formula: ~1 | Beach\n#&gt;         (Intercept) Residual\n#&gt; StdDev:   0.5138683 2.971793\n#&gt; \n#&gt; Fixed effects:  Richness ~ 1 + NAP * Exposure \n#&gt;                    Value Std.Error DF   t-value p-value\n#&gt; (Intercept)    13.345694  1.483557 33  8.995739  0.0000\n#&gt; NAP            -4.175271  1.505110 33 -2.774063  0.0090\n#&gt; Exposure10     -5.544983  1.657659  6 -3.345069  0.0155\n#&gt; Exposure11     -9.730595  1.670518  6 -5.824898  0.0011\n#&gt; NAP:Exposure10  0.671731  1.643864 33  0.408629  0.6855\n#&gt; NAP:Exposure11  2.688806  1.656743 33  1.622947  0.1141\n#&gt;  Correlation: \n#&gt;                (Intr) NAP    Exps10 Exps11 NAP:E10\n#&gt; NAP            -0.278                             \n#&gt; Exposure10     -0.895  0.249                      \n#&gt; Exposure11     -0.888  0.247  0.795               \n#&gt; NAP:Exposure10  0.255 -0.916 -0.276 -0.226        \n#&gt; NAP:Exposure11  0.253 -0.908 -0.226 -0.296  0.832 \n#&gt; \n#&gt; Standardized Within-Group Residuals:\n#&gt;        Min         Q1        Med         Q3        Max \n#&gt; -1.5652904 -0.4386841 -0.1164805  0.1783113  4.1098230 \n#&gt; \n#&gt; Number of Observations: 45\n#&gt; Number of Groups: 9",
    "crumbs": [
      "统计模型",
      "<span class='chapter-number'>18</span>  <span class='chapter-title'>线性混合模型</span>"
    ]
  },
  {
    "objectID": "LME.html#固定截距随机斜率",
    "href": "LME.html#固定截距随机斜率",
    "title": "\n18  线性混合模型\n",
    "section": "\n18.5 固定截距+随机斜率",
    "text": "18.5 固定截距+随机斜率\n\\[\n\\eta_{(nrow \\times 1)} = \\mathbf{X}_{nrow \\times 1} \\beta_{1 \\times 1} + \\mathbf{Z}_{nrow \\times n_{subjects}} \\mathbf{\\gamma}_{n_{subjects} \\times 1} + \\epsilon_i\n\\]\nZ 有一倍于受试者数量的列，每个受试者的随机斜率。\n\nShow the codelme3 &lt;- lmer(Richness ~ 1 +  NAP+ (0 + NAP |Beach) ,data = df_long)\nsummary(lme3)\n#&gt; Linear mixed model fit by REML ['lmerMod']\n#&gt; Formula: Richness ~ 1 + NAP + (0 + NAP | Beach)\n#&gt;    Data: df_long\n#&gt; \n#&gt; REML criterion at convergence: 252.2\n#&gt; \n#&gt; Scaled residuals: \n#&gt;     Min      1Q  Median      3Q     Max \n#&gt; -1.2182 -0.6636 -0.1930  0.3253  3.3347 \n#&gt; \n#&gt; Random effects:\n#&gt;  Groups   Name Variance Std.Dev.\n#&gt;  Beach    NAP   0.00    0.00    \n#&gt;  Residual      17.31    4.16    \n#&gt; Number of obs: 45, groups:  Beach, 9\n#&gt; \n#&gt; Fixed effects:\n#&gt;             Estimate Std. Error t value\n#&gt; (Intercept)   6.6857     0.6578  10.164\n#&gt; NAP          -2.8669     0.6307  -4.545\n#&gt; \n#&gt; Correlation of Fixed Effects:\n#&gt;     (Intr)\n#&gt; NAP -0.333\n#&gt; optimizer (nloptwrap) convergence code: 0 (OK)\n#&gt; boundary (singular) fit: see help('isSingular')\n\nnlme3 &lt;- lme(Richness ~ 1 + NAP,random= ~ 0+NAP |Beach ,data = df_long)\nsummary(nlme3)\n#&gt; Linear mixed-effects model fit by REML\n#&gt;   Data: df_long \n#&gt;       AIC      BIC    logLik\n#&gt;   260.201 267.2458 -126.1005\n#&gt; \n#&gt; Random effects:\n#&gt;  Formula: ~0 + NAP | Beach\n#&gt;                  NAP Residual\n#&gt; StdDev: 0.0001127408 4.159929\n#&gt; \n#&gt; Fixed effects:  Richness ~ 1 + NAP \n#&gt;                 Value Std.Error DF   t-value p-value\n#&gt; (Intercept)  6.685662 0.6577579 35 10.164320   0e+00\n#&gt; NAP         -2.866853 0.6307186 35 -4.545376   1e-04\n#&gt;  Correlation: \n#&gt;     (Intr)\n#&gt; NAP -0.333\n#&gt; \n#&gt; Standardized Within-Group Residuals:\n#&gt;        Min         Q1        Med         Q3        Max \n#&gt; -1.2181663 -0.6636488 -0.1930031  0.3253447  3.3347473 \n#&gt; \n#&gt; Number of Observations: 45\n#&gt; Number of Groups: 9",
    "crumbs": [
      "统计模型",
      "<span class='chapter-number'>18</span>  <span class='chapter-title'>线性混合模型</span>"
    ]
  },
  {
    "objectID": "LME.html#随机效应模型",
    "href": "LME.html#随机效应模型",
    "title": "\n18  线性混合模型\n",
    "section": "\n18.6 随机效应模型",
    "text": "18.6 随机效应模型\n\nShow the code\nlme4 &lt;- lmer(Richness ~ 1 + (1|Beach) ,data = df_long)\nsummary(lme4)\n#&gt; Linear mixed model fit by REML ['lmerMod']\n#&gt; Formula: Richness ~ 1 + (1 | Beach)\n#&gt;    Data: df_long\n#&gt; \n#&gt; REML criterion at convergence: 261.1\n#&gt; \n#&gt; Scaled residuals: \n#&gt;     Min      1Q  Median      3Q     Max \n#&gt; -1.7797 -0.5070 -0.0980  0.2547  3.8063 \n#&gt; \n#&gt; Random effects:\n#&gt;  Groups   Name        Variance Std.Dev.\n#&gt;  Beach    (Intercept) 10.48    3.237   \n#&gt;  Residual             15.51    3.938   \n#&gt; Number of obs: 45, groups:  Beach, 9\n#&gt; \n#&gt; Fixed effects:\n#&gt;             Estimate Std. Error t value\n#&gt; (Intercept)    5.689      1.228   4.631\n\nnlme4 &lt;- lme(Richness ~ 1 ,random= ~ 1 |Beach ,data = df_long)\nsummary(nlme4)\n#&gt; Linear mixed-effects model fit by REML\n#&gt;   Data: df_long \n#&gt;        AIC      BIC    logLik\n#&gt;   267.1142 272.4668 -130.5571\n#&gt; \n#&gt; Random effects:\n#&gt;  Formula: ~1 | Beach\n#&gt;         (Intercept) Residual\n#&gt; StdDev:    3.237112 3.938415\n#&gt; \n#&gt; Fixed effects:  Richness ~ 1 \n#&gt;                Value Std.Error DF  t-value p-value\n#&gt; (Intercept) 5.688889  1.228419 36 4.631066       0\n#&gt; \n#&gt; Standardized Within-Group Residuals:\n#&gt;         Min          Q1         Med          Q3         Max \n#&gt; -1.77968689 -0.50704111 -0.09795286  0.25468670  3.80631705 \n#&gt; \n#&gt; Number of Observations: 45\n#&gt; Number of Groups: 9",
    "crumbs": [
      "统计模型",
      "<span class='chapter-number'>18</span>  <span class='chapter-title'>线性混合模型</span>"
    ]
  },
  {
    "objectID": "LME.html#线性模型固定截距-固定斜率",
    "href": "LME.html#线性模型固定截距-固定斜率",
    "title": "\n18  线性混合模型\n",
    "section": "\n18.7 线性模型：固定截距+ 固定斜率",
    "text": "18.7 线性模型：固定截距+ 固定斜率\n\nShow the codelm &lt;- lm(Richness ~ 1 + NAP ,data = df_long)\nlm\n#&gt; \n#&gt; Call:\n#&gt; lm(formula = Richness ~ 1 + NAP, data = df_long)\n#&gt; \n#&gt; Coefficients:\n#&gt; (Intercept)          NAP  \n#&gt;       6.686       -2.867",
    "crumbs": [
      "统计模型",
      "<span class='chapter-number'>18</span>  <span class='chapter-title'>线性混合模型</span>"
    ]
  },
  {
    "objectID": "LME.html#模型选择",
    "href": "LME.html#模型选择",
    "title": "\n18  线性混合模型\n",
    "section": "\n18.8 模型选择",
    "text": "18.8 模型选择\n限制最大似然法REML\n\n\n赤池信息准则（AIC）\n\\[ kIC=−2log(\\mathcal{L})+2k\\]\n其中：\n\n\\(\\mathcal{L}\\) 是似然函数。\n\\(k\\) 是模型参数的数量。\n\n\n\n贝叶斯信息准则（BIC）\n\\[ BIC=−2log(\\mathcal{L})+klog(n) \\]\n其中：\n\n\n\\(n\\) 是样本量。\n\n\n\n\nShow the code\nplot_lme &lt;- function(model, title) {\n    ggplot(df_long, aes(NAP, Richness, group = Beach, color = Beach)) +\n        geom_point() +\n        geom_line(\n            data =  bind_cols(df_long, .pred = predict(model, df_long)),\n            mapping = aes(y = .pred),\n            linewidth = 1\n        ) +\n        labs(title = title)+\n        scale_x_continuous(expand = (mult=c(0,.1)))+\n        scale_y_continuous(expand = (mult=c(0,.1)))+\n    ggsci::scale_color_jco() +\n        ggpubr::theme_pubr() +\n        theme(legend.position = \"right\",\n              plot.title = element_text(hjust = .5))\n}\n\n\nlme_plot &lt;- map2(list(lme1,lme2,lme3,lm),list(\"随机截距+随机斜率\",\"随机截距+固定斜率\",\"固定截距+随机斜率\",\"固定截距+固定斜率\"),plot_lme)\n\n\nlme_plot\n#&gt; [[1]]\n\n\n\n\n\n\n#&gt; \n#&gt; [[2]]\n\n\n\n\n\n\n#&gt; \n#&gt; [[3]]\n\n\n\n\n\n\n#&gt; \n#&gt; [[4]]\n\n\n\n\n\n\n\n\nShow the codeanova(lme1,lme2,lme3)\n#&gt; Data: df_long\n#&gt; Models:\n#&gt; lme2: Richness ~ 1 + NAP + (1 | Beach)\n#&gt; lme3: Richness ~ 1 + NAP + (0 + NAP | Beach)\n#&gt; lme1: Richness ~ 1 + NAP * Exposure + (1 + NAP | Beach)\n#&gt;      npar    AIC    BIC  logLik deviance  Chisq Df Pr(&gt;Chisq)    \n#&gt; lme2    4 249.83 257.06 -120.92   241.83                         \n#&gt; lme3    4 261.95 269.18 -126.98   253.95  0.000  0               \n#&gt; lme1   10 238.20 256.27 -109.10   218.20 35.754  6  3.077e-06 ***\n#&gt; ---\n#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\nanova(lme1,lme2,lme3,lme4,lm)\n#&gt; Data: df_long\n#&gt; Models:\n#&gt; lme4: Richness ~ 1 + (1 | Beach)\n#&gt; lm: Richness ~ 1 + NAP\n#&gt; lme2: Richness ~ 1 + NAP + (1 | Beach)\n#&gt; lme3: Richness ~ 1 + NAP + (0 + NAP | Beach)\n#&gt; lme1: Richness ~ 1 + NAP * Exposure + (1 + NAP | Beach)\n#&gt;      npar    AIC    BIC  logLik deviance  Chisq Df Pr(&gt;Chisq)    \n#&gt; lme4    3 269.30 274.72 -131.65   263.30                         \n#&gt; lm      3 259.95 265.37 -126.98   253.95  9.350  0               \n#&gt; lme2    4 249.83 257.06 -120.92   241.83 12.124  1  0.0004977 ***\n#&gt; lme3    4 261.95 269.18 -126.98   253.95  0.000  0               \n#&gt; lme1   10 238.20 256.27 -109.10   218.20 35.754  6  3.077e-06 ***\n#&gt; ---\n#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\n# p小于0.05,说明全模型与简化后模型存在差异，最终采用lme1,AIC",
    "crumbs": [
      "统计模型",
      "<span class='chapter-number'>18</span>  <span class='chapter-title'>线性混合模型</span>"
    ]
  },
  {
    "objectID": "LME.html#模型诊断",
    "href": "LME.html#模型诊断",
    "title": "\n18  线性混合模型\n",
    "section": "\n18.9 模型诊断",
    "text": "18.9 模型诊断\nsleepstudy\n\nShow the code# 拟合线性混合模型\nmodel &lt;- lme1\n# 1. 残差图\nresiduals &lt;- resid(model)\nfitted &lt;- fitted(model)\nggplot(data.frame(fitted, residuals), aes(fitted, residuals)) +\n  geom_point() +\n  geom_smooth(method = \"loess\", se = FALSE) +\n  labs(title = \"Residuals vs Fitted\", x = \"Fitted values\", y = \"Residuals\")\n\n\n\n\n\n\nShow the code\n# 2. QQ图\nqqnorm(residuals)\nqqline(residuals)\n\n\n\n\n\n\nShow the code\n# 3. Cook's 距离\ncooksd &lt;- cooks.distance(model)\nplot(cooksd, type = \"h\", main = \"Cook's Distance\")\n\n\n\n\n\n\nShow the code\n# 4. 随机效应的分布\nrand_dist &lt;- ranef(model)\n\nqqnorm(rand_dist$Beach$NAP)\nqqline(rand_dist$Beach$NAP)",
    "crumbs": [
      "统计模型",
      "<span class='chapter-number'>18</span>  <span class='chapter-title'>线性混合模型</span>"
    ]
  },
  {
    "objectID": "GLM.html",
    "href": "GLM.html",
    "title": "\n19  广义线性模型\n",
    "section": "",
    "text": "19.1 GLM 组件\n广义线性模型是对线性模型的扩展，适用于非正态分布的数据，假设观测值之间是独立的，不能处理组内相关性。模型形式为：\n\\[\ng(E(Y))=\\mathbf{X} \\beta\n\\]\n\\[\n\\eta = \\mathbf{X} \\beta\n\\]\n\\[\nE(y)=\\mu\n\\]\n\\[\n\\eta =g(\\mu)=g(E(y))\n\\]\n\\[\nE(y)=g^{-1}(\\eta)\n\\]\n典型链接函数",
    "crumbs": [
      "统计模型",
      "<span class='chapter-number'>19</span>  <span class='chapter-title'>广义线性模型</span>"
    ]
  },
  {
    "objectID": "GLM.html#glm-组件",
    "href": "GLM.html#glm-组件",
    "title": "\n19  广义线性模型\n",
    "section": "",
    "text": "线性预测子：\n\n\n\n因变量的期望值与线性预测函数的关系：\n\n\n\n链接函数 g(.) ：\n\n\n\n反链接函数g-1 (.)：\n\n\n\n\ny 的方差：\n\\[\nVar(y)=f(\\mu)=f(g^{-1}(\\mathbf{X}\\beta))\n\\]\n\n\n\n\n\nY的分布\n名称\n链接函数\n均值函数\n\n\n\n正态\n恒等\n\n\n\n\n\n指数 / Gamma\n倒数\n\n\n\n\n泊松\n自然对数\n\n\n\n\n\n二项式\n多项式\n\nLogit",
    "crumbs": [
      "统计模型",
      "<span class='chapter-number'>19</span>  <span class='chapter-title'>广义线性模型</span>"
    ]
  },
  {
    "objectID": "GLM.html#数据来源",
    "href": "GLM.html#数据来源",
    "title": "\n19  广义线性模型\n",
    "section": "\n19.2 数据来源",
    "text": "19.2 数据来源\n数据下载网站\n\nShow the codelibrary(tidyverse)\nlibrary(patchwork)\ndf &lt;- read_csv(\"data/ISLR/Default.csv\")\n\ndf &lt;- df %&gt;% \n    mutate(across(1:2, ~ factor(.x,levels = c(\"No\",\"Yes\"),labels = c(0,1))\n                  )\n           )\nstr(df)\n#&gt; tibble [10,000 × 4] (S3: tbl_df/tbl/data.frame)\n#&gt;  $ default: Factor w/ 2 levels \"0\",\"1\": 1 1 1 1 1 1 1 1 1 1 ...\n#&gt;  $ student: Factor w/ 2 levels \"0\",\"1\": 1 2 1 1 1 2 1 2 1 1 ...\n#&gt;  $ balance: num [1:10000] 730 817 1074 529 786 ...\n#&gt;  $ income : num [1:10000] 44362 12106 31767 35704 38463 ...\n\n# 是否违约 是否学生 余额 收入\nhead(df)\n#&gt; # A tibble: 6 × 4\n#&gt;   default student balance income\n#&gt;   &lt;fct&gt;   &lt;fct&gt;     &lt;dbl&gt;  &lt;dbl&gt;\n#&gt; 1 0       0          730. 44362.\n#&gt; 2 0       1          817. 12106.\n#&gt; 3 0       0         1074. 31767.\n#&gt; 4 0       0          529. 35704.\n#&gt; 5 0       0          786. 38463.\n#&gt; 6 0       1          920.  7492.\ntable(df$default,df$student)\n#&gt;    \n#&gt;        0    1\n#&gt;   0 6850 2817\n#&gt;   1  206  127\n\n\n\nShow the codeggplot(df,aes(balance,income))+\n  geom_point(aes(shape=default,color=default),show.legend = F)|\nggplot(df,aes(default,balance,fill=default),)+\n  geom_boxplot(show.legend = F)+\nggplot(df,aes(default,income,fill=default))+\n  geom_boxplot()",
    "crumbs": [
      "统计模型",
      "<span class='chapter-number'>19</span>  <span class='chapter-title'>广义线性模型</span>"
    ]
  },
  {
    "objectID": "GLM.html#恒等链接线性回归",
    "href": "GLM.html#恒等链接线性回归",
    "title": "\n19  广义线性模型\n",
    "section": "\n19.3 恒等链接线性回归",
    "text": "19.3 恒等链接线性回归\n线性回归是一种简单的线性回归模型，其中假设响应变量服从正态分布，并且使用恒等链接函数（identity link function），t-statistic\n\nShow the codelibrary(tidymodels)\nlibrary(ggfortify)\n# 使用 glm() 函数进行高斯线性回归\nglm_gauss &lt;- linear_reg() %&gt;% \n  set_engine(\"glm\", family = stats::gaussian(link = \"identity\")) %&gt;% \n  fit(as.numeric(default)-1~balance,data=df)\n\n# 查看模型的系数\ntidy(glm_gauss)\n#&gt; # A tibble: 2 × 5\n#&gt;   term         estimate  std.error statistic   p.value\n#&gt;   &lt;chr&gt;           &lt;dbl&gt;      &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;\n#&gt; 1 (Intercept) -0.0752   0.00335        -22.4 1.26e-108\n#&gt; 2 balance      0.000130 0.00000347      37.4 2.77e-286\n\n# 查看模型性能的 AIC 和 Deviance\nglance(glm_gauss) %&gt;% dplyr::select(AIC, deviance)\n#&gt; # A tibble: 1 × 2\n#&gt;      AIC deviance\n#&gt;    &lt;dbl&gt;    &lt;dbl&gt;\n#&gt; 1 -7284.     282.\n\n\n# Change the theme and colour\nautoplot(glm_gauss, which = 1:6, ncol = 2, label.size = 3,\n         colour = \"steelblue\") + theme_bw()\n\n\n\n\n\n\n\n\nShow the codeggplot(df,aes(balance,as.numeric(default)-1))+\n  geom_point(color=\"orange\",size=1.25)+\n  geom_smooth(method = \"lm\",se=FALSE)+\n  geom_hline(yintercept = c(0,1),linetype=2)+\n  ggtitle(\"linear regression\")",
    "crumbs": [
      "统计模型",
      "<span class='chapter-number'>19</span>  <span class='chapter-title'>广义线性模型</span>"
    ]
  },
  {
    "objectID": "GLM.html#逻辑回归",
    "href": "GLM.html#逻辑回归",
    "title": "\n19  广义线性模型\n",
    "section": "\n19.4 逻辑回归",
    "text": "19.4 逻辑回归\n逻辑回归用于处理分类问题。其模型假设响应变量的对数优势（log odds）服从线性模型。\nSigmoid 激活函数：\n\\[\nf(x)=\\frac{1}{1+e^{-x}}=\\frac{e^x}{1+e^x}\n\\]\n\nShow the codesigmoid &lt;- tibble(\n    x=seq(-6,6,length.out=1000),\n    y=1/(1+exp(-x)),\n)\nggplot(sigmoid,aes(x,y))+\n    geom_line()\n\n\n\n\n\n\n\n逻辑回归( logistic regression )的一般表达式：\n\\[\n\\pi(Y=k|X=(X_1,X_2,...,X_p)=\\frac{e^{\\beta_{k0}+\\beta_{k1}X_1+\\beta_{k2}X_2+...+\\beta_{kp}X_p}}{1+\\sum_{l=1}^{K-1} e^{\\beta_{l0}+\\beta_{l1}X_1+\\beta_{l2}X_2+...+\\beta_{lp}X_p}}\n\\] 其中\\(\\pi\\) 是成功概率，\\(k=1,2,...,K-1\\)是因变量的第k个水平，共K 个水平，\\(p\\) 是自变量个数。\nlogit link function\nz-statistic\n\n19.4.1 二分类Binary\n\n\n当\\(K=2\\)时，\\(k=l=p=1\\)即二分类逻辑回归，一般需要引入虚拟变量（哑变量，dummy variable），通常取值为 0或1。\n极大似然法（maximum likelihood），likelihood function：\n\\[\n\\ell (\\beta_0,\\beta_1)=\\prod_{i:y_i=1}\\pi(x_i)\\prod_{i':y_{i'}=0}(1-\\pi(x_{i'}))\n\\]\n\n\n\nShow the codelogit_spec &lt;- logistic_reg() %&gt;%\n  set_engine(\"glm\",family= binomial(link = \"logit\")) \n\n\nlogit_binary_y &lt;- logit_spec %&gt;% fit(default~balance,data=df)\n\nlogit_binary_y %&gt;% glance()\n#&gt; # A tibble: 1 × 8\n#&gt;   null.deviance df.null logLik   AIC   BIC deviance df.residual  nobs\n#&gt;           &lt;dbl&gt;   &lt;int&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt;       &lt;int&gt; &lt;int&gt;\n#&gt; 1         2921.    9999  -798. 1600. 1615.    1596.        9998 10000\n\ntidy(logit_binary_y,  conf.int = TRUE) %&gt;% \n    mutate(\n        z_value = estimate/std.error,\n        Wald_ChiSquare=z_value^2, #  Wald卡方值可以用来检验各个变量系数是否显著 不同于零。 它是通过系数估计的平方除以其标准误差的平方来计算的。即 z值的平方\n        OR = exp(estimate),\n        `OR 95% CI`= sprintf(\"%.3f ~ %3.f\",exp(conf.low),exp(conf.high)),\n    )\n#&gt; # A tibble: 2 × 11\n#&gt;   term         estimate std.error statistic   p.value conf.low conf.high z_value\n#&gt;   &lt;chr&gt;           &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt;   &lt;dbl&gt;\n#&gt; 1 (Intercept) -10.7      0.361        -29.5 3.62e-191 -1.14e+1  -9.97      -29.5\n#&gt; 2 balance       0.00550  0.000220      25.0 1.98e-137  5.08e-3   0.00594    25.0\n#&gt; # ℹ 3 more variables: Wald_ChiSquare &lt;dbl&gt;, OR &lt;dbl&gt;, `OR 95% CI` &lt;chr&gt;\n\n\nggplot(df,aes(balance,as.numeric(default)-1))+\n  geom_point(color=\"orange\",size=1.25)+\n  geom_smooth(method = \"glm\",\n              method.args=list(family=binomial(link = \"logit\")),se=FALSE)+\n  geom_hline(yintercept = c(0,1),linetype=2)+\n  ggtitle(\"binary logistic regression with continuous x\")\n\n\n\n\n\n\n\n\nShow the codelogit_binary_x &lt;- logit_spec %&gt;%fit(default ~ student, data = df)\n\ntidy(logit_binary_x)\n#&gt; # A tibble: 2 × 5\n#&gt;   term        estimate std.error statistic  p.value\n#&gt;   &lt;chr&gt;          &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;\n#&gt; 1 (Intercept)   -3.50     0.0707    -49.6  0       \n#&gt; 2 student1       0.405    0.115       3.52 0.000431\n\n\nggplot(df,aes(student,as.numeric(default)-1))+\n  geom_point(color=\"orange\",size=1.25)+\n  geom_smooth(method = \"glm\",\n              method.args=list(family=binomial(link = \"logit\")),se=FALSE)+\n  geom_hline(yintercept = c(0,1),linetype=2)+\n    scale_y_continuous(\"default\", breaks = c(0,1))+\n  ggtitle(\"binary logistic regression with binary x\")\n\n\n\n\n\n\n\n\n19.4.2 二分类多元逻辑回归\n\n\n当\\(K=2\\)时，\\(k=l=1,p&gt;1\\)即多元逻辑回归（multiple logistic regression）。\n优势（odds）\n\\[\nOdds=\\frac{\\pi(X)}{1-\\pi(X)}=e^{\\beta_0+\\beta_1X_1+\\beta_2X_2+...+\\beta_pX_p}\n\\]\nlog odds (logit)\n\\[\nlogit(\\pi(X))=\\ln (\\frac{\\pi(X)}{1-\\pi(X)})=\\beta_0+\\beta_1X_1+\\beta_2X_2+...+\\beta_pX_p\n\\]\n\n\n\nShow the codelogit_multiple&lt;-logit_spec %&gt;% fit(default~balance+income+student,data=df)\n\ntidy(logit_multiple)\n\n\n\n\nterm\nestimate\nstd.error\nstatistic\np.value\n\n\n\n(Intercept)\n-10.8690452\n0.4922555\n-22.080088\n0.0000000\n\n\nbalance\n0.0057365\n0.0002319\n24.737563\n0.0000000\n\n\nincome\n0.0000030\n0.0000082\n0.369815\n0.7115203\n\n\nstudent1\n-0.6467758\n0.2362525\n-2.737646\n0.0061881\n\n\n\n\n\nShow the code\n# confusion matrix 混淆矩阵\naugment(logit_multiple, new_data = df) %&gt;%\n  conf_mat(truth = default, estimate = .pred_class) %&gt;% \n    autoplot(type = \"heatmap\")\n\n\n\n\n\n\nShow the code\n#准确性 \n(9627+105)/(9627+105+40+228)\n#&gt; [1] 0.9732\naugment(logit_multiple, new_data = df) %&gt;%\n  accuracy(truth = default, estimate = .pred_class)\n\n\n\n\n.metric\n.estimator\n.estimate\n\n\naccuracy\nbinary\n0.9732\n\n\n\n\n\n\nShow the codedf_new &lt;- tibble(\n  balance = c(1000, 2000), \n  income = c(14144,24141),\n  student = factor(c(1, 0)),)\npredict(logit_multiple, new_data = df_new,type=\"class\")\n#&gt; # A tibble: 2 × 1\n#&gt;   .pred_class\n#&gt;   &lt;fct&gt;      \n#&gt; 1 0          \n#&gt; 2 1\npredict(logit_multiple, new_data = df_new, type = \"prob\")\n#&gt; # A tibble: 2 × 2\n#&gt;   .pred_0 .pred_1\n#&gt;     &lt;dbl&gt;   &lt;dbl&gt;\n#&gt; 1   0.997 0.00322\n#&gt; 2   0.337 0.663\n\n\n\n19.4.3 似然比检验\nlikelihood ratio tests (LRT)\n比较两个嵌套模型，log-likelihood (logLL)\n\n相应的p-value 源自具有 个自由度的 卡方 分布（即模型中测试的参数数量之差）。\n\nShow the codelogit_binary_y\n#&gt; parsnip model object\n#&gt; \n#&gt; \n#&gt; Call:  stats::glm(formula = default ~ balance, family = ~binomial(link = \"logit\"), \n#&gt;     data = data)\n#&gt; \n#&gt; Coefficients:\n#&gt; (Intercept)      balance  \n#&gt;  -10.651331     0.005499  \n#&gt; \n#&gt; Degrees of Freedom: 9999 Total (i.e. Null);  9998 Residual\n#&gt; Null Deviance:       2921 \n#&gt; Residual Deviance: 1596  AIC: 1600\nlogit_multiple\n#&gt; parsnip model object\n#&gt; \n#&gt; \n#&gt; Call:  stats::glm(formula = default ~ balance + income + student, family = ~binomial(link = \"logit\"), \n#&gt;     data = data)\n#&gt; \n#&gt; Coefficients:\n#&gt; (Intercept)      balance       income     student1  \n#&gt;  -1.087e+01    5.737e-03    3.033e-06   -6.468e-01  \n#&gt; \n#&gt; Degrees of Freedom: 9999 Total (i.e. Null);  9996 Residual\n#&gt; Null Deviance:       2921 \n#&gt; Residual Deviance: 1572  AIC: 1580\n\n\nLRT=2*(logLik(logit_multiple$fit)-logLik(logit_binary_y$fit))\nLRT\n#&gt; 'log Lik.' 24.90686 (df=4)\n\npval=1-pchisq(LRT,2)\npval\n#&gt; 'log Lik.' 3.904316e-06 (df=4)\n\nout&lt;-anova(logit_binary_y$fit, logit_multiple$fit)\nout\n#&gt; Analysis of Deviance Table\n#&gt; \n#&gt; Model 1: default ~ balance\n#&gt; Model 2: default ~ balance + income + student\n#&gt;   Resid. Df Resid. Dev Df Deviance  Pr(&gt;Chi)    \n#&gt; 1      9998     1596.5                          \n#&gt; 2      9996     1571.5  2   24.907 3.904e-06 ***\n#&gt; ---\n#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\n1-pchisq(out$Deviance[2],2)\n#&gt; [1] 3.904316e-06\n\n\n\n19.4.4 K&gt;2 多分类逻辑回归\n用于处理具有多于两个类别的响应变量的情况。例如，分类问题中的三个或更多类别。\n\n\n当\\(K&gt;2\\)时，\\(k,l,p&gt;1\\)即多项逻辑回归（multinomial logistic regression）。\n\\[\n\\ln (\\frac{P(Y=k|X=x)}{P(Y=K|X=x)})=\\beta_{k0}+\\beta_{k1}X_1+\\beta_{k2}X_2+...+\\beta_{kp}X_p\n\\]\n\n\n\n19.4.4.1 nnet::multinom()\n\n\nShow the codemn_spec &lt;- multinom_reg(mode = \"classification\", engine = \"nnet\")\n\niris_mnlogit &lt;- mn_spec %&gt;% \n    fit(Species ~ ., data = iris)\n\niris_mnlogit %&gt;% glance()\n#&gt; # A tibble: 1 × 4\n#&gt;     edf deviance   AIC  nobs\n#&gt;   &lt;dbl&gt;    &lt;dbl&gt; &lt;dbl&gt; &lt;int&gt;\n#&gt; 1    10     11.9  31.9   150\niris_mnlogit %&gt;% tidy()\n#&gt; # A tibble: 10 × 6\n#&gt;    y.level    term         estimate std.error statistic p.value\n#&gt;    &lt;chr&gt;      &lt;chr&gt;           &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;   &lt;dbl&gt;\n#&gt;  1 versicolor (Intercept)     18.7       35.0    0.534    0.593\n#&gt;  2 versicolor Sepal.Length    -5.46      89.9   -0.0607   0.952\n#&gt;  3 versicolor Sepal.Width     -8.71     157.    -0.0554   0.956\n#&gt;  4 versicolor Petal.Length    14.2       60.2    0.237    0.813\n#&gt;  5 versicolor Petal.Width     -3.10      45.5   -0.0681   0.946\n#&gt;  6 virginica  (Intercept)    -23.8       35.8   -0.666    0.505\n#&gt;  7 virginica  Sepal.Length    -7.92      89.9   -0.0881   0.930\n#&gt;  8 virginica  Sepal.Width    -15.4      157.    -0.0978   0.922\n#&gt;  9 virginica  Petal.Length    23.7       60.5    0.391    0.696\n#&gt; 10 virginica  Petal.Width     15.1       45.9    0.330    0.742\n\n\naugment(iris_mnlogit, new_data = iris) %&gt;%\n    conf_mat(truth = Species, estimate = .pred_class) %&gt;%\n    autoplot(type = \"heatmap\")\n\n\n\n\n\n\n\n\n19.4.4.2 glmnet::glmnet()\n\n\nShow the codelibrary(glmnet) # 多项回归\niris_glmnet &lt;- glmnet(x = iris[, -5], y = iris[, 5], family = \"multinomial\")\niris_glmnet\n#&gt; \n#&gt; Call:  glmnet(x = iris[, -5], y = iris[, 5], family = \"multinomial\") \n#&gt; \n#&gt;     Df  %Dev  Lambda\n#&gt; 1    0  0.00 0.43500\n#&gt; 2    1  6.56 0.39640\n#&gt; 3    1 12.05 0.36110\n#&gt; 4    1 16.73 0.32910\n#&gt; 5    1 20.78 0.29980\n#&gt; 6    2 25.37 0.27320\n#&gt; 7    2 29.66 0.24890\n#&gt; 8    2 33.54 0.22680\n#&gt; 9    2 37.10 0.20670\n#&gt; 10   2 40.40 0.18830\n#&gt; 11   2 43.47 0.17160\n#&gt; 12   3 46.47 0.15630\n#&gt; 13   3 49.57 0.14240\n#&gt; 14   3 52.38 0.12980\n#&gt; 15   3 54.97 0.11830\n#&gt; 16   3 57.36 0.10780\n#&gt; 17   3 59.60 0.09818\n#&gt; 18   3 61.71 0.08946\n#&gt; 19   3 63.72 0.08151\n#&gt; 20   3 65.70 0.07427\n#&gt; 21   3 67.65 0.06767\n#&gt; 22   3 69.54 0.06166\n#&gt; 23   3 71.38 0.05618\n#&gt; 24   3 73.12 0.05119\n#&gt; 25   3 74.71 0.04664\n#&gt; 26   3 76.24 0.04250\n#&gt; 27   3 77.67 0.03872\n#&gt; 28   3 78.99 0.03528\n#&gt; 29   3 80.21 0.03215\n#&gt; 30   3 81.33 0.02929\n#&gt; 31   3 82.36 0.02669\n#&gt; 32   3 83.31 0.02432\n#&gt; 33   3 84.18 0.02216\n#&gt; 34   3 84.99 0.02019\n#&gt; 35   3 85.73 0.01840\n#&gt; 36   3 86.53 0.01676\n#&gt; 37   3 87.34 0.01527\n#&gt; 38   3 88.06 0.01392\n#&gt; 39   3 88.73 0.01268\n#&gt; 40   3 89.34 0.01155\n#&gt; 41   3 89.89 0.01053\n#&gt; 42   3 90.40 0.00959\n#&gt; 43   4 90.87 0.00874\n#&gt; 44   4 91.34 0.00796\n#&gt; 45   4 91.77 0.00726\n#&gt; 46   4 92.16 0.00661\n#&gt; 47   4 92.52 0.00602\n#&gt; 48   4 92.85 0.00549\n#&gt; 49   4 93.16 0.00500\n#&gt; 50   4 93.44 0.00456\n#&gt; 51   4 93.69 0.00415\n#&gt; 52   4 93.92 0.00378\n#&gt; 53   4 94.14 0.00345\n#&gt; 54   4 94.34 0.00314\n#&gt; 55   4 94.52 0.00286\n#&gt; 56   4 94.68 0.00261\n#&gt; 57   4 94.83 0.00238\n#&gt; 58   4 94.97 0.00216\n#&gt; 59   4 95.10 0.00197\n#&gt; 60   4 95.22 0.00180\n#&gt; 61   4 95.33 0.00164\n#&gt; 62   4 95.43 0.00149\n#&gt; 63   4 95.52 0.00136\n#&gt; 64   4 95.60 0.00124\n#&gt; 65   4 95.68 0.00113\n#&gt; 66   4 95.75 0.00103\n#&gt; 67   4 95.81 0.00094\n#&gt; 68   4 95.87 0.00085\n#&gt; 69   4 95.92 0.00078\n#&gt; 70   4 95.97 0.00071\n#&gt; 71   4 96.01 0.00065\n#&gt; 72   4 96.05 0.00059\n#&gt; 73   4 96.09 0.00054\n#&gt; 74   4 96.12 0.00049\n#&gt; 75   4 96.15 0.00045\n#&gt; 76   4 96.18 0.00041\n#&gt; 77   4 96.20 0.00037\n#&gt; 78   4 96.22 0.00034\n#&gt; 79   4 96.24 0.00031\n#&gt; 80   4 96.26 0.00028\n#&gt; 81   4 96.27 0.00025\n#&gt; 82   4 96.29 0.00023\n#&gt; 83   4 96.30 0.00021\n#&gt; 84   4 96.31 0.00019\n#&gt; 85   4 96.32 0.00018\n#&gt; 86   4 96.33 0.00016\n#&gt; 87   4 96.33 0.00015\n#&gt; 88   4 96.34 0.00013\n#&gt; 89   4 96.35 0.00012\n#&gt; 90   4 96.35 0.00011\n#&gt; 91   4 96.35 0.00010\n#&gt; 92   4 96.36 0.00009\n#&gt; 93   4 96.36 0.00008\n#&gt; 94   4 96.36 0.00008\n#&gt; 95   4 96.37 0.00007\n#&gt; 96   4 96.37 0.00006\n#&gt; 97   4 96.37 0.00006\n#&gt; 98   4 96.37 0.00005\n#&gt; 99   4 96.38 0.00005\n#&gt; 100  4 96.38 0.00004\nsummary(iris_glmnet )\n#&gt;            Length Class  Mode     \n#&gt; a0         300    -none- numeric  \n#&gt; beta         3    -none- list     \n#&gt; dfmat      300    -none- numeric  \n#&gt; df         100    -none- numeric  \n#&gt; dim          2    -none- numeric  \n#&gt; lambda     100    -none- numeric  \n#&gt; dev.ratio  100    -none- numeric  \n#&gt; nulldev      1    -none- numeric  \n#&gt; npasses      1    -none- numeric  \n#&gt; jerr         1    -none- numeric  \n#&gt; offset       1    -none- logical  \n#&gt; classnames   3    -none- character\n#&gt; grouped      1    -none- logical  \n#&gt; call         4    -none- call     \n#&gt; nobs         1    -none- numeric\nplot(iris_glmnet)\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nShow the codeplot(iris_glmnet$lambda,\n  ylab = expression(lambda), xlab = \"迭代次数\", main = \"惩罚系数的迭代路径\"\n)\n\n\n\n\n\n\nShow the code\n# 选择一个迭代趋于稳定时的 lambda，比如 iris_glmnet$lambda[80]\ncoef(iris_glmnet, s = 0.0002796185)\n#&gt; $setosa\n#&gt; 5 x 1 sparse Matrix of class \"dgCMatrix\"\n#&gt;                      1\n#&gt; (Intercept)  17.015429\n#&gt; Sepal.Length  .       \n#&gt; Sepal.Width   4.486992\n#&gt; Petal.Length -3.250342\n#&gt; Petal.Width  -3.315393\n#&gt; \n#&gt; $versicolor\n#&gt; 5 x 1 sparse Matrix of class \"dgCMatrix\"\n#&gt;                     1\n#&gt; (Intercept)  8.132656\n#&gt; Sepal.Length 2.123980\n#&gt; Sepal.Width  .       \n#&gt; Petal.Length .       \n#&gt; Petal.Width  .       \n#&gt; \n#&gt; $virginica\n#&gt; 5 x 1 sparse Matrix of class \"dgCMatrix\"\n#&gt;                       1\n#&gt; (Intercept)  -25.148085\n#&gt; Sepal.Length   .       \n#&gt; Sepal.Width   -5.176029\n#&gt; Petal.Length   7.536940\n#&gt; Petal.Width   14.481524\n\niris_pred_glmnet &lt;- predict(\n  object = iris_glmnet, newx = as.matrix(iris[, -5]),\n  s = 0.0002796185, type = \"class\"\n)\n\n\n\nShow the codemn_spec &lt;- multinom_reg(mode = \"classification\", engine = \"glmnet\" ,penalty = tune())\n\niris_mnlogit &lt;- mn_spec %&gt;% \n    fit(Species ~ ., data = iris)\niris_mnlogit %&gt;% glance()\n#&gt; # A tibble: 1 × 3\n#&gt;   nulldev npasses  nobs\n#&gt;     &lt;dbl&gt;   &lt;int&gt; &lt;int&gt;\n#&gt; 1    330.    6546   150\niris_mnlogit$fit %&gt;% tidy() %&gt;% DT::datatable()\n\n\n\n\n\n\n19.4.5 有序逻辑回归\n\\[\n    \\ln \\left(\\frac{P(Y\\le k|X=x)}{1-P(Y\\le k|X=x)}\\right)\n\\]\n\nShow the codeacl &lt;- read_rds(\"data/icpsr/advanced_acl_data.rds\")\nacl$PhysActCat_W1 &lt;- factor(acl$PhysActCat_W1,ordered = T)\nstr(acl$PhysActCat_W1)\n#&gt;  Ord.factor w/ 5 levels \"(1) Low_5th\"&lt;..: 1 3 5 3 2 2 3 1 4 5 ...\n\nordered_logit &lt;- MASS::polr(PhysActCat_W1 ~ SelfEfficacy_W1, data = acl,\n                            method = \"logistic\")\nordered_logit %&gt;% summary()\n#&gt; Call:\n#&gt; MASS::polr(formula = PhysActCat_W1 ~ SelfEfficacy_W1, data = acl, \n#&gt;     method = \"logistic\")\n#&gt; \n#&gt; Coefficients:\n#&gt;                  Value Std. Error t value\n#&gt; SelfEfficacy_W1 0.2431    0.02893   8.404\n#&gt; \n#&gt; Intercepts:\n#&gt;                           Value    Std. Error t value \n#&gt; (1) Low_5th|(2) 2Low_5th   -0.9332   0.0371   -25.1533\n#&gt; (2) 2Low_5th|(3) 3Low_5th  -0.2688   0.0338    -7.9606\n#&gt; (3) 3Low_5th|(4) 4Low_5th   0.8470   0.0364    23.2527\n#&gt; (4) 4Low_5th|(5) Hi_5th     1.5298   0.0435    35.1647\n#&gt; \n#&gt; Residual Deviance: 11196.86 \n#&gt; AIC: 11206.86\n\npredict(ordered_logit ,acl ,type = \"prob\") %&gt;% \n    as_tibble() %&gt;% \n    DT::datatable()\n\n\n\n\nShow the code\npredict(ordered_logit ,acl ,type = \"class\") %&gt;% \n    as_tibble() %&gt;% \n    DT::datatable()",
    "crumbs": [
      "统计模型",
      "<span class='chapter-number'>19</span>  <span class='chapter-title'>广义线性模型</span>"
    ]
  },
  {
    "objectID": "GLM.html#泊松回归",
    "href": "GLM.html#泊松回归",
    "title": "\n19  广义线性模型\n",
    "section": "\n19.5 泊松回归",
    "text": "19.5 泊松回归\n泊松回归用于计数数据，假设响应变量服从泊松分布，并使用对数链接函数（log link function），z-statistic\nfamily=poisson(link = \"log\")\nfamily = quasipoisson(link = \"log\"))\n\\[\nP(X=x;\\lambda)=\\frac{e^{-\\lambda}\\lambda ^x}{x!}\n\\]\n\nShow the codeggplot(tibble(x=0:20,\n              y1=dpois(x,lambda = 2),\n              y2=dpois(x,lambda = 6),\n              ),\n       aes(x)\n       )+\n    geom_col(aes(y=y1),fill = \"lightblue\")+\n    geom_col(aes(y=y2),fill = \"yellow\",alpha=.3)+\n    ylab(\"Poisson Density\")\n\n\n\n\n\n\n\n\nShow the codelibrary(poissonreg)\ndf2 &lt;- read_csv(\"data/ISLR/Bikeshare.csv\")\n\n\n\nShow the code# 泊松回归模型\npois_spec &lt;- poisson_reg() %&gt;% \n  set_mode(\"regression\") %&gt;% \n  set_engine(\"glm\",family=poisson(link = \"log\"))\n\npois_rec_spec &lt;- recipe(bikers ~ mnth + hr + workingday + temp + weathersit, data = df2) %&gt;% \n    step_dummy(all_nominal_predictors()) # 虚拟变量\n\npois_wf &lt;- workflow() %&gt;% \n  add_recipe(pois_rec_spec) %&gt;% \n  add_model(pois_spec)\n\npois_fit &lt;- pois_wf %&gt;% fit(data = df2)\n\n\ntidy(pois_fit)\n#&gt; # A tibble: 18 × 5\n#&gt;    term                       estimate std.error statistic   p.value\n#&gt;    &lt;chr&gt;                         &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;\n#&gt;  1 (Intercept)                 3.01     0.00632     477.   0        \n#&gt;  2 hr                          0.0507   0.000144    352.   0        \n#&gt;  3 workingday                 -0.0128   0.00195      -6.57 4.91e- 11\n#&gt;  4 temp                        2.56     0.00995     258.   0        \n#&gt;  5 mnth_Aug                   -0.229    0.00470     -48.7  0        \n#&gt;  6 mnth_Dec                    0.298    0.00501      59.5  0        \n#&gt;  7 mnth_Feb                   -0.102    0.00592     -17.2  5.28e- 66\n#&gt;  8 mnth_Jan                   -0.145    0.00678     -21.4  1.74e-101\n#&gt;  9 mnth_July                  -0.378    0.00496     -76.2  0        \n#&gt; 10 mnth_June                  -0.150    0.00462     -32.5  1.32e-231\n#&gt; 11 mnth_March                 -0.0312   0.00534      -5.83 5.44e-  9\n#&gt; 12 mnth_May                    0.0508   0.00434      11.7  1.43e- 31\n#&gt; 13 mnth_Nov                    0.285    0.00461      61.8  0        \n#&gt; 14 mnth_Oct                    0.267    0.00432      61.7  0        \n#&gt; 15 mnth_Sept                  -0.00653  0.00443      -1.47 1.41e-  1\n#&gt; 16 weathersit_cloudy.misty    -0.0308   0.00216     -14.2  5.70e- 46\n#&gt; 17 weathersit_heavy.rain.snow -0.646    0.167        -3.87 1.08e-  4\n#&gt; 18 weathersit_light.rain.snow -0.473    0.00404    -117.   0\n\n\n# 绘制实际值与预测值的关系图\naugment(pois_fit, new_data = df2, type = \"response\") %&gt;%\n    ggplot(aes(bikers, .pred)) +\n    geom_point(alpha = 0.1) +\n    geom_abline(slope = 1,\n                linewidth = 1,\n                color = \"grey40\") +\n    labs(title = \"Predicting the number of bikers per hour using Poission Regression\", x = \"Actual\", y = \"Predicted\")\n\n\n\n\n\n\n\n\nShow the codepois_fit_coef_mnths &lt;- \n  tidy(pois_fit) %&gt;% \n  dplyr::filter(grepl(\"^mnth\", term)) %&gt;% \n  mutate(\n    term = stringr::str_replace(term, \"mnth_\", \"\"),\n    term = forcats::fct_inorder(term)\n  ) \n\npois_fit_coef_mnths %&gt;% \n  ggplot(aes(term, estimate)) +\n  geom_line(group = 1,na.rm = TRUE) +\n  geom_point(shape = 21, size = 3, stroke = 1.5, \n             fill = \"black\", color = \"white\",na.rm = TRUE) +\n  labs(title = \"Coefficient value from Poission Regression\",\n       x = \"Month\", y = \"Coefficient\")\n\n\n\n\n\n\n\n\nShow the codepois_acl &lt;- pois_spec %&gt;% \n    fit(NChronic12_W1 ~ SelfEfficacy_W1,data = acl)\n\npois_acl %&gt;% glance()\n#&gt; # A tibble: 1 × 8\n#&gt;   null.deviance df.null logLik    AIC    BIC deviance df.residual  nobs\n#&gt;           &lt;dbl&gt;   &lt;int&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;    &lt;dbl&gt;       &lt;int&gt; &lt;int&gt;\n#&gt; 1         5217.    3616 -5161. 10327. 10339.    5114.        3615  3617\n\npois_acl %&gt;% tidy()\n#&gt; # A tibble: 2 × 5\n#&gt;   term            estimate std.error statistic  p.value\n#&gt;   &lt;chr&gt;              &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;\n#&gt; 1 (Intercept)       0.0713    0.0162      4.40 1.06e- 5\n#&gt; 2 SelfEfficacy_W1  -0.150     0.0144    -10.4  3.97e-25\n\nAIC(pois_acl$fit)\n#&gt; [1] 10326.52\nBIC(pois_acl$fit)\n#&gt; [1] 10338.9",
    "crumbs": [
      "统计模型",
      "<span class='chapter-number'>19</span>  <span class='chapter-title'>广义线性模型</span>"
    ]
  },
  {
    "objectID": "GLM.html#负二项回归",
    "href": "GLM.html#负二项回归",
    "title": "\n19  广义线性模型\n",
    "section": "\n19.6 负二项回归",
    "text": "19.6 负二项回归\n负二项回归用于处理计数数据且存在过度离散（overdispersion）的问题即当均值不等于方差。\nlog link function，z-statistic\nprobability mass function ：\n\\[\nP(X=x;\\lambda,\\nu)=\\binom{x+\\nu - 1}{ x} \\left ( \\frac{\\lambda}{\\lambda +\\nu} \\right)^x \\left ( \\frac{\\nu}{\\nu + \\lambda} \\right)^{\\nu}\n\\]\n负二项分布的均值是 \\(\\lambda\\) ，\n方差是 \\(\\lambda + \\frac{\\lambda ^2}{\\nu}\\) 。\n\nShow the codelibrary(MASS)\n# 负二项回归模型\nnb_spec &lt;- linear_reg() %&gt;% \n  set_engine(\"glm\", family = MASS::negative.binomial(theta = 1, link = \"log\"))\n\nnb_acl &lt;- nb_spec %&gt;% \n  fit(NChronic12_W1 ~ SelfEfficacy_W1, data = acl)\n\n# 查看模型结果\nnb_acl %&gt;% glance()\n#&gt; # A tibble: 1 × 8\n#&gt;   null.deviance df.null logLik    AIC    BIC deviance df.residual  nobs\n#&gt;           &lt;dbl&gt;   &lt;int&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;    &lt;dbl&gt;       &lt;int&gt; &lt;int&gt;\n#&gt; 1         2946.    3616 -5220. 10443. 10456.    2898.        3615  3617\nnb_acl %&gt;% tidy()\n#&gt; # A tibble: 2 × 5\n#&gt;   term            estimate std.error statistic  p.value\n#&gt;   &lt;chr&gt;              &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;\n#&gt; 1 (Intercept)       0.0715    0.0181      3.95 8.10e- 5\n#&gt; 2 SelfEfficacy_W1  -0.148     0.0169     -8.75 3.18e-18\n\n\nAIC(nb_acl$fit)\n#&gt; [1] 10443.43\nBIC(nb_acl$fit)\n#&gt; [1] 10455.82\n\n# MASS::glm.nb()",
    "crumbs": [
      "统计模型",
      "<span class='chapter-number'>19</span>  <span class='chapter-title'>广义线性模型</span>"
    ]
  },
  {
    "objectID": "GLM.html#零膨胀模型zero-inflated",
    "href": "GLM.html#零膨胀模型zero-inflated",
    "title": "\n19  广义线性模型\n",
    "section": "\n19.7 零膨胀模型（zero-inflated）",
    "text": "19.7 零膨胀模型（zero-inflated）\n逻辑回归+以上之一",
    "crumbs": [
      "统计模型",
      "<span class='chapter-number'>19</span>  <span class='chapter-title'>广义线性模型</span>"
    ]
  },
  {
    "objectID": "GLM.html#正则化广义线性模型",
    "href": "GLM.html#正则化广义线性模型",
    "title": "\n19  广义线性模型\n",
    "section": "\n19.8 正则化广义线性模型",
    "text": "19.8 正则化广义线性模型\nRidge、Lasso\n\nShow the codelibrary(glmnet)\ndata(QuickStartExample)\nfit &lt;- glmnet::glmnet(x = QuickStartExample$x, y = QuickStartExample$y)\nautoplot(fit)\n\n\n\n\n\n\nShow the code\nfit &lt;- glmnet::cv.glmnet(x = QuickStartExample$x, y = QuickStartExample$y)\nautoplot(fit, colour = 'blue')",
    "crumbs": [
      "统计模型",
      "<span class='chapter-number'>19</span>  <span class='chapter-title'>广义线性模型</span>"
    ]
  },
  {
    "objectID": "GEE.html",
    "href": "GEE.html",
    "title": "\n20  广义估计方程\n",
    "section": "",
    "text": "20.1 数据集处理\n数据集 Analyzing ecological data\nShow the coderfb &lt;- read_delim(\"data/AED/RiceFieldBirds.txt\")\nrfb$richness &lt;- rowSums(rfb[, 8:56] &gt; 0)\nrfb |&gt; mutate(\n    FIELD = factor(FIELD),\n    SPTREAT = factor(SPTREAT),\n    log_AREA = log(rfb$AREA),\n    DEPTH2 = DEPTH ^ 2,\n    .after = 4\n) -&gt; rfb\n\n\nggplot(rfb, aes(Time, richness)) +\n    geom_point(pch = 21) +\n    geom_smooth(method = \"loess\", se = F) +\n    facet_wrap(vars(FIELD), labeller = \"label_both\")\nShow the codeowls &lt;- read_delim(\"data/AED/Owls.txt\")\n\nowls |&gt;\n    mutate(NCalls = SiblingNegotiation, log_broodsize = log(BroodSize), ) -&gt;\n    owls\nShow the codede &lt;- read_delim(\"data/AED/DeerEcervi.txt\")\n\nde |&gt;\n    mutate(\n        Ecervi_binary = if_else(Ecervi &gt; 0, 1, Ecervi),\n        Sex = factor(Sex),\n        Length_center = scale(Length, center = T , scale = F),\n    ) -&gt; de",
    "crumbs": [
      "统计模型",
      "<span class='chapter-number'>20</span>  <span class='chapter-title'>广义估计方程</span>"
    ]
  },
  {
    "objectID": "GEE.html#glm-连接函数",
    "href": "GEE.html#glm-连接函数",
    "title": "\n20  广义估计方程\n",
    "section": "\n20.2 GLM 连接函数",
    "text": "20.2 GLM 连接函数\nGLM的形式如下：\n\\[ g(\\mu_{ij})=\\beta_0+\\beta_1x_{ij_1}+\\beta_2x_{ij_2}+...+\\beta_px_{ij_p} \\]\n其中，g() 是一个连接函数，用于将自变量的线性组合与因变量的均值联系起来。常见的连接函数包括恒等连接函数（identity）、logistic连接函数（logit）、逆正弦连接函数（inverse sine）函数等。i 表示观测对象的索引，j 表示时间点或相关性结构的索引，uij 表示因变量的均值，β 表示待估计的系数，Xij 表示自变量。\n\\[\n\\eta = \\beta  \\mathbf{X}+ \\alpha\n\\]\n\\[\nE(y)=g^{-1}(\\eta)\n\\]\n对于计数数据：\n\\[\nE(y)=e^{\\eta}=e^{\\beta \\mathbf{X} +\\alpha}, 此时g(\\mu)=\\ln(\\mu)=\\mathbf{X}\\beta\n\\]\n\nShow the coderfb_glm &lt;- glm(richness ~ offset(log_AREA) +SPTREAT + DEPTH +DEPTH2,\n            family = quasipoisson(link = \"log\"),\n            data = rfb)\n\nowls_glm &lt;- glm(\n    NCalls ~ offset(log_broodsize) + SexParent * FoodTreatment + SexParent *\n        ArrivalTime,\n    family = poisson(link = \"log\"),\n    data = owls\n)\n\n\n对于二分类数据：\n\\[\nE(y)=\\frac{e^{\\beta \\mathbf{X} +\\alpha}}{1+e^{\\beta\\mathbf{X}+\\alpha}}, 此时g(\\mu)=\\ln(\\frac{\\mu}{1-\\mu})=logit(\\mu)\n\\]\n\nShow the codede_glm &lt;- glm(Ecervi_binary ~ Length_center *Sex,\n              family = binomial(link = \"logit\"),\n              data = de)\nsummary(de_glm)\n#&gt; \n#&gt; Call:\n#&gt; glm(formula = Ecervi_binary ~ Length_center * Sex, family = binomial(link = \"logit\"), \n#&gt;     data = de)\n#&gt; \n#&gt; Coefficients:\n#&gt;                    Estimate Std. Error z value Pr(&gt;|z|)    \n#&gt; (Intercept)        0.652409   0.109602   5.953 2.64e-09 ***\n#&gt; Length_center      0.025112   0.005576   4.504 6.68e-06 ***\n#&gt; Sex2               0.163873   0.174235   0.941   0.3469    \n#&gt; Length_center:Sex2 0.020109   0.009722   2.068   0.0386 *  \n#&gt; ---\n#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n#&gt; \n#&gt; (Dispersion parameter for binomial family taken to be 1)\n#&gt; \n#&gt;     Null deviance: 1073.1  on 825  degrees of freedom\n#&gt; Residual deviance: 1003.7  on 822  degrees of freedom\n#&gt; AIC: 1011.7\n#&gt; \n#&gt; Number of Fisher Scoring iterations: 4",
    "crumbs": [
      "统计模型",
      "<span class='chapter-number'>20</span>  <span class='chapter-title'>广义估计方程</span>"
    ]
  },
  {
    "objectID": "GEE.html#方差",
    "href": "GEE.html#方差",
    "title": "\n20  广义估计方程\n",
    "section": "\n20.3 方差",
    "text": "20.3 方差\n\\[\nvar(Y_{is}|X_{is})=\\Phi × \\nu(\\mu_{is})\n\\]\n其中，Φ 是scale parameter （overdispersion），v() 是方差函数。",
    "crumbs": [
      "统计模型",
      "<span class='chapter-number'>20</span>  <span class='chapter-title'>广义估计方程</span>"
    ]
  },
  {
    "objectID": "GEE.html#相关性结构",
    "href": "GEE.html#相关性结构",
    "title": "\n20  广义估计方程\n",
    "section": "\n20.4 相关性结构",
    "text": "20.4 相关性结构\nR(α)\n\n非结构化相关：cor(Yis,Yit)=αst\n自回归相关：cor(Yis,Yit)=α|s-t|\nexchangeable 等相关：cor(Yis,Yit)=α\nindependence，独立，cor(Yis,Yit)=I",
    "crumbs": [
      "统计模型",
      "<span class='chapter-number'>20</span>  <span class='chapter-title'>广义估计方程</span>"
    ]
  },
  {
    "objectID": "GEE.html#gee",
    "href": "GEE.html#gee",
    "title": "\n20  广义估计方程\n",
    "section": "\n20.5 GEE",
    "text": "20.5 GEE\nGLM的期望和方差：\n\\[ E(Y_{ij})=b'(\\theta_{ij})\\\\ Var(Y_{ij})=b''(\\theta_{ij})\\ \\Phi \\]\n假定潜在的随机成分Vi ：\n\\[\nV_i=A_i^{1/2}R(\\alpha)A_i^{1/2}\\ \\Phi\n\\]\n其中，Ai =diag（b''(θi1)，...，b''(θij)） 。\nGEE的形式如下：\n\\[\nU(\\beta)=\\sum_{i=1}^{n} D'_iV_i^{-1}(y_i-\\mu_i)=0\n\\]\n其中，$U(β) $是一个包含待估计参数的函数，quasi-deviance \\(D'_i = \\left(\\frac{\\partial \\mu_i}{\\partial \\beta}\\right)'\\)，\\(V_i\\) 是方差-协方差矩阵，\\(R(\\alpha)\\) 是相关性结构矩阵，y 是观测数据，μ 是模型的均值预测值。采用迭代重复加权最小二乘法（iteratively reweighted least squares ，IWLS)），偏微分方程估计参数。",
    "crumbs": [
      "统计模型",
      "<span class='chapter-number'>20</span>  <span class='chapter-title'>广义估计方程</span>"
    ]
  },
  {
    "objectID": "GEE.html#gee-1",
    "href": "GEE.html#gee-1",
    "title": "\n20  广义估计方程\n",
    "section": "\n20.6 gee\n",
    "text": "20.6 gee\n\nhttps://www.statsmodels.org/stable//gee.html\n\nShow the codedata(epil,package = \"MASS\")\nOxboys |&gt; head(n=18)\n\n\n\n\nSubject\nage\nheight\nOccasion\n\n\n\n1\n-1.0000\n140.5\n1\n\n\n1\n-0.7479\n143.4\n2\n\n\n1\n-0.4630\n144.8\n3\n\n\n1\n-0.1643\n147.1\n4\n\n\n1\n-0.0027\n147.7\n5\n\n\n1\n0.2466\n150.2\n6\n\n\n1\n0.5562\n151.7\n7\n\n\n1\n0.7781\n153.3\n8\n\n\n1\n0.9945\n155.8\n9\n\n\n2\n-1.0000\n136.9\n1\n\n\n2\n-0.7479\n139.1\n2\n\n\n2\n-0.4630\n140.1\n3\n\n\n2\n-0.1643\n142.6\n4\n\n\n2\n-0.0027\n143.2\n5\n\n\n2\n0.2466\n144.0\n6\n\n\n2\n0.5562\n145.8\n7\n\n\n2\n0.7781\n146.8\n8\n\n\n2\n0.9945\n148.3\n9\n\n\n\n\n\nShow the code\n\ndf_long &lt;- Oxboys\n\n\n\nShow the codelibrary(gee)\n\ng1 &lt;- gee(height~age,data = df_long ,id = Subject,corstr = \"AR-M\",Mv = 1)\n#&gt; (Intercept)         age \n#&gt;  149.371801    6.521022\ng1\n#&gt; \n#&gt;  GEE:  GENERALIZED LINEAR MODELS FOR DEPENDENT DATA\n#&gt;  gee S-function, version 4.13 modified 98/01/27 (1998) \n#&gt; \n#&gt; Model:\n#&gt;  Link:                      Identity \n#&gt;  Variance to Mean Relation: Gaussian \n#&gt;  Correlation Structure:     AR-M , M = 1 \n#&gt; \n#&gt; Call:\n#&gt; gee(formula = height ~ age, id = Subject, data = df_long, corstr = \"AR-M\", \n#&gt;     Mv = 1)\n#&gt; \n#&gt; Number of observations :  234 \n#&gt; \n#&gt; Maximum cluster size   :  9 \n#&gt; \n#&gt; \n#&gt; Coefficients:\n#&gt; (Intercept)         age \n#&gt;  149.719096    6.547328 \n#&gt; \n#&gt; Estimated Scale Parameter:  65.41743\n#&gt; Number of Iterations:  2\n#&gt; \n#&gt; Working Correlation[1:4,1:4]\n#&gt;           [,1]      [,2]      [,3]      [,4]\n#&gt; [1,] 1.0000000 0.9892949 0.9787045 0.9682274\n#&gt; [2,] 0.9892949 1.0000000 0.9892949 0.9787045\n#&gt; [3,] 0.9787045 0.9892949 1.0000000 0.9892949\n#&gt; [4,] 0.9682274 0.9787045 0.9892949 1.0000000\n#&gt; \n#&gt; \n#&gt; Returned Error Value:\n#&gt; [1] 0\nsummary(g1)\n#&gt; \n#&gt;  GEE:  GENERALIZED LINEAR MODELS FOR DEPENDENT DATA\n#&gt;  gee S-function, version 4.13 modified 98/01/27 (1998) \n#&gt; \n#&gt; Model:\n#&gt;  Link:                      Identity \n#&gt;  Variance to Mean Relation: Gaussian \n#&gt;  Correlation Structure:     AR-M , M = 1 \n#&gt; \n#&gt; Call:\n#&gt; gee(formula = height ~ age, id = Subject, data = df_long, corstr = \"AR-M\", \n#&gt;     Mv = 1)\n#&gt; \n#&gt; Summary of Residuals:\n#&gt;         Min          1Q      Median          3Q         Max \n#&gt; -22.0304139  -5.4912438   0.1324571   4.3822174  18.5695861 \n#&gt; \n#&gt; \n#&gt; Coefficients:\n#&gt;               Estimate Naive S.E.  Naive z Robust S.E. Robust z\n#&gt; (Intercept) 149.719096  1.5531285 96.39840   1.5847569 94.47449\n#&gt; age           6.547328  0.3177873 20.60286   0.3042478 21.51972\n#&gt; \n#&gt; Estimated Scale Parameter:  65.41743\n#&gt; Number of Iterations:  2\n#&gt; \n#&gt; Working Correlation\n#&gt;            [,1]      [,2]      [,3]      [,4]      [,5]      [,6]      [,7]\n#&gt;  [1,] 1.0000000 0.9892949 0.9787045 0.9682274 0.9578625 0.9476085 0.9374643\n#&gt;  [2,] 0.9892949 1.0000000 0.9892949 0.9787045 0.9682274 0.9578625 0.9476085\n#&gt;  [3,] 0.9787045 0.9892949 1.0000000 0.9892949 0.9787045 0.9682274 0.9578625\n#&gt;  [4,] 0.9682274 0.9787045 0.9892949 1.0000000 0.9892949 0.9787045 0.9682274\n#&gt;  [5,] 0.9578625 0.9682274 0.9787045 0.9892949 1.0000000 0.9892949 0.9787045\n#&gt;  [6,] 0.9476085 0.9578625 0.9682274 0.9787045 0.9892949 1.0000000 0.9892949\n#&gt;  [7,] 0.9374643 0.9476085 0.9578625 0.9682274 0.9787045 0.9892949 1.0000000\n#&gt;  [8,] 0.9274287 0.9374643 0.9476085 0.9578625 0.9682274 0.9787045 0.9892949\n#&gt;  [9,] 0.9175005 0.9274287 0.9374643 0.9476085 0.9578625 0.9682274 0.9787045\n#&gt;            [,8]      [,9]\n#&gt;  [1,] 0.9274287 0.9175005\n#&gt;  [2,] 0.9374643 0.9274287\n#&gt;  [3,] 0.9476085 0.9374643\n#&gt;  [4,] 0.9578625 0.9476085\n#&gt;  [5,] 0.9682274 0.9578625\n#&gt;  [6,] 0.9787045 0.9682274\n#&gt;  [7,] 0.9892949 0.9787045\n#&gt;  [8,] 1.0000000 0.9892949\n#&gt;  [9,] 0.9892949 1.0000000\n\n\ngee1 &lt;- gee(y ~ age + trt + base,id=subject,data = epil,family = poisson,corstr =\"exchangeable\" )\n#&gt;  (Intercept)          age trtprogabide         base \n#&gt;   0.57304359   0.02234757  -0.15188049   0.02263524\nsummary(gee1)\n#&gt; \n#&gt;  GEE:  GENERALIZED LINEAR MODELS FOR DEPENDENT DATA\n#&gt;  gee S-function, version 4.13 modified 98/01/27 (1998) \n#&gt; \n#&gt; Model:\n#&gt;  Link:                      Logarithm \n#&gt;  Variance to Mean Relation: Poisson \n#&gt;  Correlation Structure:     Exchangeable \n#&gt; \n#&gt; Call:\n#&gt; gee(formula = y ~ age + trt + base, id = subject, data = epil, \n#&gt;     family = poisson, corstr = \"exchangeable\")\n#&gt; \n#&gt; Summary of Residuals:\n#&gt;        Min         1Q     Median         3Q        Max \n#&gt; -15.742906  -3.318756  -1.186874   1.295122  63.957902 \n#&gt; \n#&gt; \n#&gt; Coefficients:\n#&gt;                 Estimate  Naive S.E.   Naive z Robust S.E.   Robust z\n#&gt; (Intercept)   0.57304359 0.451797966  1.268362 0.360726141  1.5885835\n#&gt; age           0.02234757 0.013412798  1.666138 0.011400956  1.9601489\n#&gt; trtprogabide -0.15188049 0.159304397 -0.953398 0.171051111 -0.8879246\n#&gt; base          0.02263524 0.001696439 13.342795 0.001226748 18.4514092\n#&gt; \n#&gt; Estimated Scale Parameter:  5.087384\n#&gt; Number of Iterations:  1\n#&gt; \n#&gt; Working Correlation\n#&gt;           [,1]      [,2]      [,3]      [,4]\n#&gt; [1,] 1.0000000 0.3933815 0.3933815 0.3933815\n#&gt; [2,] 0.3933815 1.0000000 0.3933815 0.3933815\n#&gt; [3,] 0.3933815 0.3933815 1.0000000 0.3933815\n#&gt; [4,] 0.3933815 0.3933815 0.3933815 1.0000000",
    "crumbs": [
      "统计模型",
      "<span class='chapter-number'>20</span>  <span class='chapter-title'>广义估计方程</span>"
    ]
  },
  {
    "objectID": "GEE.html#geepack",
    "href": "GEE.html#geepack",
    "title": "\n20  广义估计方程\n",
    "section": "\n20.7 geepack\n",
    "text": "20.7 geepack\n\n\nShow the codelibrary(geepack)\n\nrfb_gee &lt;- geeglm(richness ~ offset(log_AREA) +SPTREAT + DEPTH +DEPTH2,\n            family = poisson(link = \"log\"),\n            data = rfb,\n            id=FIELD,\n            corstr = \"ar1\")\n\nsummary(rfb_gee)\n#&gt; \n#&gt; Call:\n#&gt; geeglm(formula = richness ~ offset(log_AREA) + SPTREAT + DEPTH + \n#&gt;     DEPTH2, family = poisson(link = \"log\"), data = rfb, id = FIELD, \n#&gt;     corstr = \"ar1\")\n#&gt; \n#&gt;  Coefficients:\n#&gt;                Estimate    Std.err  Wald Pr(&gt;|W|)   \n#&gt; (Intercept)  -0.6782034  0.2610088 6.752  0.00937 **\n#&gt; SPTREATrlfld -0.5223137  0.2287644 5.213  0.02242 * \n#&gt; DEPTH         0.0498238  0.0193149 6.654  0.00989 **\n#&gt; DEPTH2       -0.0011411  0.0004908 5.406  0.02007 * \n#&gt; ---\n#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n#&gt; \n#&gt; Correlation structure = ar1 \n#&gt; Estimated Scale Parameters:\n#&gt; \n#&gt;             Estimate Std.err\n#&gt; (Intercept)    2.334  0.2927\n#&gt;   Link = identity \n#&gt; \n#&gt; Estimated Correlation Parameters:\n#&gt;       Estimate Std.err\n#&gt; alpha   0.4215 0.09034\n#&gt; Number of clusters:   11  Maximum cluster size: 10\nrfb_gee2 &lt;- geeglm(richness ~ offset(log_AREA) +SPTREAT ,\n            family = poisson(link = \"log\"),\n            data = rfb,\n            id=FIELD,\n            corstr = \"ar1\")\n\n# Wald's Test\nanova(rfb_gee,rfb_gee2)\n\n\n\n\nDf\nX2\nP(&gt;|Chi|)\n\n\n2\n6.885\n0.032\n\n\n\n\n\n\\[\nE(Y_{is})=\\mu_{is}=e^{-0.678+0.0498×DEPTH-0.001×DEPTH^2-0.522×SPTREAT_{is}}\\\\\nvar(Y_{is})= 2.33 × \\mu_{is} \\\\\ncor(Y_{is},Y_{it})=0.422^{|s-t|}\n\\]\n作业相关矩阵 corstr ，比较QIC，一般越小越好。\n\nShow the codeQIC(rfb_gee)\n#&gt;       QIC      QICu Quasi Lik       CIC    params      QICC \n#&gt;  -467.536  -471.921   239.961     6.193     4.000  -455.536\nQIC(rfb_gee2)\n#&gt;       QIC      QICu Quasi Lik       CIC    params      QICC \n#&gt;  -451.065  -457.436   230.718     5.185     2.000  -447.637\n\n\n\n20.7.1 示例\n\nShow the codedf &lt;- read_delim(\"data/麻醉诱导时相.txt\")\ndf_long &lt;- df |&gt; pivot_longer(\n    cols = starts_with(\"t\"),\n    names_to = \"time\",\n    values_to = \"SBP\"\n)\n\n\n\nShow the codeg3 &lt;- geeglm(SBP~ group * time,data = df_long ,id = id,corstr = \"ar1\")\n\ng3\n#&gt; \n#&gt; Call:\n#&gt; geeglm(formula = SBP ~ group * time, data = df_long, id = id, \n#&gt;     corstr = \"ar1\")\n#&gt; \n#&gt; Coefficients:\n#&gt;   (Intercept)        groupB        groupC        timet1        timet2 \n#&gt;         121.0           0.2           5.2          -8.6          -2.6 \n#&gt;        timet3        timet4 groupB:timet1 groupC:timet1 groupB:timet2 \n#&gt;           4.8          -0.2           7.2           5.4          -0.6 \n#&gt; groupC:timet2 groupB:timet3 groupC:timet3 groupB:timet4 groupC:timet4 \n#&gt;          -5.0           2.2          11.6          14.2           4.6 \n#&gt; \n#&gt; Degrees of Freedom: 75 Total (i.e. Null);  60 Residual\n#&gt; \n#&gt; Scale Link:                   identity\n#&gt; Estimated Scale Parameters:  [1] 16.13\n#&gt; \n#&gt; Correlation:  Structure = ar1    Link = identity \n#&gt; Estimated Correlation Parameters:\n#&gt;  alpha \n#&gt; 0.8464 \n#&gt; \n#&gt; Number of clusters:   15   Maximum cluster size: 5\nsummary(g3)\n#&gt; \n#&gt; Call:\n#&gt; geeglm(formula = SBP ~ group * time, data = df_long, id = id, \n#&gt;     corstr = \"ar1\")\n#&gt; \n#&gt;  Coefficients:\n#&gt;               Estimate Std.err    Wald Pr(&gt;|W|)    \n#&gt; (Intercept)    121.000   1.414 7320.50  &lt; 2e-16 ***\n#&gt; groupB           0.200   2.234    0.01  0.92867    \n#&gt; groupC           5.200   2.028    6.58  0.01034 *  \n#&gt; timet1          -8.600   0.921   87.22  &lt; 2e-16 ***\n#&gt; timet2          -2.600   1.315    3.91  0.04794 *  \n#&gt; timet3           4.800   1.180   16.55  4.7e-05 ***\n#&gt; timet4          -0.200   1.213    0.03  0.86907    \n#&gt; groupB:timet1    7.200   1.173   37.67  8.4e-10 ***\n#&gt; groupC:timet1    5.400   2.191    6.08  0.01371 *  \n#&gt; groupB:timet2   -0.600   1.470    0.17  0.68309    \n#&gt; groupC:timet2   -5.000   1.943    6.62  0.01008 *  \n#&gt; groupB:timet3    2.200   1.397    2.48  0.11534    \n#&gt; groupC:timet3   11.600   3.098   14.02  0.00018 ***\n#&gt; groupB:timet4   14.200   1.425   99.23  &lt; 2e-16 ***\n#&gt; groupC:timet4    4.600   2.498    3.39  0.06555 .  \n#&gt; ---\n#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n#&gt; \n#&gt; Correlation structure = ar1 \n#&gt; Estimated Scale Parameters:\n#&gt; \n#&gt;             Estimate Std.err\n#&gt; (Intercept)     16.1    4.44\n#&gt;   Link = identity \n#&gt; \n#&gt; Estimated Correlation Parameters:\n#&gt;       Estimate Std.err\n#&gt; alpha    0.846  0.0661\n#&gt; Number of clusters:   15  Maximum cluster size: 5\nQIC(g3)\n#&gt;       QIC      QICu Quasi Lik       CIC    params      QICC \n#&gt;      1240      1240      -605        15        15       968",
    "crumbs": [
      "统计模型",
      "<span class='chapter-number'>20</span>  <span class='chapter-title'>广义估计方程</span>"
    ]
  },
  {
    "objectID": "SurvivalAnalysis.html",
    "href": "SurvivalAnalysis.html",
    "title": "\n21  生存分析\n",
    "section": "",
    "text": "21.1 生存函数\n\\[\nS(t)=P(T&gt;t)=1-F(t)=\\int_{t}^{+\\infty}f(x)dx\n\\]\n其中S(t)是累计生存概率或生存率，量化了生存时间大于t的概率。f(x)是密度函数，呈右偏态分布，反映了任意时间点 t 终点事件的瞬时发生率。F(t)=P(T&lt;t)是f(t)在区间[0,t]的累计形式，也称为分布函数或累积函数。",
    "crumbs": [
      "生存分析",
      "<span class='chapter-number'>21</span>  <span class='chapter-title'>生存分析</span>"
    ]
  },
  {
    "objectID": "SurvivalAnalysis.html#乘积极限法kaplan-meier",
    "href": "SurvivalAnalysis.html#乘积极限法kaplan-meier",
    "title": "\n21  生存分析\n",
    "section": "\n21.2 乘积极限法(Kaplan-Meier)",
    "text": "21.2 乘积极限法(Kaplan-Meier)\nproduct limit method 也称为Kaplan-Meier 法。\n\\(t_1&lt;t_2&lt;t_3&lt;...&lt;t_n\\)，样本量大小n，ti 代表个体i发生终点事件或右删失的时间。由于一些个体有相同的生存时间，它们被称为 tied 观测时间，生存时间的个数小于样本量n。\n\n21.2.1 点估计S(t)\n\\(n_1&gt;n_2&gt;n_3&gt;...&gt;n_n\\) ,ni d代表在时间点ti 暴露于特定事件风险的幸存者数量。\n\\(d_i\\) 代表在时间点ti 发生终点事件的数量。（如果没有 tie，di=1或0）\n生存率的KM方法估计公式：\n\\[\n\\hat S(t)=\\prod_{t_i\\le t}\\frac{n_i-d_i}{n_i}\n\\tag{21.1}\\]\nEquation 21.1 包括了删失情况，如果从ti-1 到ti 发生了删失，但没有终点事件，di =0，条件概率等于1。\n\n21.2.2 区间估计S(t)\n(1-α)×100% CI \\([\\hat S(t)-z_{1-\\alpha/2}\\sqrt{Var\\left [\\hat S(t)  \\right]},\\hat S(t)+z_{1-\\alpha/2}\\sqrt{Var\\left [\\hat S(t)  \\right]}]\\)\n其中\\(Var\\left [\\hat S(t)  \\right]=\\hat S(t)^2\\sum_{t_i\\le t}\\frac{d_i}{n_i(n_i-d_i)}\\) (Greenwood method )\n\n21.2.3 示例\nhttps://biostatsquid.com/easy-survival-analysis-r-tutorial/\n\nShow the codelibrary(survminer)\nlibrary(survival)\nlibrary(ggsurvfit)\ndf &lt;- read_csv(\"data/log-rank-survival.csv\")\n\n\nsurv_obj &lt;- with(df, Surv(Days,status))\n\nsurv_fit1 &lt;-survfit(surv_obj ~1,data=df)\n# t_i  =  surv_fit1$time\n# n_i = surv_fit1$n.risk\n\n# d_i = surv_fit1$n.event\n\n# cnesored\nsurv_fit1$n.censor\n#&gt;  [1]  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0  0 17\n\n# 生存率survival\nsurv_fit1$surv\n#&gt;  [1] 0.9821429 0.9285714 0.8928571 0.8571429 0.8392857 0.7857143 0.7678571\n#&gt;  [8] 0.7321429 0.6250000 0.5892857 0.5714286 0.5535714 0.5178571 0.4642857\n#&gt; [15] 0.4464286 0.3928571 0.3750000 0.3571429 0.3392857 0.3214286 0.3035714\n#&gt; [22] 0.3035714\n\nsummary(surv_fit1)\n#&gt; Call: survfit(formula = surv_obj ~ 1, data = df)\n#&gt; \n#&gt;  time n.risk n.event survival std.err lower 95% CI upper 95% CI\n#&gt;    11     56       1    0.982  0.0177        0.948        1.000\n#&gt;    13     55       3    0.929  0.0344        0.864        0.999\n#&gt;    14     52       2    0.893  0.0413        0.815        0.978\n#&gt;    15     50       2    0.857  0.0468        0.770        0.954\n#&gt;    16     48       1    0.839  0.0491        0.748        0.941\n#&gt;    17     47       3    0.786  0.0548        0.685        0.901\n#&gt;    18     44       1    0.768  0.0564        0.665        0.887\n#&gt;    19     43       2    0.732  0.0592        0.625        0.858\n#&gt;    20     41       6    0.625  0.0647        0.510        0.766\n#&gt;    21     35       2    0.589  0.0657        0.474        0.733\n#&gt;    23     33       1    0.571  0.0661        0.455        0.717\n#&gt;    24     32       1    0.554  0.0664        0.438        0.700\n#&gt;    25     31       2    0.518  0.0668        0.402        0.667\n#&gt;    27     29       3    0.464  0.0666        0.350        0.615\n#&gt;    28     26       1    0.446  0.0664        0.333        0.598\n#&gt;    30     25       3    0.393  0.0653        0.284        0.544\n#&gt;    32     22       1    0.375  0.0647        0.267        0.526\n#&gt;    38     21       1    0.357  0.0640        0.251        0.508\n#&gt;    39     20       1    0.339  0.0633        0.235        0.489\n#&gt;    40     19       1    0.321  0.0624        0.220        0.470\n#&gt;    45     18       1    0.304  0.0614        0.204        0.451\n\nggsurvfit(surv_fit1, linewidth =1)+\n    add_confidence_interval()+\n    scale_ggsurvfit()+\n    add_risktable() +\n    labs(x = \"Days\")\n\n\n\n\n\n\n\n\nShow the code# 估计 x-天 的生存率\n\nsummary( surv_fit1, times = c(0,30,50))$surv\n#&gt; [1] 1.0000000 0.3928571 0.3035714\n\n# 中位生存率 median\nsurv_fit1\n#&gt; Call: survfit(formula = surv_obj ~ 1, data = df)\n#&gt; \n#&gt;       n events median 0.95LCL 0.95UCL\n#&gt; [1,] 56     39     27      21      39",
    "crumbs": [
      "生存分析",
      "<span class='chapter-number'>21</span>  <span class='chapter-title'>生存分析</span>"
    ]
  },
  {
    "objectID": "SurvivalAnalysis.html#单因素生存曲线的比较",
    "href": "SurvivalAnalysis.html#单因素生存曲线的比较",
    "title": "\n21  生存分析\n",
    "section": "\n21.3 单因素生存曲线的比较",
    "text": "21.3 单因素生存曲线的比较\n\n\n检验方法\n权重\n\n\n\nlog-rank test\n1\n\n\nWilcoxon test\nnj\n\n\n\nTarone-Ware test\n\\(\\sqrt{n_j}\\)\n\n\nPeto test\n\\(\\hat S(t_j)\\)\n\n\n\n\\[\n\\chi^2=\\frac{\\left(\\sum_jw(t_j)(m_{ij}-e_{ij})\\right)^2}{\\hat {Var}\\left(\\sum_jw(t_j)(m_{ij}-e_{ij})\\right)}\n\\]",
    "crumbs": [
      "生存分析",
      "<span class='chapter-number'>21</span>  <span class='chapter-title'>生存分析</span>"
    ]
  },
  {
    "objectID": "SurvivalAnalysis.html#log-rank-test",
    "href": "SurvivalAnalysis.html#log-rank-test",
    "title": "\n21  生存分析\n",
    "section": "\n21.4 log-rank test",
    "text": "21.4 log-rank test\n\nH0 :两总体的生存曲线是相同的。\n\n计算当第j次发生终点事件各组终点事件的期望值（e1j ,e2j ）\n\\(e_{1j}=\\left ( \\frac{n_{1j}}{n_{1j}+n_{2j}}\\right)\\times (m_{1j}+m_{2j})\\)\n\\(e_{2j}=\\left ( \\frac{n_{2j}}{n_{1j}+n_{2j}}\\right)\\times (m_{1j}+m_{2j})\\)\n其中mij 表示在第 j 个时间点第 i 组终点事件的数量，nij 表示在第 j 个时间点第 i 组初始观测的数量\n\n\n对所有时间点对终点事件的观测值和期望值的差异求和\n\\(O_i-Ei=\\sum_j(m_{ij}-e_{ij})\\ \\ \\ (i=1,2)\\)\n计算其方差估计值\n\\(\\hat{Var}=\\sum_j\\frac{n_{1j}n_{2j}(m_{1j}+m_{2j})(n_{1j}+n_{2j}-m_{1j}-m_{2j})}{(n_{1j}+n_{2j})^2(n_{1j}+n_{2j}-1)}\\ \\ \\ (i=1,2)\\)\n\n\n计算log-rank test 的检验统计量\n\\[\n\\chi^2=\\frac{(O_1-E_1)^2}{\\hat{Var}(O_1-E_1)} \\ 或者 \\ \\chi^2=\\frac{(O_2-E_2)^2}{\\hat{Var}(O_2-E_2)}\n\\]\n也可以近似估计为\n\\[\n\\chi^2=\\sum_{i=1}^2\\frac{(O_i-E_i)^2}{E_i} \\sim \\chi^2(\\nu=1)\n\\]\n\n\n\nShow the code\nsurv_fit2&lt;-survfit(surv_obj ~ treatment,data=df)\nggsurvplot(surv_fit2, linewidth =1,\n          data = df,\n          censor.shape = \"|\", censor.size = 4,\n          pval = T,conf.int = T,risk.table = T,risk.table.col = \"strata\",\n          legend.labs = c(\"CON\",\"DPVB\",\"LDRT\",\"LR-DPVB\"),\n          risk.table.height = .25,\n          ggtheme = theme_bw()\n            )+\n    labs(x = \"Days\")\n\n\n\n\n\n\n\n\nShow the code# 执行Log-rank检验\nlogrank_test &lt;- survdiff( Surv(Days,status) ~ treatment,data = df)\nlogrank_test\n#&gt; Call:\n#&gt; survdiff(formula = Surv(Days, status) ~ treatment, data = df)\n#&gt; \n#&gt;                    N Observed Expected (O-E)^2/E (O-E)^2/V\n#&gt; treatment=CON     14       14     4.46     20.40     26.03\n#&gt; treatment=DPVB    14        9    13.26      1.37      2.19\n#&gt; treatment=LDRT    14       14     5.53     12.99     16.92\n#&gt; treatment=LR_DPVB 14        2    15.76     12.01     22.67\n#&gt; \n#&gt;  Chisq= 58.4  on 3 degrees of freedom, p= 1e-12\nlogrank_test$chisq\n#&gt; [1] 58.43627\nlogrank_test$pvalue\n#&gt; [1] 1.268397e-12\n\n\n\nShow the codesurvdiff( Surv(Days,status) ~ treatment,\n          data = df %&gt;% filter(treatment %in% c(\"CON\", \"DPVB\")))\n#&gt; Call:\n#&gt; survdiff(formula = Surv(Days, status) ~ treatment, data = df %&gt;% \n#&gt;     filter(treatment %in% c(\"CON\", \"DPVB\")))\n#&gt; \n#&gt;                 N Observed Expected (O-E)^2/E (O-E)^2/V\n#&gt; treatment=CON  14       14      5.3     14.31      24.1\n#&gt; treatment=DPVB 14        9     17.7      4.28      24.1\n#&gt; \n#&gt;  Chisq= 24.1  on 1 degrees of freedom, p= 9e-07\n\nsurvdiff( Surv(Days,status) ~ treatment,\n          data = df %&gt;% filter(treatment %in% c(\"CON\", \"LDRT\")))\n#&gt; Call:\n#&gt; survdiff(formula = Surv(Days, status) ~ treatment, data = df %&gt;% \n#&gt;     filter(treatment %in% c(\"CON\", \"LDRT\")))\n#&gt; \n#&gt;                 N Observed Expected (O-E)^2/E (O-E)^2/V\n#&gt; treatment=CON  14       14       12     0.331     0.716\n#&gt; treatment=LDRT 14       14       16     0.248     0.716\n#&gt; \n#&gt;  Chisq= 0.7  on 1 degrees of freedom, p= 0.4\n\nsurvdiff( Surv(Days,status) ~ treatment,\n          data = df %&gt;% filter(treatment %in% c(\"CON\", \"LR_DPVB\")))\n#&gt; Call:\n#&gt; survdiff(formula = Surv(Days, status) ~ treatment, data = df %&gt;% \n#&gt;     filter(treatment %in% c(\"CON\", \"LR_DPVB\")))\n#&gt; \n#&gt;                    N Observed Expected (O-E)^2/E (O-E)^2/V\n#&gt; treatment=CON     14       14     4.73     18.16      31.1\n#&gt; treatment=LR_DPVB 14        2    11.27      7.62      31.1\n#&gt; \n#&gt;  Chisq= 31.1  on 1 degrees of freedom, p= 2e-08",
    "crumbs": [
      "生存分析",
      "<span class='chapter-number'>21</span>  <span class='chapter-title'>生存分析</span>"
    ]
  },
  {
    "objectID": "CoxProportionalHazardsModel.html",
    "href": "CoxProportionalHazardsModel.html",
    "title": "\n22  Cox比例风险模型\n",
    "section": "",
    "text": "22.1 风险函数\n\\[\n\\begin{aligned}\nh(t)=&\\lim_{\\Delta t\\to 0}\\frac{P(t\\le T&lt;t+\\Delta t|T\\ge t)}{\\Delta t}\\\\\n=&\\lim_{\\Delta t\\to 0}\\frac{P(t\\le T&lt;t+\\Delta t\\ \\&\\ T\\ge t)}{\\Delta t·P(T\\ge t) }\\\\\n=&\\lim_{\\Delta t\\to 0}\\frac{S(t)- S(t+\\Delta t)}{\\Delta t·S(t)}\\\\\n=&-\\frac{d(\\ln S(t))}{dt}\n\\end{aligned}\n\\]\n推导出 \\(S(t)=e^{-\\int_0^t h(u)du}\\)\n\\[\n\\begin{aligned}\nh(t)\\Delta t=&P(t\\le T&lt;t+\\Delta t|T\\ge t)\n=\\frac{P(t\\le T&lt;t+\\Delta t\\ \\&\\ T\\ge t)}{P(T\\ge t) }\\\\\n=&\\frac{P(t\\le T&lt;t+\\Delta t)}{P(T\\ge t) }\\\\\n=&\\frac{f(t)\\Delta t}{S(t)}\n\\end{aligned}\n\\]\n推导出 \\(f(t)=h(t)S(t)\\)",
    "crumbs": [
      "生存分析",
      "<span class='chapter-number'>22</span>  <span class='chapter-title'>Cox比例风险模型</span>"
    ]
  },
  {
    "objectID": "CoxProportionalHazardsModel.html#风险率",
    "href": "CoxProportionalHazardsModel.html#风险率",
    "title": "\n22  Cox比例风险模型\n",
    "section": "\n22.2 风险率",
    "text": "22.2 风险率\n对于有风险因子\\(x_1,x_2,...,x_k\\) 的个体在时间 t 的风险率\\(h(t|x_1,x_2,...,x_k)\\)\n\\[ h(t|x_1,x_2,...,x_k)=h_0(t)g(x_1,x_2,...,x_k)=h_0(t)exp(\\sum_{j=1}^k\\beta_jx_j) \\]\n其中\n\n\\(h0 (t)\\)是给定所有风险因子（协变量）为零的随时间变化的基线风险函数。\n\\(g(X)\\)是k个独立风险因子的集合函数，代表变量的风险效应。\n\\(β_j\\)是部分回归系数，表示风险比的比例变化。",
    "crumbs": [
      "生存分析",
      "<span class='chapter-number'>22</span>  <span class='chapter-title'>Cox比例风险模型</span>"
    ]
  },
  {
    "objectID": "CoxProportionalHazardsModel.html#风险比hazard-ratio",
    "href": "CoxProportionalHazardsModel.html#风险比hazard-ratio",
    "title": "\n22  Cox比例风险模型\n",
    "section": "\n22.3 风险比（hazard ratio）",
    "text": "22.3 风险比（hazard ratio）\n假设有两个个体，分别具有独立变量，两个个体的风险函数之比称为风险比\n\\[ HR=\\frac{h(t|x_1,x_2,...,x_k)}{h(t|x_1^*,x_2^*,...,x_k^*)}=exp(\\sum_{j=1}^k\\beta_j(x_j-x_j^*)) \\]\n\n22.3.1 比例风险假设（proportional hazards assumption）\nCox 模型假设任意两组之间的 HR 随时间保持不变\n\\[ \\frac{h(t)}{h_0(t)}=exp(\\sum_{j=1}^k\\beta_jx_j) \\]\n\n22.3.2 模型系数的估计\n条件死亡概率和局部似然函数方法\n\\[ \\ln L_p(\\beta)=\\sum_{i=1}^{d}\\left[ \\sum_{j=1}^k\\beta_jx_{ij}-\\ln\\sum_{m\\in R_i}exp( \\sum_{j=1}^k\\beta_jx_{mj})         \\right] \\]\nNewton-Raphson iterative method\n\\[  \\begin{cases}  \\frac{\\partial \\ln L_p(\\beta)}{\\partial \\beta_1}=0\\\\ \\frac{\\partial \\ln L_p(\\beta)}{\\partial \\beta_2}=0\\\\ \\vdots\\\\ \\frac{\\partial \\ln L_p(\\beta)}{\\partial \\beta_k}=0\\\\ \\end{cases} \\]\n\n22.3.3 模型系数的假设检验\n\n\nWald‘s test\n检验是否有独立变量需要被消除，统计量\\(Z=b_j/S_{b_j}\\)\n当样本量足够大时，Z服从标准正态分布，Z2 服从自由度为1 的\\(\\chi^2\\) 分布\n\\[ \\chi^2_W=(b_j/S_{b_j})^2\\sim \\chi^2(1) \\]\n\n\nPartial likelihood Ratio test\n主要用于非显著性变量的消除，新变量的引入和模型的比较。\n\\[ \\chi^2_{LR}=2\\left[ \\ln L_p(\\beta_k)-\\ln L_p(\\beta_{k-1}) \\right]\\sim\\chi^2(1) \\]\n其中分别是包含 k 个和 k-1 个（不包含要检验的第 j 个变量）独立变量的对数局部似然函数",
    "crumbs": [
      "生存分析",
      "<span class='chapter-number'>22</span>  <span class='chapter-title'>Cox比例风险模型</span>"
    ]
  },
  {
    "objectID": "CoxProportionalHazardsModel.html#示例",
    "href": "CoxProportionalHazardsModel.html#示例",
    "title": "\n22  Cox比例风险模型\n",
    "section": "\n22.4 示例",
    "text": "22.4 示例\n\nShow the codelibrary(survminer)\nlibrary(survival)\ndf &lt;- survival::rotterdam\ndf &lt;- df %&gt;% mutate(dtime_yrs = dtime/365.25,\n                    status = death)\n\n# 拟合Cox比例风险模型 \ncox_model &lt;- coxph(Surv(dtime_yrs, status) ~ hormon + chemo + size + er + pgr + nodes + meno + grade + age, data = df)\n# 查看模型结果 \nsummary(cox_model)  \n#&gt; Call:\n#&gt; coxph(formula = Surv(dtime_yrs, status) ~ hormon + chemo + size + \n#&gt;     er + pgr + nodes + meno + grade + age, data = df)\n#&gt; \n#&gt;   n= 2982, number of events= 1272 \n#&gt; \n#&gt;                 coef  exp(coef)   se(coef)      z Pr(&gt;|z|)    \n#&gt; hormon    -6.553e-02  9.366e-01  8.840e-02 -0.741 0.458535    \n#&gt; chemo      5.032e-02  1.052e+00  8.198e-02  0.614 0.539342    \n#&gt; size20-50  4.425e-01  1.557e+00  6.536e-02  6.771 1.28e-11 ***\n#&gt; size&gt;50    8.222e-01  2.276e+00  9.142e-02  8.993  &lt; 2e-16 ***\n#&gt; er        -5.512e-05  9.999e-01  1.107e-04 -0.498 0.618466    \n#&gt; pgr       -3.676e-04  9.996e-01  1.226e-04 -2.998 0.002720 ** \n#&gt; nodes      7.295e-02  1.076e+00  4.879e-03 14.953  &lt; 2e-16 ***\n#&gt; meno       7.046e-02  1.073e+00  1.006e-01  0.701 0.483583    \n#&gt; grade      3.156e-01  1.371e+00  7.082e-02  4.456 8.33e-06 ***\n#&gt; age        1.406e-02  1.014e+00  3.830e-03  3.671 0.000242 ***\n#&gt; ---\n#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n#&gt; \n#&gt;           exp(coef) exp(-coef) lower .95 upper .95\n#&gt; hormon       0.9366     1.0677    0.7876    1.1137\n#&gt; chemo        1.0516     0.9509    0.8955    1.2349\n#&gt; size20-50    1.5567     0.6424    1.3695    1.7694\n#&gt; size&gt;50      2.2755     0.4395    1.9022    2.7221\n#&gt; er           0.9999     1.0001    0.9997    1.0002\n#&gt; pgr          0.9996     1.0004    0.9994    0.9999\n#&gt; nodes        1.0757     0.9296    1.0654    1.0860\n#&gt; meno         1.0730     0.9320    0.8810    1.3068\n#&gt; grade        1.3711     0.7293    1.1934    1.5753\n#&gt; age          1.0142     0.9860    1.0066    1.0218\n#&gt; \n#&gt; Concordance= 0.693  (se = 0.008 )\n#&gt; Likelihood ratio test= 524.4  on 10 df,   p=&lt;2e-16\n#&gt; Wald test            = 609.4  on 10 df,   p=&lt;2e-16\n#&gt; Score (logrank) test = 688.1  on 10 df,   p=&lt;2e-16\n\n\n例如，与未接受激素治疗的患者相比，在任何给定时间接受激素治疗患者的结局（死亡）概率为0.9366。换句话说，他们的生存率提高了6.34%。对于每个组，我们比较了该特征的存在（=1）和不存在（=0）。例如，对于激素治疗，我们有2600名患者没有接受激素治疗，而300名患者接受了激素治疗。因此，系数是指接受治疗与不接受治疗的对数风险率的变化，换句话说，“不接受激素治疗”组是我们的参考。\n在解释 Cox regresison 的结果之前，请验证是否遵循比例风险假设。\nCox 模型假设任意两组之间的 HR 随时间保持不变。我们可以使用 cox.zph() 非常轻松地对其进行测试。\n\nShow the codetest &lt;- survival::cox.zph(cox_model)\ntest\n#&gt;         chisq df       p\n#&gt; hormon  0.684  1 0.40818\n#&gt; chemo   2.100  1 0.14727\n#&gt; size    5.206  2 0.07405\n#&gt; er     59.748  1 1.1e-14\n#&gt; pgr    41.637  1 1.1e-10\n#&gt; nodes   4.073  1 0.04358\n#&gt; meno    4.284  1 0.03846\n#&gt; grade   3.163  1 0.07533\n#&gt; age    13.954  1 0.00019\n#&gt; GLOBAL 93.751 10 9.6e-16\n\n\n基于Schoenfeld residuals 的比例风险假设\n\nShow the code# 绘制每个协变量随时间变化的 Schoenfeld 残差\nsurvminer::ggcoxzph(test, point.size = 0.1)\n\n\n\n\n\n\n\n如果残差随时间显示清晰的模式，则可能表示违反了比例风险假设。\n一些有助于解释的提示：\n\n无模式（常数残差）：如果残差随机分布在零附近，没有明确的趋势或模式，则表明比例风险假设是合理的：）\n线性趋势：残差随时间变化的线性趋势（增加或减少）可能表明违反了比例风险假设。例如，如果残差在一段时间内始终为正或负，则表示存在时间相关效应。\n非线性模式：如果残差表现出非线性模式或特定形状（例如，U 形、V 形），则可能表示偏离比例风险。\n并行度：平行度意味着残差的分布和分布在时间上相对恒定。如果残差随时间变宽或变窄，则可能表明违反了假设。\n\n\nShow the code\n###  Concordance index\nc_index &lt;- function(data, formula, indices) {\n    dat &lt;- data[indices, ]\n    \n    # 构建回归模型\n    fit &lt;- cph(formula = formula, data = dat, x = TRUE, y = TRUE, surv = TRUE)\n    \n    # 进行预测\n    pred &lt;- predict(fit, newdata = dat)\n    \n    # 计算C-index\n   C_index &lt;- 1 - rcorrcens(Surv(dat[[all.vars(formula)[1]]], \n                                   dat[[all.vars(formula)[2]]]) ~ pred)[1]\n    \n    return(C_index)\n}\n\nformula &lt;- Surv(dtime_yrs, status) ~ hormon + chemo + size + er + pgr + nodes + meno + grade + age\nlibrary(rms)\n\nc_index(data=df, formula ,indices = 1:nrow(df))\n#&gt; [1] 0.6928361\n\nlibrary(boot)\nset.seed(1234)\nboot_c_index &lt;- boot(data = df,statistic = c_index, R = 200,formula = formula)\nboot_c_index \n#&gt; \n#&gt; ORDINARY NONPARAMETRIC BOOTSTRAP\n#&gt; \n#&gt; \n#&gt; Call:\n#&gt; boot(data = df, statistic = c_index, R = 200, formula = formula)\n#&gt; \n#&gt; \n#&gt; Bootstrap Statistics :\n#&gt;      original       bias    std. error\n#&gt; t1* 0.6928361 0.0009553912 0.007547789\n\nplot(boot_c_index)\n\n\n\n\n\n\nShow the codeboot.ci(boot_c_index, conf = 0.95, type = c(\"norm\",\"basic\",\"perc\"))\n#&gt; BOOTSTRAP CONFIDENCE INTERVAL CALCULATIONS\n#&gt; Based on 200 bootstrap replicates\n#&gt; \n#&gt; CALL : \n#&gt; boot.ci(boot.out = boot_c_index, conf = 0.95, type = c(\"norm\", \n#&gt;     \"basic\", \"perc\"))\n#&gt; \n#&gt; Intervals : \n#&gt; Level      Normal              Basic              Percentile     \n#&gt; 95%   ( 0.6771,  0.7067 )   ( 0.6773,  0.7061 )   ( 0.6795,  0.7083 )  \n#&gt; Calculations and Intervals on Original Scale\n#&gt; Some basic intervals may be unstable\n#&gt; Some percentile intervals may be unstable\n\nboot_c_index$t\n#&gt;             [,1]\n#&gt;   [1,] 0.6840415\n#&gt;   [2,] 0.6861004\n#&gt;   [3,] 0.6922284\n#&gt;   [4,] 0.6871463\n#&gt;   [5,] 0.6891063\n#&gt;   [6,] 0.7070723\n#&gt;   [7,] 0.6975292\n#&gt;   [8,] 0.6957405\n#&gt;   [9,] 0.6889738\n#&gt;  [10,] 0.6973390\n#&gt;  [11,] 0.7001275\n#&gt;  [12,] 0.6994050\n#&gt;  [13,] 0.6899169\n#&gt;  [14,] 0.7005129\n#&gt;  [15,] 0.7063317\n#&gt;  [16,] 0.6996744\n#&gt;  [17,] 0.6979745\n#&gt;  [18,] 0.6925786\n#&gt;  [19,] 0.6904877\n#&gt;  [20,] 0.6965846\n#&gt;  [21,] 0.6958925\n#&gt;  [22,] 0.6992254\n#&gt;  [23,] 0.7059247\n#&gt;  [24,] 0.7043914\n#&gt;  [25,] 0.6888177\n#&gt;  [26,] 0.6971457\n#&gt;  [27,] 0.6929253\n#&gt;  [28,] 0.6930116\n#&gt;  [29,] 0.6951884\n#&gt;  [30,] 0.7057137\n#&gt;  [31,] 0.6853929\n#&gt;  [32,] 0.6878291\n#&gt;  [33,] 0.6924952\n#&gt;  [34,] 0.6932619\n#&gt;  [35,] 0.6920361\n#&gt;  [36,] 0.6907561\n#&gt;  [37,] 0.6911114\n#&gt;  [38,] 0.6837897\n#&gt;  [39,] 0.7038525\n#&gt;  [40,] 0.7024494\n#&gt;  [41,] 0.6897124\n#&gt;  [42,] 0.7054827\n#&gt;  [43,] 0.7045421\n#&gt;  [44,] 0.7031605\n#&gt;  [45,] 0.6902170\n#&gt;  [46,] 0.6897095\n#&gt;  [47,] 0.6982245\n#&gt;  [48,] 0.6882279\n#&gt;  [49,] 0.6810325\n#&gt;  [50,] 0.6928143\n#&gt;  [51,] 0.6940493\n#&gt;  [52,] 0.7023472\n#&gt;  [53,] 0.6977338\n#&gt;  [54,] 0.6816434\n#&gt;  [55,] 0.6902461\n#&gt;  [56,] 0.6962076\n#&gt;  [57,] 0.6930478\n#&gt;  [58,] 0.6782716\n#&gt;  [59,] 0.6888177\n#&gt;  [60,] 0.6932389\n#&gt;  [61,] 0.6820609\n#&gt;  [62,] 0.6891455\n#&gt;  [63,] 0.6965728\n#&gt;  [64,] 0.7051772\n#&gt;  [65,] 0.6970262\n#&gt;  [66,] 0.7051638\n#&gt;  [67,] 0.6978584\n#&gt;  [68,] 0.6954607\n#&gt;  [69,] 0.6913879\n#&gt;  [70,] 0.6828812\n#&gt;  [71,] 0.6921640\n#&gt;  [72,] 0.6932000\n#&gt;  [73,] 0.7002079\n#&gt;  [74,] 0.6968225\n#&gt;  [75,] 0.6997555\n#&gt;  [76,] 0.6846542\n#&gt;  [77,] 0.6846691\n#&gt;  [78,] 0.7068665\n#&gt;  [79,] 0.6961698\n#&gt;  [80,] 0.6963645\n#&gt;  [81,] 0.6933080\n#&gt;  [82,] 0.6947798\n#&gt;  [83,] 0.6944429\n#&gt;  [84,] 0.6928754\n#&gt;  [85,] 0.6946977\n#&gt;  [86,] 0.6844625\n#&gt;  [87,] 0.6993367\n#&gt;  [88,] 0.7109857\n#&gt;  [89,] 0.6899890\n#&gt;  [90,] 0.6856668\n#&gt;  [91,] 0.6951957\n#&gt;  [92,] 0.6840721\n#&gt;  [93,] 0.6919932\n#&gt;  [94,] 0.6915590\n#&gt;  [95,] 0.6860581\n#&gt;  [96,] 0.6802692\n#&gt;  [97,] 0.6896906\n#&gt;  [98,] 0.7020619\n#&gt;  [99,] 0.6938913\n#&gt; [100,] 0.7052154\n#&gt; [101,] 0.6868067\n#&gt; [102,] 0.6925506\n#&gt; [103,] 0.6875501\n#&gt; [104,] 0.6997005\n#&gt; [105,] 0.7097947\n#&gt; [106,] 0.6950401\n#&gt; [107,] 0.6887829\n#&gt; [108,] 0.6825710\n#&gt; [109,] 0.6914889\n#&gt; [110,] 0.6869629\n#&gt; [111,] 0.6910353\n#&gt; [112,] 0.6850879\n#&gt; [113,] 0.7083620\n#&gt; [114,] 0.7060274\n#&gt; [115,] 0.6890010\n#&gt; [116,] 0.7033136\n#&gt; [117,] 0.7045074\n#&gt; [118,] 0.6968568\n#&gt; [119,] 0.7020912\n#&gt; [120,] 0.6924852\n#&gt; [121,] 0.6938881\n#&gt; [122,] 0.6974524\n#&gt; [123,] 0.7089484\n#&gt; [124,] 0.6941822\n#&gt; [125,] 0.6880722\n#&gt; [126,] 0.6964263\n#&gt; [127,] 0.6950960\n#&gt; [128,] 0.6922390\n#&gt; [129,] 0.7138132\n#&gt; [130,] 0.6951402\n#&gt; [131,] 0.6775030\n#&gt; [132,] 0.6782926\n#&gt; [133,] 0.6832530\n#&gt; [134,] 0.6896957\n#&gt; [135,] 0.6904713\n#&gt; [136,] 0.6950142\n#&gt; [137,] 0.7022224\n#&gt; [138,] 0.7063290\n#&gt; [139,] 0.6871596\n#&gt; [140,] 0.7035121\n#&gt; [141,] 0.6842875\n#&gt; [142,] 0.6830441\n#&gt; [143,] 0.7038993\n#&gt; [144,] 0.6972607\n#&gt; [145,] 0.6899501\n#&gt; [146,] 0.7055068\n#&gt; [147,] 0.6936249\n#&gt; [148,] 0.6920770\n#&gt; [149,] 0.7045031\n#&gt; [150,] 0.6985115\n#&gt; [151,] 0.7020377\n#&gt; [152,] 0.6894993\n#&gt; [153,] 0.6864729\n#&gt; [154,] 0.6890899\n#&gt; [155,] 0.6860522\n#&gt; [156,] 0.7002668\n#&gt; [157,] 0.7009822\n#&gt; [158,] 0.6844799\n#&gt; [159,] 0.6981335\n#&gt; [160,] 0.6831765\n#&gt; [161,] 0.6866612\n#&gt; [162,] 0.6837701\n#&gt; [163,] 0.6952964\n#&gt; [164,] 0.6928831\n#&gt; [165,] 0.7031870\n#&gt; [166,] 0.6984845\n#&gt; [167,] 0.6928333\n#&gt; [168,] 0.6821514\n#&gt; [169,] 0.6815036\n#&gt; [170,] 0.6834020\n#&gt; [171,] 0.6973542\n#&gt; [172,] 0.6860725\n#&gt; [173,] 0.7000901\n#&gt; [174,] 0.6877945\n#&gt; [175,] 0.6954614\n#&gt; [176,] 0.6961834\n#&gt; [177,] 0.6854653\n#&gt; [178,] 0.6795140\n#&gt; [179,] 0.6983454\n#&gt; [180,] 0.6847524\n#&gt; [181,] 0.6978928\n#&gt; [182,] 0.7032848\n#&gt; [183,] 0.6799797\n#&gt; [184,] 0.6947564\n#&gt; [185,] 0.7014366\n#&gt; [186,] 0.6993279\n#&gt; [187,] 0.6962003\n#&gt; [188,] 0.7002197\n#&gt; [189,] 0.7059244\n#&gt; [190,] 0.6784809\n#&gt; [191,] 0.6935298\n#&gt; [192,] 0.6826279\n#&gt; [193,] 0.6945671\n#&gt; [194,] 0.6955379\n#&gt; [195,] 0.6898856\n#&gt; [196,] 0.6906719\n#&gt; [197,] 0.6881098\n#&gt; [198,] 0.6929627\n#&gt; [199,] 0.6880540\n#&gt; [200,] 0.6990972\n\nquantile(boot_c_index$t,probs = c(.025,.975))\n#&gt;      2.5%     97.5% \n#&gt; 0.6799681 0.7071046",
    "crumbs": [
      "生存分析",
      "<span class='chapter-number'>22</span>  <span class='chapter-title'>Cox比例风险模型</span>"
    ]
  },
  {
    "objectID": "CoxProportionalHazardsModel.html#森林图",
    "href": "CoxProportionalHazardsModel.html#森林图",
    "title": "\n22  Cox比例风险模型\n",
    "section": "\n22.5 森林图",
    "text": "22.5 森林图\n\nShow the codeggforest(cox_model, data = df)",
    "crumbs": [
      "生存分析",
      "<span class='chapter-number'>22</span>  <span class='chapter-title'>Cox比例风险模型</span>"
    ]
  },
  {
    "objectID": "CompetingRiskModel.html",
    "href": "CompetingRiskModel.html",
    "title": "23  竞争风险模型",
    "section": "",
    "text": "https://ayueme.github.io/R_clinical_model/nomogram-compete-risk.html",
    "crumbs": [
      "生存分析",
      "<span class='chapter-number'>23</span>  <span class='chapter-title'>竞争风险模型</span>"
    ]
  },
  {
    "objectID": "diagnostic_test.html",
    "href": "diagnostic_test.html",
    "title": "\n24  诊断性测试\n",
    "section": "",
    "text": "24.1 混淆矩阵\nShow the codem&lt;- matrix(c(\"TP\",\"FN\",\"FP\",\"TN\"),nrow = 2,\n           dimnames = list(predict=c(\"+\",\"-\"),\n                           truth=c(\"+\",\"-\")))\nprint(m)\n#&gt;        truth\n#&gt; predict +    -   \n#&gt;       + \"TP\" \"FP\"\n#&gt;       - \"FN\" \"TN\"",
    "crumbs": [
      "临床研究设计",
      "<span class='chapter-number'>24</span>  <span class='chapter-title'>诊断性测试</span>"
    ]
  },
  {
    "objectID": "diagnostic_test.html#灵敏度sensitivity",
    "href": "diagnostic_test.html#灵敏度sensitivity",
    "title": "\n24  诊断性测试\n",
    "section": "\n24.2 灵敏度（Sensitivity）",
    "text": "24.2 灵敏度（Sensitivity）\n真阳性率：指在所有真实状况为阳性的样本中，被正确识别出阳性的比例。\n\\[\nSe=\\frac{TP}{TP+FN}\n\\]\n其中TP 是真阳性的数量，FN 是假阴性的数量。\n\n24.2.1 假阴性率(FNR) /漏诊率\n\\[\nFNR=1-Se\n\\]",
    "crumbs": [
      "临床研究设计",
      "<span class='chapter-number'>24</span>  <span class='chapter-title'>诊断性测试</span>"
    ]
  },
  {
    "objectID": "diagnostic_test.html#特异度specificity",
    "href": "diagnostic_test.html#特异度specificity",
    "title": "\n24  诊断性测试\n",
    "section": "\n24.3 特异度（Specificity）",
    "text": "24.3 特异度（Specificity）\n真阴性率：指在所有真实状况为阴性的样本中，被正确识别出阴性的比例。\n\\[\nSp=\\frac{TN}{TN+FP}\n\\]\n其中 TN 是真阴性的数量，FP 是假阳性的数量。\n\n24.3.1 假阳性率(FPR) /误诊率\n\\[ FPR=1-Sp \\]\n\n\n\n\n\nShow the code# 构建列联表\nobserved_sensitivity &lt;- matrix(c(28, 11, 37, 2), nrow = 2, byrow = TRUE,\n                   dimnames = list('检验方式' = c('尿糖检验', '血糖检验'),\n                                   '结果' = c('检出阳性', '未检出阳性')))\nobserved_sensitivity\n#&gt;           结果\n#&gt; 检验方式 检出阳性 未检出阳性\n#&gt;   尿糖检验       28         11\n#&gt;   血糖检验       37          2\n# 进行卡方检验\ns &lt;- chisq.test(observed_sensitivity,correct = F)\n\n# 输出结果\ns\n#&gt; \n#&gt;  Pearson's Chi-squared test\n#&gt; \n#&gt; data:  observed_sensitivity\n#&gt; X-squared = 7.4769, df = 1, p-value = 0.006249\n\n\n# 构建列联表\nobserved_accuracy &lt;- matrix(c(29, 11, 38, 2), nrow = 2, byrow = TRUE,\n                            dimnames = list('检验方式' = c('尿糖检验', '血糖检验'),\n                                            '结果' = c('检准', '不准')))\n\n# 进行卡方检验\naccuracy &lt;- chisq.test(observed_accuracy,correct = F)\n\n# 输出结果\naccuracy\n#&gt; \n#&gt;  Pearson's Chi-squared test\n#&gt; \n#&gt; data:  observed_accuracy\n#&gt; X-squared = 7.4397, df = 1, p-value = 0.00638",
    "crumbs": [
      "临床研究设计",
      "<span class='chapter-number'>24</span>  <span class='chapter-title'>诊断性测试</span>"
    ]
  },
  {
    "objectID": "diagnostic_test.html#youdens-index",
    "href": "diagnostic_test.html#youdens-index",
    "title": "\n24  诊断性测试\n",
    "section": "\n24.4 Youden’s Index",
    "text": "24.4 Youden’s Index\n\\[\nJ=Se-FPR =Se+Sp-1,J[1,-1]\n\\]\n\nJ 越大诊断有效性越高\nJ=1 表示完美的诊断性能，因为Se，Sp都是1。\nJ≤0 表示没有诊断价值",
    "crumbs": [
      "临床研究设计",
      "<span class='chapter-number'>24</span>  <span class='chapter-title'>诊断性测试</span>"
    ]
  },
  {
    "objectID": "diagnostic_test.html#likelihood-ratio",
    "href": "diagnostic_test.html#likelihood-ratio",
    "title": "\n24  诊断性测试\n",
    "section": "\n24.5 Likelihood Ratio",
    "text": "24.5 Likelihood Ratio\n\n24.5.1 正似然比\n\\[\nLR+=\\frac{Se}{FPR}=\\frac{Se}{1-Sp}\n\\]\n\nLR+越大表示患病测出阳性结果的优势越大\nLR+=1表示诊断无效\n\n24.5.2 负似然比\n\\[\nLR-=\\frac{FNR}{Sp}=\\frac{1-Sp}{Sp}\n\\]\n\nLR-越小表示患病测出阴性结果的优势越小\nLR-=1表示诊断无效",
    "crumbs": [
      "临床研究设计",
      "<span class='chapter-number'>24</span>  <span class='chapter-title'>诊断性测试</span>"
    ]
  },
  {
    "objectID": "diagnostic_test.html#预测值",
    "href": "diagnostic_test.html#预测值",
    "title": "\n24  诊断性测试\n",
    "section": "\n24.6 预测值",
    "text": "24.6 预测值\n\nShow the codem\n#&gt;        truth\n#&gt; predict +    -   \n#&gt;       + \"TP\" \"FP\"\n#&gt;       - \"FN\" \"TN\"\n\n\n阳性预测值（Positive Predictive Value, PPV）：在所有被测试为阳性的样本中，真正的阳性比例。\n\\[\nPPV=\\frac{TP}{TP+NP}\n\\]\n阴性预测值（Negative Predictive Value, NPV）：在所有被测试为阴性的样本中，真正的阴性比例。\n\\[\nPPV=\\frac{TN}{TN+FN}\n\\]\n配对样本设计\n\\(\\chi^2\\)配对检验\n完全随机设计\n\\(\\chi^2\\)检验",
    "crumbs": [
      "临床研究设计",
      "<span class='chapter-number'>24</span>  <span class='chapter-title'>诊断性测试</span>"
    ]
  },
  {
    "objectID": "diagnostic_test.html#一致性agreement",
    "href": "diagnostic_test.html#一致性agreement",
    "title": "\n24  诊断性测试\n",
    "section": "\n24.7 一致性（agreement）",
    "text": "24.7 一致性（agreement）\n准确度（Accuracy）：指测试正确地分类（阳性或阴性）的样本占总样本的比例。\n\\[\nAccuracy=\\frac{TP+TN}{N}\n\\]\nkappa 系数\n\\[\n\\kappa =\\frac{Accuracy-[(a+b)(a+c)+(c+d)(b+d)]/N^2}{1-[(a+b)(a+c)+(c+d)(b+d)]/N^2}\n\\]\n\nκ=1表示完全一致\nκ=-1表示完全不一致\nκ=0表示一致性与偶然一致性Pe相同\n\n通常κ＞0.7即可以认为两种诊断方法有较好的一致性",
    "crumbs": [
      "临床研究设计",
      "<span class='chapter-number'>24</span>  <span class='chapter-title'>诊断性测试</span>"
    ]
  },
  {
    "objectID": "diagnostic_test.html#roc曲线receiver-operating-characteristic-curve",
    "href": "diagnostic_test.html#roc曲线receiver-operating-characteristic-curve",
    "title": "\n24  诊断性测试\n",
    "section": "\n24.8 ROC曲线（Receiver Operating Characteristic Curve）",
    "text": "24.8 ROC曲线（Receiver Operating Characteristic Curve）\nROC曲线（Receiver Operating Characteristic Curve）：是一个图形工具，用于展示不同阈值下灵敏度和特异度之间的关系。曲线下面积（AUC）越接近1，表示测试的性能越好。\n\nShow the codelibrary(pROC)\n\nroc_data &lt;- aSAH %&gt;%\n    dplyr::filter(gender == \"Female\") %&gt;%\n    roc(outcome, s100b)\n\n\n\n# 绘制ROC曲线\nplot(roc_data, print.thres = \"best\", print.thres.pattern = \"Best cutoff: %.2f\", main = \"ROC Curve\")\n\n\n\n\n\n\nShow the code\n\n# 计算AUC\nauc_value &lt;- auc(roc_data)\nprint(paste(\"AUC:\", auc_value))\n#&gt; [1] \"AUC: 0.72\"\n\n\n\n24.8.1 AUC\nA=P(X&gt;Y)\n\\[\nS(X,Y)=\n\\begin{cases}\n1,\\ \\ \\ \\  X&gt;Y\\\\\n1/2,X=Y\\\\\n0,\\ \\ \\ \\ X&lt;Y\\\\\n\\end{cases}\n\\]\n\\[\n\\hat A=\\frac{1}{n_0n_1}\\sum_1^{n1}\\sum_1^{n_0}S(X, Y)\n\\]\n\n24.8.2 分组AUC的比较\n完全随机设计\n\\[\nZ=\\frac{\\hat A_1-\\hat A_2}{\\sqrt{Var(\\hat A_1)+Var(\\hat A_2)}}\n\\]\n配对样本设计\n\\[\nZ=\\frac{\\hat A_1-\\hat A_2}{\\sqrt{Var(\\hat A_1)+Var(\\hat A_2)-2Cov(\\hat A_1,\\hat A_2)}}\n\\]",
    "crumbs": [
      "临床研究设计",
      "<span class='chapter-number'>24</span>  <span class='chapter-title'>诊断性测试</span>"
    ]
  },
  {
    "objectID": "RCT.html",
    "href": "RCT.html",
    "title": "\n25  随机对照试验\n",
    "section": "",
    "text": "25.1 随机\nShow the codeif(!require(randomizeR)) install.packages(\"randomizeR\")\n#&gt; package 'r2rtf' successfully unpacked and MD5 sums checked\n#&gt; package 'mstate' successfully unpacked and MD5 sums checked\n#&gt; package 'PwrGSD' successfully unpacked and MD5 sums checked\n#&gt; package 'gsDesign' successfully unpacked and MD5 sums checked\n#&gt; package 'randomizeR' successfully unpacked and MD5 sums checked\n#&gt; \n#&gt; The downloaded binary packages are in\n#&gt;  C:\\Users\\DELL\\AppData\\Local\\Temp\\RtmpimBUvI\\downloaded_packages",
    "crumbs": [
      "临床研究设计",
      "<span class='chapter-number'>25</span>  <span class='chapter-title'>随机对照试验</span>"
    ]
  },
  {
    "objectID": "RCT.html#随机",
    "href": "RCT.html#随机",
    "title": "\n25  随机对照试验\n",
    "section": "",
    "text": "25.1.1 简单随机化\n完全随机化\n\n\nTable 25.1\n\nShow the code# 假设需要 100 个样本,分为 4 个组\nraw_data &lt;- tibble(\n    id = 1:100\n)\n\nset.seed(20241011)\nraw_data %&gt;%\n  mutate(assign = sample(1:4, size = 100, replace = TRUE)) -&gt; raw_data\n\ntable(raw_data$assign)\n#&gt; \n#&gt;  1  2  3  4 \n#&gt; 24 24 27 25\n\nraw_data\n#&gt; # A tibble: 100 × 2\n#&gt;       id assign\n#&gt;    &lt;int&gt;  &lt;int&gt;\n#&gt;  1     1      3\n#&gt;  2     2      2\n#&gt;  3     3      2\n#&gt;  4     4      4\n#&gt;  5     5      1\n#&gt;  6     6      1\n#&gt;  7     7      2\n#&gt;  8     8      3\n#&gt;  9     9      2\n#&gt; 10    10      1\n#&gt; # ℹ 90 more rows\n\n\n\n\n如果是针对受试者的分组，可按照受试者的入组顺序，筛选成功的第1名受试者进入组3，筛选成功的第2名受试者分入组2，以此类推。\n\n25.1.2 区组随机化\n区组(block)是对受试对象进行划分,即由若干特征相似的试验对象组成,如同一窝的动物、批号相同的试剂、体重相近的受试者等。\n目的是将受试者按相同数量分组。区组大小由研究者决定，通常通过乘以分组数来确定（如有两个治疗组，则应有4、6或8个区组）。区组取预定分组中较小的组，这有助于在整个临床试验中保持治疗组大小相似。决定区组大小后，必须确定每个区组大小相等的分组。然后随机选择区组对受试者进行分组。\n\nShow the codeif(!require(blockrand)) install.packages(\"blockrand\")\n#&gt; package 'blockrand' successfully unpacked and MD5 sums checked\n#&gt; \n#&gt; The downloaded binary packages are in\n#&gt;  C:\\Users\\DELL\\AppData\\Local\\Temp\\RtmpimBUvI\\downloaded_packages\n\n\n\nShow the codelibrary(blockrand)\n\n# 使用区组随机化，指定区组大小为4\nblock_size &lt;- 1:4  # 区组大小\nn &lt;- 100  # 样本总数\n\n\nset.seed(20241012)\nblocks &lt;- blockrand(n = n, num.levels = 2,levels = c(\"Treatment\", \"Control\"),\n                    block.sizes = block_size )\n\nblocks\n#&gt;      id block.id block.size treatment\n#&gt; 1     1        1          4 Treatment\n#&gt; 2     2        1          4   Control\n#&gt; 3     3        1          4 Treatment\n#&gt; 4     4        1          4   Control\n#&gt; 5     5        2          8 Treatment\n#&gt; 6     6        2          8 Treatment\n#&gt; 7     7        2          8   Control\n#&gt; 8     8        2          8   Control\n#&gt; 9     9        2          8 Treatment\n#&gt; 10   10        2          8 Treatment\n#&gt; 11   11        2          8   Control\n#&gt; 12   12        2          8   Control\n#&gt; 13   13        3          6 Treatment\n#&gt; 14   14        3          6 Treatment\n#&gt; 15   15        3          6   Control\n#&gt; 16   16        3          6   Control\n#&gt; 17   17        3          6 Treatment\n#&gt; 18   18        3          6   Control\n#&gt; 19   19        4          4 Treatment\n#&gt; 20   20        4          4   Control\n#&gt; 21   21        4          4   Control\n#&gt; 22   22        4          4 Treatment\n#&gt; 23   23        5          2   Control\n#&gt; 24   24        5          2 Treatment\n#&gt; 25   25        6          6 Treatment\n#&gt; 26   26        6          6 Treatment\n#&gt; 27   27        6          6 Treatment\n#&gt; 28   28        6          6   Control\n#&gt; 29   29        6          6   Control\n#&gt; 30   30        6          6   Control\n#&gt; 31   31        7          6   Control\n#&gt; 32   32        7          6   Control\n#&gt; 33   33        7          6 Treatment\n#&gt; 34   34        7          6   Control\n#&gt; 35   35        7          6 Treatment\n#&gt; 36   36        7          6 Treatment\n#&gt; 37   37        8          6   Control\n#&gt; 38   38        8          6 Treatment\n#&gt; 39   39        8          6   Control\n#&gt; 40   40        8          6 Treatment\n#&gt; 41   41        8          6   Control\n#&gt; 42   42        8          6 Treatment\n#&gt; 43   43        9          6   Control\n#&gt; 44   44        9          6 Treatment\n#&gt; 45   45        9          6   Control\n#&gt; 46   46        9          6 Treatment\n#&gt; 47   47        9          6 Treatment\n#&gt; 48   48        9          6   Control\n#&gt; 49   49       10          2   Control\n#&gt; 50   50       10          2 Treatment\n#&gt; 51   51       11          2   Control\n#&gt; 52   52       11          2 Treatment\n#&gt; 53   53       12          4   Control\n#&gt; 54   54       12          4 Treatment\n#&gt; 55   55       12          4   Control\n#&gt; 56   56       12          4 Treatment\n#&gt; 57   57       13          2 Treatment\n#&gt; 58   58       13          2   Control\n#&gt; 59   59       14          8 Treatment\n#&gt; 60   60       14          8 Treatment\n#&gt; 61   61       14          8 Treatment\n#&gt; 62   62       14          8 Treatment\n#&gt; 63   63       14          8   Control\n#&gt; 64   64       14          8   Control\n#&gt; 65   65       14          8   Control\n#&gt; 66   66       14          8   Control\n#&gt; 67   67       15          4   Control\n#&gt; 68   68       15          4 Treatment\n#&gt; 69   69       15          4 Treatment\n#&gt; 70   70       15          4   Control\n#&gt; 71   71       16          4 Treatment\n#&gt; 72   72       16          4   Control\n#&gt; 73   73       16          4 Treatment\n#&gt; 74   74       16          4   Control\n#&gt; 75   75       17          6 Treatment\n#&gt; 76   76       17          6   Control\n#&gt; 77   77       17          6 Treatment\n#&gt; 78   78       17          6   Control\n#&gt; 79   79       17          6   Control\n#&gt; 80   80       17          6 Treatment\n#&gt; 81   81       18          2   Control\n#&gt; 82   82       18          2 Treatment\n#&gt; 83   83       19          8 Treatment\n#&gt; 84   84       19          8 Treatment\n#&gt; 85   85       19          8   Control\n#&gt; 86   86       19          8 Treatment\n#&gt; 87   87       19          8 Treatment\n#&gt; 88   88       19          8   Control\n#&gt; 89   89       19          8   Control\n#&gt; 90   90       19          8   Control\n#&gt; 91   91       20          4   Control\n#&gt; 92   92       20          4 Treatment\n#&gt; 93   93       20          4   Control\n#&gt; 94   94       20          4 Treatment\n#&gt; 95   95       21          2   Control\n#&gt; 96   96       21          2 Treatment\n#&gt; 97   97       22          4 Treatment\n#&gt; 98   98       22          4   Control\n#&gt; 99   99       22          4 Treatment\n#&gt; 100 100       22          4   Control\n\ntable(blocks$block.id)\n#&gt; \n#&gt;  1  2  3  4  5  6  7  8  9 10 11 12 13 14 15 16 17 18 19 20 21 22 \n#&gt;  4  8  6  4  2  6  6  6  6  2  2  4  2  8  4  4  6  2  8  4  2  4\n\n\n区组随机化的问题\n\n选择偏倚更为常见，因为研究人员可以轻松预测分组的治疗分配。\n\n25.1.3 分层随机化\n根据不同的因素（性别）对受试者进行分组。如果性别是选定因素，则层数是二，对每层应用随机分组。这种形式的随机化可以减少治疗组中的特征不平衡，并提高统计功效。这种方法可以更容易地为不同的预后因素生成区组随机化列表。\n分层随机化的问题\n\n虽然其目的是消除选择偏倚，但这也意味着各分组并不总是具有相同的重要特征。\n\n分层区组随机化分组\n多中心临床试验中普遍采用的方法是以中心分层,然后在各中心内进行区组随机化,即称为分层的区组随机化。\n\nShow the codemale &lt;- blockrand(n=100, id.prefix='M', block.prefix='M',stratum='Male')\nfemale &lt;- blockrand(n=100, id.prefix='F', block.prefix='F',stratum='Female')\n\nmy.study &lt;- rbind(male,female)\nmy.study\n#&gt;       id stratum block.id block.size treatment\n#&gt; 1   M001    Male      M01          4         A\n#&gt; 2   M002    Male      M01          4         B\n#&gt; 3   M003    Male      M01          4         B\n#&gt; 4   M004    Male      M01          4         A\n#&gt; 5   M005    Male      M02          6         B\n#&gt; 6   M006    Male      M02          6         B\n#&gt; 7   M007    Male      M02          6         A\n#&gt; 8   M008    Male      M02          6         B\n#&gt; 9   M009    Male      M02          6         A\n#&gt; 10  M010    Male      M02          6         A\n#&gt; 11  M011    Male      M03          2         A\n#&gt; 12  M012    Male      M03          2         B\n#&gt; 13  M013    Male      M04          6         B\n#&gt; 14  M014    Male      M04          6         B\n#&gt; 15  M015    Male      M04          6         A\n#&gt; 16  M016    Male      M04          6         A\n#&gt; 17  M017    Male      M04          6         A\n#&gt; 18  M018    Male      M04          6         B\n#&gt; 19  M019    Male      M05          4         B\n#&gt; 20  M020    Male      M05          4         A\n#&gt; 21  M021    Male      M05          4         B\n#&gt; 22  M022    Male      M05          4         A\n#&gt; 23  M023    Male      M06          8         A\n#&gt; 24  M024    Male      M06          8         A\n#&gt; 25  M025    Male      M06          8         A\n#&gt; 26  M026    Male      M06          8         B\n#&gt; 27  M027    Male      M06          8         B\n#&gt; 28  M028    Male      M06          8         A\n#&gt; 29  M029    Male      M06          8         B\n#&gt; 30  M030    Male      M06          8         B\n#&gt; 31  M031    Male      M07          8         B\n#&gt; 32  M032    Male      M07          8         A\n#&gt; 33  M033    Male      M07          8         A\n#&gt; 34  M034    Male      M07          8         B\n#&gt; 35  M035    Male      M07          8         A\n#&gt; 36  M036    Male      M07          8         A\n#&gt; 37  M037    Male      M07          8         B\n#&gt; 38  M038    Male      M07          8         B\n#&gt; 39  M039    Male      M08          8         B\n#&gt; 40  M040    Male      M08          8         A\n#&gt; 41  M041    Male      M08          8         A\n#&gt; 42  M042    Male      M08          8         A\n#&gt; 43  M043    Male      M08          8         B\n#&gt; 44  M044    Male      M08          8         A\n#&gt; 45  M045    Male      M08          8         B\n#&gt; 46  M046    Male      M08          8         B\n#&gt; 47  M047    Male      M09          4         B\n#&gt; 48  M048    Male      M09          4         B\n#&gt; 49  M049    Male      M09          4         A\n#&gt; 50  M050    Male      M09          4         A\n#&gt; 51  M051    Male      M10          2         A\n#&gt; 52  M052    Male      M10          2         B\n#&gt; 53  M053    Male      M11          4         A\n#&gt; 54  M054    Male      M11          4         A\n#&gt; 55  M055    Male      M11          4         B\n#&gt; 56  M056    Male      M11          4         B\n#&gt; 57  M057    Male      M12          6         A\n#&gt; 58  M058    Male      M12          6         B\n#&gt; 59  M059    Male      M12          6         B\n#&gt; 60  M060    Male      M12          6         B\n#&gt; 61  M061    Male      M12          6         A\n#&gt; 62  M062    Male      M12          6         A\n#&gt; 63  M063    Male      M13          8         A\n#&gt; 64  M064    Male      M13          8         A\n#&gt; 65  M065    Male      M13          8         A\n#&gt; 66  M066    Male      M13          8         A\n#&gt; 67  M067    Male      M13          8         B\n#&gt; 68  M068    Male      M13          8         B\n#&gt; 69  M069    Male      M13          8         B\n#&gt; 70  M070    Male      M13          8         B\n#&gt; 71  M071    Male      M14          8         B\n#&gt; 72  M072    Male      M14          8         B\n#&gt; 73  M073    Male      M14          8         B\n#&gt; 74  M074    Male      M14          8         A\n#&gt; 75  M075    Male      M14          8         A\n#&gt; 76  M076    Male      M14          8         B\n#&gt; 77  M077    Male      M14          8         A\n#&gt; 78  M078    Male      M14          8         A\n#&gt; 79  M079    Male      M15          6         A\n#&gt; 80  M080    Male      M15          6         B\n#&gt; 81  M081    Male      M15          6         A\n#&gt; 82  M082    Male      M15          6         A\n#&gt; 83  M083    Male      M15          6         B\n#&gt; 84  M084    Male      M15          6         B\n#&gt; 85  M085    Male      M16          8         A\n#&gt; 86  M086    Male      M16          8         B\n#&gt; 87  M087    Male      M16          8         B\n#&gt; 88  M088    Male      M16          8         A\n#&gt; 89  M089    Male      M16          8         B\n#&gt; 90  M090    Male      M16          8         B\n#&gt; 91  M091    Male      M16          8         A\n#&gt; 92  M092    Male      M16          8         A\n#&gt; 93  M093    Male      M17          2         A\n#&gt; 94  M094    Male      M17          2         B\n#&gt; 95  M095    Male      M18          8         B\n#&gt; 96  M096    Male      M18          8         A\n#&gt; 97  M097    Male      M18          8         A\n#&gt; 98  M098    Male      M18          8         B\n#&gt; 99  M099    Male      M18          8         B\n#&gt; 100 M100    Male      M18          8         B\n#&gt; 101 M101    Male      M18          8         A\n#&gt; 102 M102    Male      M18          8         A\n#&gt; 103 F001  Female      F01          2         B\n#&gt; 104 F002  Female      F01          2         A\n#&gt; 105 F003  Female      F02          2         A\n#&gt; 106 F004  Female      F02          2         B\n#&gt; 107 F005  Female      F03          8         A\n#&gt; 108 F006  Female      F03          8         A\n#&gt; 109 F007  Female      F03          8         B\n#&gt; 110 F008  Female      F03          8         A\n#&gt; 111 F009  Female      F03          8         A\n#&gt; 112 F010  Female      F03          8         B\n#&gt; 113 F011  Female      F03          8         B\n#&gt; 114 F012  Female      F03          8         B\n#&gt; 115 F013  Female      F04          4         B\n#&gt; 116 F014  Female      F04          4         B\n#&gt; 117 F015  Female      F04          4         A\n#&gt; 118 F016  Female      F04          4         A\n#&gt; 119 F017  Female      F05          4         A\n#&gt; 120 F018  Female      F05          4         A\n#&gt; 121 F019  Female      F05          4         B\n#&gt; 122 F020  Female      F05          4         B\n#&gt; 123 F021  Female      F06          4         B\n#&gt; 124 F022  Female      F06          4         B\n#&gt; 125 F023  Female      F06          4         A\n#&gt; 126 F024  Female      F06          4         A\n#&gt; 127 F025  Female      F07          2         A\n#&gt; 128 F026  Female      F07          2         B\n#&gt; 129 F027  Female      F08          2         A\n#&gt; 130 F028  Female      F08          2         B\n#&gt; 131 F029  Female      F09          2         B\n#&gt; 132 F030  Female      F09          2         A\n#&gt; 133 F031  Female      F10          6         B\n#&gt; 134 F032  Female      F10          6         B\n#&gt; 135 F033  Female      F10          6         B\n#&gt; 136 F034  Female      F10          6         A\n#&gt; 137 F035  Female      F10          6         A\n#&gt; 138 F036  Female      F10          6         A\n#&gt; 139 F037  Female      F11          8         A\n#&gt; 140 F038  Female      F11          8         B\n#&gt; 141 F039  Female      F11          8         B\n#&gt; 142 F040  Female      F11          8         B\n#&gt; 143 F041  Female      F11          8         B\n#&gt; 144 F042  Female      F11          8         A\n#&gt; 145 F043  Female      F11          8         A\n#&gt; 146 F044  Female      F11          8         A\n#&gt; 147 F045  Female      F12          2         B\n#&gt; 148 F046  Female      F12          2         A\n#&gt; 149 F047  Female      F13          6         B\n#&gt; 150 F048  Female      F13          6         A\n#&gt; 151 F049  Female      F13          6         B\n#&gt; 152 F050  Female      F13          6         A\n#&gt; 153 F051  Female      F13          6         A\n#&gt; 154 F052  Female      F13          6         B\n#&gt; 155 F053  Female      F14          2         A\n#&gt; 156 F054  Female      F14          2         B\n#&gt; 157 F055  Female      F15          6         B\n#&gt; 158 F056  Female      F15          6         A\n#&gt; 159 F057  Female      F15          6         B\n#&gt; 160 F058  Female      F15          6         B\n#&gt; 161 F059  Female      F15          6         A\n#&gt; 162 F060  Female      F15          6         A\n#&gt; 163 F061  Female      F16          4         A\n#&gt; 164 F062  Female      F16          4         A\n#&gt; 165 F063  Female      F16          4         B\n#&gt; 166 F064  Female      F16          4         B\n#&gt; 167 F065  Female      F17          6         B\n#&gt; 168 F066  Female      F17          6         B\n#&gt; 169 F067  Female      F17          6         A\n#&gt; 170 F068  Female      F17          6         B\n#&gt; 171 F069  Female      F17          6         A\n#&gt; 172 F070  Female      F17          6         A\n#&gt; 173 F071  Female      F18          8         A\n#&gt; 174 F072  Female      F18          8         B\n#&gt; 175 F073  Female      F18          8         B\n#&gt; 176 F074  Female      F18          8         B\n#&gt; 177 F075  Female      F18          8         A\n#&gt; 178 F076  Female      F18          8         A\n#&gt; 179 F077  Female      F18          8         A\n#&gt; 180 F078  Female      F18          8         B\n#&gt; 181 F079  Female      F19          4         B\n#&gt; 182 F080  Female      F19          4         B\n#&gt; 183 F081  Female      F19          4         A\n#&gt; 184 F082  Female      F19          4         A\n#&gt; 185 F083  Female      F20          4         B\n#&gt; 186 F084  Female      F20          4         B\n#&gt; 187 F085  Female      F20          4         A\n#&gt; 188 F086  Female      F20          4         A\n#&gt; 189 F087  Female      F21          8         B\n#&gt; 190 F088  Female      F21          8         B\n#&gt; 191 F089  Female      F21          8         A\n#&gt; 192 F090  Female      F21          8         B\n#&gt; 193 F091  Female      F21          8         A\n#&gt; 194 F092  Female      F21          8         B\n#&gt; 195 F093  Female      F21          8         A\n#&gt; 196 F094  Female      F21          8         A\n#&gt; 197 F095  Female      F22          8         B\n#&gt; 198 F096  Female      F22          8         A\n#&gt; 199 F097  Female      F22          8         A\n#&gt; 200 F098  Female      F22          8         B\n#&gt; 201 F099  Female      F22          8         B\n#&gt; 202 F100  Female      F22          8         A\n#&gt; 203 F101  Female      F22          8         B\n#&gt; 204 F102  Female      F22          8         A\n\n\n\n25.1.4 动态随机化\n动态随机化是指在临床试验的过程中每例患者分到各组的概率不是固定不变的,而是根据一定的条件进行调整的方法,它能有效地保证各试验组间例数和某些重要的非处理因素接近一致。动态随机化包括瓮(urn)法、偏币(biased coin)法、最小化(minimization)法等。\n最小化\n最小化随机化的核心是通过动态平衡组内特征分配，使得组间的差异最小。\n最小化被用作平衡临床试验预后因素的工具。第一例受试者通过简单随机化分配到一个治疗组，然后根据先前的受试者及其在临床试验中的安置分配其余受试者，以平衡预后因素。目的是克服分层随机化的挑战。\n\nShow the code# 加载randomizeR包\nlibrary(randomizeR)\n\n\n最小化的问题\n\n不符合随机化的所有要求。",
    "crumbs": [
      "临床研究设计",
      "<span class='chapter-number'>25</span>  <span class='chapter-title'>随机对照试验</span>"
    ]
  },
  {
    "objectID": "RCT.html#分配隐匿",
    "href": "RCT.html#分配隐匿",
    "title": "\n25  随机对照试验\n",
    "section": "\n25.2 分配隐匿",
    "text": "25.2 分配隐匿\n在分配前对受试者的治疗组分配保密。这有助于减少选择偏倚，防止研究人员影响受试者分组。\n\n首先要求产生随机分配序列和确定受试对象合格性的研究人员不应该是同一个人\n其次,如果可能,产生和保存随机分配序列的人员最好是不参与试验的人员\n\n按顺序编码、不透光、密封的信封(sequentially numbered,opaque, sealed envelopes )这是最常用的一种方法。每个研究对象所接受的治疗方案由产生的随机分配序列产生,并被放入按顺序、密封、不透光的信封中。合格的受试对象同意进入试验时,信封才能被打开,受试对象才能接受相应的处理措施。但是这种方法有一定的局限性。(1)如果研究者在试验前提前打开信封而将患者分配至预期的治疗组,将会破坏了研究的随机性。(2)如果将信封对着极强的光线,有时信封里面的内容能被看见。因此,为了避免这些问题,目前在临床研究中比较常用的做法是用来无碳复写纸按顺序、密封、不透光的信封。一旦无碳复写纸被开启后,就无法还原。这样,就比较容易发现研究者是否提前知道随机分配序列。信封法适用于单中心小样本的临床研究。\n中心随机( central randomisation)系统为了避免按顺序、密封、不透光的信封所带来的问题,常用的一种方法是“远程”随机。“远程随机”是指当研究人员确定合格的研究对象后,通过电话或者网络将患者的基本信息传递给中心随机系统,然后获得每个患者的治疗分配方案。从今后的发展趋势来看,这种“远程”的中心随机系统将会取代信封系统。中心随机法适用于大型多中心研究。\n随机分配方案隐匿与盲法\n常与盲法相混淆。随机分配方案的隐匿是指通过在随机分配时防止随机序列被事先知道,而避免选择性偏倚;它在临床试验最后一名患者完成分组后即告结束;而盲法是为了避免干预措施实施过程中和结局指标测量时来自受试者和研究者的主观偏性,盲法需要在整个治疗和随访过程中保持盲的状态,直到试验干预和结局测量完成后才结束。盲法并非是在所有的临床试验中都能进行,但是随机分配方案的隐匿却在任何临床试验中都能进行,无论是分配前或者在分配的时点时。例如,比较针灸和药物两种疗法治疗某种疾病的疗效,盲法是难以实施的,而随机分配方案的隐匿却是可行的。",
    "crumbs": [
      "临床研究设计",
      "<span class='chapter-number'>25</span>  <span class='chapter-title'>随机对照试验</span>"
    ]
  },
  {
    "objectID": "RCT.html#盲法",
    "href": "RCT.html#盲法",
    "title": "\n25  随机对照试验\n",
    "section": "\n25.3 盲法",
    "text": "25.3 盲法\n\n\n\n\n\n25.3.1 开放试验\n盲法是RCT的基本原则之一，但并不是所有的研究都必须采用或均能实行。比如比较某种手术与某药物治疗肺癌的效果，就不必要，也没有条件实施盲法。在这种情况下，只能进行开放试验，即研究对象和研究者均知道试验组和对照组的分组情况，试验公开进行。\n在开放试验中，盲法无法实施，但是分组隐匿仍然可以实施。同时可以考虑对结局评价者、数据监察和统计分析人员设盲。其优点是易于设计和实施，研究者了解分组情况，便于对研究对象及时作出处理，其主要缺点是容易产生偏倚。\n\n25.3.2 单盲\n单盲试验（single-blinded）：单盲试验是仅研究者知道每个病人用药的具体内容，而病人不知道，单盲试验虽可以避免来自病人主观因素的偏倚，但仍未能防止来自研究者方面的影响。\n\n25.3.3 双盲\n双盲(double blinded)试验：单盲试验是仅研究者知道每个病人用药的具体内容，而病人不知道，单盲试验虽可以避免来自病人主观因素的偏倚，但仍未能防止来自研究者方面的影响。\n在双盲实施过程中，可能会出现一种情况：假设本研究中006号研究对象在研究过程中出现了严重的不良反应，要分析原因以便采取对策，此时必须揭盲。揭盲后研究实施者就知道了006号研究对象在使用乙药。但是，研究实施者在分组时已经知道006号研究对象为2组，揭盲后便知道了所有2组研究对象均在使用乙药，这会出现一人揭盲人人揭盲的情况。要避免这种情况，严格而规范的双盲试验不是给每个研究对象一个组别，按组别发药；而是给每个研究对象一个编码，按编码发药。盲底则由专人统一保管。\n要避免一人揭盲人人揭盲的情况，双盲的具体做法是:\n\n研究设计者在随机化分组时，对每个研究对象分配一个设盲编码。\n\n\n\nTable 25.2\n\nShow the coderaw_data %&gt;% \n    mutate(\n        blind_id = 1001:1100,\n        drug_id = 1001:1100,\n    ) -&gt;raw_data\nraw_data \n#&gt; # A tibble: 100 × 4\n#&gt;       id assign blind_id drug_id\n#&gt;    &lt;int&gt;  &lt;int&gt;    &lt;int&gt;   &lt;int&gt;\n#&gt;  1     1      3     1001    1001\n#&gt;  2     2      2     1002    1002\n#&gt;  3     3      2     1003    1003\n#&gt;  4     4      4     1004    1004\n#&gt;  5     5      1     1005    1005\n#&gt;  6     6      1     1006    1006\n#&gt;  7     7      2     1007    1007\n#&gt;  8     8      3     1008    1008\n#&gt;  9     9      2     1009    1009\n#&gt; 10    10      1     1010    1010\n#&gt; # ℹ 90 more rows\n\n# 给研究实施者提供\nraw_data %&gt;% select(contains(\"id\"))\n#&gt; # A tibble: 100 × 3\n#&gt;       id blind_id drug_id\n#&gt;    &lt;int&gt;    &lt;int&gt;   &lt;int&gt;\n#&gt;  1     1     1001    1001\n#&gt;  2     2     1002    1002\n#&gt;  3     3     1003    1003\n#&gt;  4     4     1004    1004\n#&gt;  5     5     1005    1005\n#&gt;  6     6     1006    1006\n#&gt;  7     7     1007    1007\n#&gt;  8     8     1008    1008\n#&gt;  9     9     1009    1009\n#&gt; 10    10     1010    1010\n#&gt; # ℹ 90 more rows\n\n\n\n\n\n同时，分发的药品包装上也有与设盲编码一一对应的编码。\n在随机化分组完成后，001号研究对象将分入3组，002号将分入2组。研究设计者在编码为1001的药品包装内分装C药，在编码为1002的药品包装内分装乙药。同时仅给研究实施者提供研究对象序号、设盲编码和标有设盲编码的药品 ( Table 25.2)。\n而盲底（ Table 25.1 ）则只有研究设计者知道，并由专人保管。此时，研究实施者按照顺序纳入研究对象后，仅给研究对象标有编码的药品即可。研究实施者和研究对象均不知道分组和用药情况。\n\n这样做的优点是：出现严重不良反应需要揭盲时，只需个别地揭盲，不容易泄密。但需要注意的是，必须建立与健全专项的药品保管、领用和发放制度；领发药品的各个环节都要认真核对编码，防止出错。实际上，如此执行，也做到了分组隐匿。\n需要注意的是，试验结束前盲底泄露或应急信件拆阅超过20%，双盲试验即告失败。\n\n25.3.4 三盲\n在双盲实施的时候，还有可能出现一种偏倚：数据监察和统计分析人员知道研究分组情况，可能会对数据有选择性的取舍，造成不真实的情况。如在双盲实施的过程中，对数据监察和统计分析人员也设盲，此为三盲。\n在研究实施过程中，将所有的临床试验数据输入数据库并经过核查，确证准确无误将数据锁定后，才进行第一次揭盲，即分出A、B两组，但哪一组是试验组、哪一组是对照组并不清楚。之后进行统计分析，待A组和B组分析数据出来后，再第二次揭盲，即明确A、B两组分别代表试验组还是对照组。\n盲法与前述分配隐匿的区别在于：分配隐匿主要控制一种选择偏倚，即控制研究实施者有倾向地选择研究对象进入试验组或对照组；而盲法除此之外，还能控制信息偏倚，即控制研究实施者、资料收集和数据分析者有倾向性的取舍研究结果。",
    "crumbs": [
      "临床研究设计",
      "<span class='chapter-number'>25</span>  <span class='chapter-title'>随机对照试验</span>"
    ]
  },
  {
    "objectID": "RCT.html#对照",
    "href": "RCT.html#对照",
    "title": "\n25  随机对照试验\n",
    "section": "\n25.4 对照",
    "text": "25.4 对照\n安慰剂（placebo）",
    "crumbs": [
      "临床研究设计",
      "<span class='chapter-number'>25</span>  <span class='chapter-title'>随机对照试验</span>"
    ]
  },
  {
    "objectID": "RCT.html#重复",
    "href": "RCT.html#重复",
    "title": "\n25  随机对照试验\n",
    "section": "\n25.5 重复",
    "text": "25.5 重复\n有一定的重复观察样本, 一项研究不允许有太多的受试者失访, 在选择研究样本时一定要特别注意。",
    "crumbs": [
      "临床研究设计",
      "<span class='chapter-number'>25</span>  <span class='chapter-title'>随机对照试验</span>"
    ]
  },
  {
    "objectID": "RCT.html#评价方法",
    "href": "RCT.html#评价方法",
    "title": "\n25  随机对照试验\n",
    "section": "\n25.6 评价方法",
    "text": "25.6 评价方法\nCochrane 偏倚风险评估工具包括 7 个方面：\n\n随机序列的产生(选择偏倚)；\n盲法分配(选择偏倚)；\n所有研究参与者和人员采用盲法(执行偏倚)；\n结果评估的盲法(观察偏倚)；\n结果数据的完整性(失访偏倚)；\n选择报道(报告偏倚)；\n其他。最后以文字、表格或图示方法显示对所有纳入文献的评价结果\n\nJadad 量表在临床试验的评价工作中简单易行，具有一定的科学性，得到了许多学者的认可， 发表了大量以 Jadad 量表作为评价工具的系统评价， 其中相当一部分文献集中在药物临床试验为主的研究， 在非开放式 RCT 评价中发挥了重要作用，得到了大多数学者的认可。 但是，随着人们对临床试验实施标准的不断修改完善，尤其是开放式非药物临床试验的RCT 研究在临床上广泛开展，Jadad 量表的评价标准有时不能完全客观、透明地反映出开放式 RCT 的研究质量，从而可能将质量较高的 RCT 误认为低质量 RCT。",
    "crumbs": [
      "临床研究设计",
      "<span class='chapter-number'>25</span>  <span class='chapter-title'>随机对照试验</span>"
    ]
  },
  {
    "objectID": "repeated_measures_anova.html",
    "href": "repeated_measures_anova.html",
    "title": "\n12  重复测量方差分析\n",
    "section": "",
    "text": "12.1 假设"
  },
  {
    "objectID": "repeated_measures_anova.html#假设",
    "href": "repeated_measures_anova.html#假设",
    "title": "\n12  重复测量方差分析\n",
    "section": "",
    "text": "独立性，即不同受试者之间的观测值是独立的。\n正态性，观测值在每个时间点或条件下的正态分布。\n各组内的方差齐性（sphericity），即组内相关性结构是已知的，通常假设为复合对称（compound symmetry）。协方差矩阵的球形检验（W=1）\n\n\n\n\n\n\n\nNote\n\n\n\n\n复合对称假设：RM-ANOVA假设误差项具有复合对称性，即组内相关性和方差齐性。如果复合对称假设不成立，结果可能不准确，可以使用更为灵活的线性混合模型（LMM）或广义估计方程（GEE）进行分析。\n检验方法：RM-ANOVA的主要检验方法包括F检验，用于检验组效应、时间效应和交互作用是否显著。"
  },
  {
    "objectID": "repeated_measures_anova.html#单因素重复测量方差分析",
    "href": "repeated_measures_anova.html#单因素重复测量方差分析",
    "title": "\n12  重复测量方差分析\n",
    "section": "\n12.2 单因素重复测量方差分析",
    "text": "12.2 单因素重复测量方差分析\n\n12.2.1 公式\n\\[\nSS_T=\\sum_{j=1}^{t}\\sum_{i=1}^{n}X_{ij}^2-\\frac{(\\sum_{j=1}^{t}\\sum_{i=1}^{n}X_{ij})^2}{nt}=SS_{受试者间}+SS_{不同时间点}+SS_{E\\ \\ 随机误差}，\\nu_T=nt-1\n\\]\n\\[\nSS_{受试者间}=\\frac{\\sum_{i}(\\sum_{j}X_{ij})^2}{t}-C，\\nu_{受试者}=n-1\n\\]反映了在受试者间的变异。\n\\[\nSS_{不同时间点}=\\frac{\\sum_{j}(\\sum_{i}X_{ij})^2}{n}-C ，\\nu_{时间点}=t-1\n\\]反映了在每个受试者内不同时间点的重复测量变异。\n\\[\nSS_E=SS_T-SS_{受试者间}-SS_{不同时间点}，\\nu_E=(n-1)(t-1)\n\\]\n\\(H_0:\\mu_1=\\mu_2=...=\\mu_t\\)，检验统计量\n\\[\nF=\\frac{MS_{不同时间点}}{MS_E}=\\frac{SS_{不同时间点}/(t-1)}{SS_E/((n-1)(t-1))}\n\\]\n\nShow the codeALT &lt;- tribble(\n    ~id,~zero,~ten,~twenty,~thirty,\n    1,186,122,134,110,\n    2,345,312,268,176,\n    3,98,84,52,61,\n    4,288,98,91,85,\n    5,176,86,130,99,\n    6,210,188,143,120,\n    7,271,322,86,65,\n    8,415,332,265,186,\n    9,171,126,130,135,\n    10,243,330,95,64,\n)\nALT_long &lt;-\n    ALT |&gt; pivot_longer(cols = -1,\n                       names_to = \"week\",\n                       values_to = \"ALT\") |&gt; \n    mutate(week = factor(week, levels = c(\"zero\",\"ten\", \"twenty\", \"thirty\")))\n\n\n# 假设检验\nALT_long %&gt;% \n    group_by(week) %&gt;% \n    rstatix::shapiro_test(ALT)\n#&gt; # A tibble: 4 × 4\n#&gt;   week   variable statistic      p\n#&gt;   &lt;fct&gt;  &lt;chr&gt;        &lt;dbl&gt;  &lt;dbl&gt;\n#&gt; 1 zero   ALT          0.972 0.906 \n#&gt; 2 ten    ALT          0.796 0.0131\n#&gt; 3 twenty ALT          0.834 0.0378\n#&gt; 4 thirty ALT          0.907 0.262\n\n\n\nShow the code# 总变异\nxij_sum &lt;- sum(ALT_long$ALT)\nxij_square_sum &lt;- sum(ALT_long$ALT^2)\nC &lt;- xij_sum^2/40\nSS_T &lt;- xij_square_sum-C\n\n# 受试者间  \nxi._sum &lt;- rowSums(ALT[,-1])\nxi._sum\n#&gt;  [1]  552 1101  295  562  491  661  744 1198  562  732\nSS_B &lt;- sum(xi._sum^2)/4-C #行和平方和\nMS_B &lt;- SS_B/9\n\n# 不同时间点\nx.j_sum &lt;- colSums(ALT[,-1])\nx.j_sum\n#&gt;   zero    ten twenty thirty \n#&gt;   2403   2000   1394   1101\nSS_W &lt;- sum(x.j_sum^2)/10-C #列和平方和\nMS_W &lt;- SS_W/3\n\n\n\nSS_E &lt;- SS_T-SS_B-SS_W\nMS_E &lt;- SS_E/(9*3)\n\nF_stat &lt;- MS_W/MS_E\nF_stat\n#&gt; [1] 11.13855\n\nv1 = 4-1\nv2 = (4-1)*(10-1)\n\npf(F_stat, df1 = v1, df2 = v2, lower.tail = F)\n#&gt; [1] 6.170758e-05\n\ncat(\"F统计量：\", F_stat, \"\\n\",\n    \"p值：\",pf(F_stat, df1 = v1, df2 = v2, lower.tail = F))\n#&gt; F统计量： 11.13855 \n#&gt;  p值： 6.170758e-05\n\n\n\n12.2.2 nlme::lme()\n\n\nShow the codelibrary(nlme)\nALT_lme &lt;- lme(fixed=ALT ~ week, random = ~1| id/week, data = ALT_long)\n\nALT_aov &lt;- anova.lme(ALT_lme)\nALT_aov \n#&gt;             numDF denDF  F-value p-value\n#&gt; (Intercept)     1    27 62.98194  &lt;.0001\n#&gt; week            3    27 11.13855   1e-04\nALT_aov$`p-value`\n#&gt; [1] 1.569667e-08 6.170758e-05\n\n\n事后检验\n\nShow the code#成对比较\nlibrary(emmeans)\nemmeans(ALT_lme, pairwise ~week, adjust = \"bonferroni\") \n#&gt; $emmeans\n#&gt;  week   emmean   SE df lower.CL upper.CL\n#&gt;  zero      240 26.5  9    180.3      300\n#&gt;  ten       200 26.5  9    140.0      260\n#&gt;  twenty    139 26.5  9     79.4      199\n#&gt;  thirty    110 26.5  9     50.1      170\n#&gt; \n#&gt; Degrees-of-freedom method: containment \n#&gt; Confidence level used: 0.95 \n#&gt; \n#&gt; $contrasts\n#&gt;  contrast        estimate   SE df t.ratio p.value\n#&gt;  zero - ten          40.3 24.9 27   1.620  0.7014\n#&gt;  zero - twenty      100.9 24.9 27   4.055  0.0023\n#&gt;  zero - thirty      130.2 24.9 27   5.233  0.0001\n#&gt;  ten - twenty        60.6 24.9 27   2.436  0.1305\n#&gt;  ten - thirty        89.9 24.9 27   3.613  0.0073\n#&gt;  twenty - thirty     29.3 24.9 27   1.178  1.0000\n#&gt; \n#&gt; Degrees-of-freedom method: containment \n#&gt; P value adjustment: bonferroni method for 6 tests\nemmeans(ALT_lme,  ~week) %&gt;% pairs(., adjust = \"bonferroni\")\n#&gt;  contrast        estimate   SE df t.ratio p.value\n#&gt;  zero - ten          40.3 24.9 27   1.620  0.7014\n#&gt;  zero - twenty      100.9 24.9 27   4.055  0.0023\n#&gt;  zero - thirty      130.2 24.9 27   5.233  0.0001\n#&gt;  ten - twenty        60.6 24.9 27   2.436  0.1305\n#&gt;  ten - thirty        89.9 24.9 27   3.613  0.0073\n#&gt;  twenty - thirty     29.3 24.9 27   1.178  1.0000\n#&gt; \n#&gt; Degrees-of-freedom method: containment \n#&gt; P value adjustment: bonferroni method for 6 tests\n\n\n\nShow the codelibrary(multcomp)\nALT_posthoc &lt;-glht(ALT_lme, linfct = mcp(week =c(\"zero - ten = 0 \",\n                                               \"twenty - zero == 0\",\n                                               \"thirty - zero = 0 \")))\nsummary(ALT_posthoc) %&gt;% broom::tidy()\n#&gt; # A tibble: 3 × 7\n#&gt;   term  contrast      null.value estimate std.error statistic adj.p.value\n#&gt;   &lt;chr&gt; &lt;chr&gt;              &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;       &lt;dbl&gt;\n#&gt; 1 week  zero - ten             0     40.3      24.9      1.62 0.248      \n#&gt; 2 week  twenty - zero          0   -101.       24.9     -4.06 0.000142   \n#&gt; 3 week  thirty - zero          0   -130.       24.9     -5.23 0.000000312"
  },
  {
    "objectID": "repeated_measures_anova.html#含组间因子的重复测量方差分析",
    "href": "repeated_measures_anova.html#含组间因子的重复测量方差分析",
    "title": "\n12  重复测量方差分析\n",
    "section": "\n12.3 含组间因子的重复测量方差分析",
    "text": "12.3 含组间因子的重复测量方差分析\n\n12.3.1 公式\n\\[\n\\begin{aligned}\nSS_总&= SS_{受试对象间}+SS_{受试对象内}  \\\\\n&=（SS_{处理方法}+SS_{个体间差异}）+（SS_{时间}+SS_{处理与时间交互}+SS_{个体内差异}）\n\\end{aligned}\n\\]\nhttps://personality-project.org/r/r.guide/r.anova.html#oneway\n\n12.3.2 案例\n孙振球（医学统计学第四版 人卫版，例12-3，P193）\n\nShow the code# 医学统计学 人卫版 第7版\nSBP &lt;- read_delim(\"data/麻醉诱导时相.txt\")\nSBP\n#&gt; # A tibble: 15 × 7\n#&gt;       id group    t0    t1    t2    t3    t4\n#&gt;    &lt;dbl&gt; &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;\n#&gt;  1     1 A       120   108   112   120   117\n#&gt;  2     2 A       118   109   115   126   123\n#&gt;  3     3 A       119   112   119   124   118\n#&gt;  4     4 A       121   112   119   126   120\n#&gt;  5     5 A       127   121   127   133   126\n#&gt;  6     6 B       121   120   118   131   137\n#&gt;  7     7 B       122   121   119   129   133\n#&gt;  8     8 B       128   129   126   135   142\n#&gt;  9     9 B       117   115   111   123   131\n#&gt; 10    10 B       118   114   116   123   133\n#&gt; 11    11 C       131   119   118   135   129\n#&gt; 12    12 C       129   128   121   148   132\n#&gt; 13    13 C       123   123   120   143   136\n#&gt; 14    14 C       123   121   116   145   126\n#&gt; 15    15 C       125   124   118   142   130\n\n\n\nShow the codeSBP_long &lt;- SBP |&gt; pivot_longer(cols = starts_with(\"t\"),\n                              names_to = \"time\",\n                              values_to = \"SBP\") |&gt; \n    mutate(\n        id=factor(id),\n        group=factor(group),\n        time=factor(time)\n    )\n\nSBP_long %&gt;% head()\n#&gt; # A tibble: 6 × 4\n#&gt;   id    group time    SBP\n#&gt;   &lt;fct&gt; &lt;fct&gt; &lt;fct&gt; &lt;dbl&gt;\n#&gt; 1 1     A     t0      120\n#&gt; 2 1     A     t1      108\n#&gt; 3 1     A     t2      112\n#&gt; 4 1     A     t3      120\n#&gt; 5 1     A     t4      117\n#&gt; 6 2     A     t0      118\n\n\n\nShow the code# 正态性检验\nlibrary(rstatix)\nSBP_long %&gt;% group_by(time,group) %&gt;% \n    shapiro_test(SBP)\n#&gt; # A tibble: 15 × 5\n#&gt;    group time  variable statistic     p\n#&gt;    &lt;fct&gt; &lt;fct&gt; &lt;chr&gt;        &lt;dbl&gt; &lt;dbl&gt;\n#&gt;  1 A     t0    SBP          0.836 0.154\n#&gt;  2 B     t0    SBP          0.916 0.503\n#&gt;  3 C     t0    SBP          0.867 0.254\n#&gt;  4 A     t1    SBP          0.834 0.148\n#&gt;  5 B     t1    SBP          0.913 0.485\n#&gt;  6 C     t1    SBP          0.978 0.921\n#&gt;  7 A     t2    SBP          0.940 0.666\n#&gt;  8 B     t2    SBP          0.969 0.869\n#&gt;  9 C     t2    SBP          0.953 0.758\n#&gt; 10 A     t3    SBP          0.937 0.647\n#&gt; 11 B     t3    SBP          0.902 0.421\n#&gt; 12 C     t3    SBP          0.941 0.672\n#&gt; 13 A     t4    SBP          0.943 0.687\n#&gt; 14 B     t4    SBP          0.892 0.367\n#&gt; 15 C     t4    SBP          0.984 0.955\n\n\n\n12.3.2.1 nlme::lme()\n\n\nShow the code# 第一种方法\nlibrary(nlme)\nSBP_lme &lt;- lme(SBP ~ group*time, random = ~ 1 |id/time, data = SBP_long)\n# summary(SBP_lme)\nanova(SBP_lme)\n#&gt;             numDF denDF   F-value p-value\n#&gt; (Intercept)     1    48 14649.223  &lt;.0001\n#&gt; group           2    12     5.783  0.0174\n#&gt; time            4    48   106.558  &lt;.0001\n#&gt; group:time      8    48    19.101  &lt;.0001\n# 看不到球形检验\n\n\n# 事后检验 成对比较\nlibrary(emmeans)\n# 如果交互效应不显著\n\n## 时间点事后检验\nSBP_long %&gt;%\n  pairwise_t_test(SBP ~ time, p.adjust.method = \"none\", detailed = TRUE)\n#&gt; # A tibble: 10 × 10\n#&gt;    .y.   group1 group2    n1    n2        p method   p.adj p.signif p.adj.signif\n#&gt;  * &lt;chr&gt; &lt;chr&gt;  &lt;chr&gt;  &lt;int&gt; &lt;int&gt;    &lt;dbl&gt; &lt;chr&gt;    &lt;dbl&gt; &lt;chr&gt;    &lt;chr&gt;       \n#&gt;  1 SBP   t0     t1        15    15  6.81e-2 T-test 6.81e-2 ns       ns          \n#&gt;  2 SBP   t0     t2        15    15  6.41e-2 T-test 6.41e-2 ns       ns          \n#&gt;  3 SBP   t1     t2        15    15  9.78e-1 T-test 9.78e-1 ns       ns          \n#&gt;  4 SBP   t0     t3        15    15  1.78e-4 T-test 1.78e-4 ***      ***         \n#&gt;  5 SBP   t1     t3        15    15  1.67e-7 T-test 1.67e-7 ****     ****        \n#&gt;  6 SBP   t2     t3        15    15  1.49e-7 T-test 1.49e-7 ****     ****        \n#&gt;  7 SBP   t0     t4        15    15  1.28e-2 T-test 1.28e-2 *        *           \n#&gt;  8 SBP   t1     t4        15    15  3.68e-5 T-test 3.68e-5 ****     ****        \n#&gt;  9 SBP   t2     t4        15    15  3.32e-5 T-test 3.32e-5 ****     ****        \n#&gt; 10 SBP   t3     t4        15    15  1.65e-1 T-test 1.65e-1 ns       ns\n\nemmeans(SBP_lme,pairwise ~time, adjust = \"none\")  \n#&gt; $emmeans\n#&gt;  time emmean   SE df lower.CL upper.CL\n#&gt;  t0      123 1.16 12      120      125\n#&gt;  t1      118 1.16 12      116      121\n#&gt;  t2      118 1.16 12      116      121\n#&gt;  t3      132 1.16 12      130      135\n#&gt;  t4      129 1.16 12      126      131\n#&gt; \n#&gt; Results are averaged over the levels of: group \n#&gt; Degrees-of-freedom method: containment \n#&gt; Confidence level used: 0.95 \n#&gt; \n#&gt; $contrasts\n#&gt;  contrast estimate    SE df t.ratio p.value\n#&gt;  t0 - t1    4.4000 0.855 48   5.147  &lt;.0001\n#&gt;  t0 - t2    4.4667 0.855 48   5.225  &lt;.0001\n#&gt;  t0 - t3   -9.4000 0.855 48 -10.995  &lt;.0001\n#&gt;  t0 - t4   -6.0667 0.855 48  -7.096  &lt;.0001\n#&gt;  t1 - t2    0.0667 0.855 48   0.078  0.9382\n#&gt;  t1 - t3  -13.8000 0.855 48 -16.142  &lt;.0001\n#&gt;  t1 - t4  -10.4667 0.855 48 -12.243  &lt;.0001\n#&gt;  t2 - t3  -13.8667 0.855 48 -16.220  &lt;.0001\n#&gt;  t2 - t4  -10.5333 0.855 48 -12.321  &lt;.0001\n#&gt;  t3 - t4    3.3333 0.855 48   3.899  0.0003\n#&gt; \n#&gt; Results are averaged over the levels of: group \n#&gt; Degrees-of-freedom method: containment\n\n## 组间事后检验\nemmeans(SBP_lme,pairwise ~group, adjust = \"none\")  # 与spss一样\n#&gt; $emmeans\n#&gt;  group emmean   SE df lower.CL upper.CL\n#&gt;  A        120 1.78 14      116      123\n#&gt;  B        124 1.78 12      121      128\n#&gt;  C        128 1.78 12      124      132\n#&gt; \n#&gt; Results are averaged over the levels of: time \n#&gt; Degrees-of-freedom method: containment \n#&gt; Confidence level used: 0.95 \n#&gt; \n#&gt; $contrasts\n#&gt;  contrast estimate   SE df t.ratio p.value\n#&gt;  A - B       -4.80 2.51 12  -1.911  0.0802\n#&gt;  A - C       -8.52 2.51 12  -3.392  0.0054\n#&gt;  B - C       -3.72 2.51 12  -1.481  0.1644\n#&gt; \n#&gt; Results are averaged over the levels of: time \n#&gt; Degrees-of-freedom method: containment\n\n# 此处交互效应显著\n# 1. 简单组别效应 与SPSS一样\nSBP_long %&gt;% group_by(time) %&gt;% anova_test(SBP~group)\n#&gt; # A tibble: 5 × 8\n#&gt;   time  Effect   DFn   DFd      F        p `p&lt;.05`   ges\n#&gt; * &lt;fct&gt; &lt;chr&gt;  &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;    &lt;dbl&gt; &lt;chr&gt;   &lt;dbl&gt;\n#&gt; 1 t0    group      2    12  2.93  0.092    \"\"      0.328\n#&gt; 2 t1    group      2    12  6.03  0.015    \"*\"     0.501\n#&gt; 3 t2    group      2    12  0.022 0.979    \"\"      0.004\n#&gt; 4 t3    group      2    12 17.0   0.000312 \"*\"     0.74 \n#&gt; 5 t4    group      2    12 17.4   0.000286 \"*\"     0.743\n\n# 2. 各时间点处理组成对比较  用的是未调整的p值，无法观察到标准误\nSBP_long %&gt;%\n  group_by(time) %&gt;%\n  pairwise_t_test(SBP ~ group, \n                  p.adjust.method = \"bonferroni\", detailed = TRUE)\n#&gt; # A tibble: 15 × 11\n#&gt;    time  .y.   group1 group2    n1    n2         p method    p.adj p.signif\n#&gt;  * &lt;fct&gt; &lt;chr&gt; &lt;chr&gt;  &lt;chr&gt;  &lt;int&gt; &lt;int&gt;     &lt;dbl&gt; &lt;chr&gt;     &lt;dbl&gt; &lt;chr&gt;   \n#&gt;  1 t0    SBP   A      B          5     5 0.936     T-test 1        ns      \n#&gt;  2 t0    SBP   A      C          5     5 0.0539    T-test 0.162    ns      \n#&gt;  3 t0    SBP   B      C          5     5 0.0623    T-test 0.187    ns      \n#&gt;  4 t1    SBP   A      B          5     5 0.0358    T-test 0.107    *       \n#&gt;  5 t1    SBP   A      C          5     5 0.00541   T-test 0.0162   **      \n#&gt;  6 t1    SBP   B      C          5     5 0.327     T-test 0.981    ns      \n#&gt;  7 t2    SBP   A      B          5     5 0.894     T-test 1        ns      \n#&gt;  8 t2    SBP   A      C          5     5 0.947     T-test 1        ns      \n#&gt;  9 t2    SBP   B      C          5     5 0.842     T-test 1        ns      \n#&gt; 10 t3    SBP   A      B          5     5 0.456     T-test 1        ns      \n#&gt; 11 t3    SBP   A      C          5     5 0.000161  T-test 0.000483 ***     \n#&gt; 12 t3    SBP   B      C          5     5 0.000585  T-test 0.00175  ***     \n#&gt; 13 t4    SBP   A      B          5     5 0.0000887 T-test 0.000266 ****    \n#&gt; 14 t4    SBP   A      C          5     5 0.00201   T-test 0.00602  **      \n#&gt; 15 t4    SBP   B      C          5     5 0.0901    T-test 0.27     ns      \n#&gt; # ℹ 1 more variable: p.adj.signif &lt;chr&gt;\n\n\n\n12.3.2.2 rstatix::anova_test() 看球形检验 W统计量\n\nShow the codelibrary(rstatix)\naov_SBP &lt;- anova_test(data = SBP_long,\n           dv = SBP,\n           wid = id,\n           within = time,\n           between = group,\n           type = \"3\"\n           )\n\naov_SBP\n#&gt; ANOVA Table (type III tests)\n#&gt; \n#&gt; $ANOVA\n#&gt;       Effect DFn DFd       F        p p&lt;.05   ges\n#&gt; 1      group   2  12   5.783 1.70e-02     * 0.430\n#&gt; 2       time   4  48 106.558 3.02e-23     * 0.659\n#&gt; 3 group:time   8  48  19.101 1.62e-12     * 0.409\n#&gt; \n#&gt; $`Mauchly's Test for Sphericity`\n#&gt;       Effect     W     p p&lt;.05\n#&gt; 1       time 0.293 0.178      \n#&gt; 2 group:time 0.293 0.178      \n#&gt; \n#&gt; $`Sphericity Corrections`\n#&gt;       Effect   GGe      DF[GG]    p[GG] p[GG]&lt;.05   HFe      DF[HF]    p[HF]\n#&gt; 1       time 0.679 2.71, 32.58 1.87e-16         * 0.896 3.59, 43.03 4.65e-21\n#&gt; 2 group:time 0.679 5.43, 32.58 4.26e-09         * 0.896 7.17, 43.03 2.04e-11\n#&gt;   p[HF]&lt;.05\n#&gt; 1         *\n#&gt; 2         *\n\n# 进行事后检验，若交互效应不显著\n\nSBP_long %&gt;%\n  group_by(time) %&gt;%\n  pairwise_t_test(SBP ~ group, p.adjust.method = \"bonferroni\", detailed = TRUE)\n#&gt; # A tibble: 15 × 11\n#&gt;    time  .y.   group1 group2    n1    n2         p method    p.adj p.signif\n#&gt;  * &lt;fct&gt; &lt;chr&gt; &lt;chr&gt;  &lt;chr&gt;  &lt;int&gt; &lt;int&gt;     &lt;dbl&gt; &lt;chr&gt;     &lt;dbl&gt; &lt;chr&gt;   \n#&gt;  1 t0    SBP   A      B          5     5 0.936     T-test 1        ns      \n#&gt;  2 t0    SBP   A      C          5     5 0.0539    T-test 0.162    ns      \n#&gt;  3 t0    SBP   B      C          5     5 0.0623    T-test 0.187    ns      \n#&gt;  4 t1    SBP   A      B          5     5 0.0358    T-test 0.107    *       \n#&gt;  5 t1    SBP   A      C          5     5 0.00541   T-test 0.0162   **      \n#&gt;  6 t1    SBP   B      C          5     5 0.327     T-test 0.981    ns      \n#&gt;  7 t2    SBP   A      B          5     5 0.894     T-test 1        ns      \n#&gt;  8 t2    SBP   A      C          5     5 0.947     T-test 1        ns      \n#&gt;  9 t2    SBP   B      C          5     5 0.842     T-test 1        ns      \n#&gt; 10 t3    SBP   A      B          5     5 0.456     T-test 1        ns      \n#&gt; 11 t3    SBP   A      C          5     5 0.000161  T-test 0.000483 ***     \n#&gt; 12 t3    SBP   B      C          5     5 0.000585  T-test 0.00175  ***     \n#&gt; 13 t4    SBP   A      B          5     5 0.0000887 T-test 0.000266 ****    \n#&gt; 14 t4    SBP   A      C          5     5 0.00201   T-test 0.00602  **      \n#&gt; 15 t4    SBP   B      C          5     5 0.0901    T-test 0.27     ns      \n#&gt; # ℹ 1 more variable: p.adj.signif &lt;chr&gt;\n\n\n\n12.3.2.3 afex::aov_*()看各时间点处理组成对比较和各处理组时间点成对比较\nhttps://cran.r-project.org/web/packages/afex/vignettes/afex_anova_example.html\n\nShow the codelibrary(\"afex\")     # needed for ANOVA functions.\nlibrary(\"emmeans\")  # emmeans must now be loaded explicitly for follow-up tests.\nlibrary(\"multcomp\") # for advanced control for multiple testing/Type 1 errors.\nlibrary(\"ggplot2\")  # for customizing plots.\n\n\n\nSBP_aovez &lt;- aov_ez(\"id\", \"SBP\", SBP_long, between =\"group\" , \n       within = c(\"time\"))\nSBP_aovez\n#&gt; Anova Table (Type 3 tests)\n#&gt; \n#&gt; Response: SBP\n#&gt;       Effect          df   MSE          F  ges p.value\n#&gt; 1      group       2, 12 78.87     5.78 * .430    .017\n#&gt; 2       time 2.71, 32.58  8.08 106.56 *** .659   &lt;.001\n#&gt; 3 group:time 5.43, 32.58  8.08  19.10 *** .409   &lt;.001\n#&gt; ---\n#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '+' 0.1 ' ' 1\n#&gt; \n#&gt; Sphericity correction method: GG\n\nSBP_aovez %&gt;% summary()\n#&gt; \n#&gt; Univariate Type III Repeated-Measures ANOVA Assuming Sphericity\n#&gt; \n#&gt;              Sum Sq num Df Error SS den Df    F value    Pr(&gt;F)    \n#&gt; (Intercept) 1155433      1   946.48     12 14649.2234 &lt; 2.2e-16 ***\n#&gt; group           912      2   946.48     12     5.7829   0.01743 *  \n#&gt; time           2336      4   263.12     48   106.5576 &lt; 2.2e-16 ***\n#&gt; group:time      838      8   263.12     48    19.1006 1.621e-12 ***\n#&gt; ---\n#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n#&gt; \n#&gt; \n#&gt; Mauchly Tests for Sphericity\n#&gt; \n#&gt;            Test statistic p-value\n#&gt; time              0.29307 0.17766\n#&gt; group:time        0.29307 0.17766\n#&gt; \n#&gt; \n#&gt; Greenhouse-Geisser and Huynh-Feldt Corrections\n#&gt;  for Departure from Sphericity\n#&gt; \n#&gt;             GG eps Pr(&gt;F[GG])    \n#&gt; time       0.67869  &lt; 2.2e-16 ***\n#&gt; group:time 0.67869  4.263e-09 ***\n#&gt; ---\n#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n#&gt; \n#&gt;              HF eps   Pr(&gt;F[HF])\n#&gt; time       0.896371 4.649080e-21\n#&gt; group:time 0.896371 2.041727e-11\n\n# aov_car(SBP ~ group + Error(id/time), data = SBP_long)\n# aov_4(SBP ~ group + (time|id), data = SBP_long)\n\n\n# 事后检验 不调整与SPSS一样\n\n## 看各时间点处理组成对比较\nemmeans::emmeans(SBP_aovez , pairwise ~ group|time, adjust = \"none\")\n#&gt; $emmeans\n#&gt; time = t0:\n#&gt;  group emmean   SE df lower.CL upper.CL\n#&gt;  A        121 1.72 12      117      125\n#&gt;  B        121 1.72 12      117      125\n#&gt;  C        126 1.72 12      122      130\n#&gt; \n#&gt; time = t1:\n#&gt;  group emmean   SE df lower.CL upper.CL\n#&gt;  A        112 2.21 12      108      117\n#&gt;  B        120 2.21 12      115      125\n#&gt;  C        123 2.21 12      118      128\n#&gt; \n#&gt; time = t2:\n#&gt;  group emmean   SE df lower.CL upper.CL\n#&gt;  A        118 2.08 12      114      123\n#&gt;  B        118 2.08 12      113      123\n#&gt;  C        119 2.08 12      114      123\n#&gt; \n#&gt; time = t3:\n#&gt;  group emmean   SE df lower.CL upper.CL\n#&gt;  A        126 2.20 12      121      131\n#&gt;  B        128 2.20 12      123      133\n#&gt;  C        143 2.20 12      138      147\n#&gt; \n#&gt; time = t4:\n#&gt;  group emmean   SE df lower.CL upper.CL\n#&gt;  A        121 1.76 12      117      125\n#&gt;  B        135 1.76 12      131      139\n#&gt;  C        131 1.76 12      127      134\n#&gt; \n#&gt; Confidence level used: 0.95 \n#&gt; \n#&gt; $contrasts\n#&gt; time = t0:\n#&gt;  contrast estimate   SE df t.ratio p.value\n#&gt;  A - B        -0.2 2.43 12  -0.082  0.9358\n#&gt;  A - C        -5.2 2.43 12  -2.137  0.0539\n#&gt;  B - C        -5.0 2.43 12  -2.055  0.0623\n#&gt; \n#&gt; time = t1:\n#&gt;  contrast estimate   SE df t.ratio p.value\n#&gt;  A - B        -7.4 3.13 12  -2.364  0.0358\n#&gt;  A - C       -10.6 3.13 12  -3.386  0.0054\n#&gt;  B - C        -3.2 3.13 12  -1.022  0.3269\n#&gt; \n#&gt; time = t2:\n#&gt;  contrast estimate   SE df t.ratio p.value\n#&gt;  A - B         0.4 2.95 12   0.136  0.8943\n#&gt;  A - C        -0.2 2.95 12  -0.068  0.9470\n#&gt;  B - C        -0.6 2.95 12  -0.204  0.8420\n#&gt; \n#&gt; time = t3:\n#&gt;  contrast estimate   SE df t.ratio p.value\n#&gt;  A - B        -2.4 3.11 12  -0.771  0.4557\n#&gt;  A - C       -16.8 3.11 12  -5.396  0.0002\n#&gt;  B - C       -14.4 3.11 12  -4.625  0.0006\n#&gt; \n#&gt; time = t4:\n#&gt;  contrast estimate   SE df t.ratio p.value\n#&gt;  A - B       -14.4 2.50 12  -5.771  0.0001\n#&gt;  A - C        -9.8 2.50 12  -3.927  0.0020\n#&gt;  B - C         4.6 2.50 12   1.843  0.0901\n\n## 看各处理组时间点成对比较\nemmeans::emmeans(SBP_aovez , pairwise ~ time| group, adjust = \"none\")\n#&gt; $emmeans\n#&gt; group = A:\n#&gt;  time emmean   SE df lower.CL upper.CL\n#&gt;  t0      121 1.72 12      117      125\n#&gt;  t1      112 2.21 12      108      117\n#&gt;  t2      118 2.08 12      114      123\n#&gt;  t3      126 2.20 12      121      131\n#&gt;  t4      121 1.76 12      117      125\n#&gt; \n#&gt; group = B:\n#&gt;  time emmean   SE df lower.CL upper.CL\n#&gt;  t0      121 1.72 12      117      125\n#&gt;  t1      120 2.21 12      115      125\n#&gt;  t2      118 2.08 12      113      123\n#&gt;  t3      128 2.20 12      123      133\n#&gt;  t4      135 1.76 12      131      139\n#&gt; \n#&gt; group = C:\n#&gt;  time emmean   SE df lower.CL upper.CL\n#&gt;  t0      126 1.72 12      122      130\n#&gt;  t1      123 2.21 12      118      128\n#&gt;  t2      119 2.08 12      114      123\n#&gt;  t3      143 2.20 12      138      147\n#&gt;  t4      131 1.76 12      127      134\n#&gt; \n#&gt; Confidence level used: 0.95 \n#&gt; \n#&gt; $contrasts\n#&gt; group = A:\n#&gt;  contrast estimate    SE df t.ratio p.value\n#&gt;  t0 - t1       8.6 1.490 12   5.772  0.0001\n#&gt;  t0 - t2       2.6 1.324 12   1.964  0.0732\n#&gt;  t0 - t3      -4.8 2.058 12  -2.333  0.0379\n#&gt;  t0 - t4       0.2 1.683 12   0.119  0.9074\n#&gt;  t1 - t2      -6.0 0.913 12  -6.573  &lt;.0001\n#&gt;  t1 - t3     -13.4 1.061 12 -12.624  &lt;.0001\n#&gt;  t1 - t4      -8.4 1.525 12  -5.507  0.0001\n#&gt;  t2 - t3      -7.4 1.461 12  -5.066  0.0003\n#&gt;  t2 - t4      -2.4 1.342 12  -1.789  0.0989\n#&gt;  t3 - t4       5.0 1.633 12   3.062  0.0099\n#&gt; \n#&gt; group = B:\n#&gt;  contrast estimate    SE df t.ratio p.value\n#&gt;  t0 - t1       1.4 1.490 12   0.940  0.3659\n#&gt;  t0 - t2       3.2 1.324 12   2.417  0.0325\n#&gt;  t0 - t3      -7.0 2.058 12  -3.402  0.0052\n#&gt;  t0 - t4     -14.0 1.683 12  -8.317  &lt;.0001\n#&gt;  t1 - t2       1.8 0.913 12   1.972  0.0721\n#&gt;  t1 - t3      -8.4 1.061 12  -7.914  &lt;.0001\n#&gt;  t1 - t4     -15.4 1.525 12 -10.096  &lt;.0001\n#&gt;  t2 - t3     -10.2 1.461 12  -6.983  &lt;.0001\n#&gt;  t2 - t4     -17.2 1.342 12 -12.820  &lt;.0001\n#&gt;  t3 - t4      -7.0 1.633 12  -4.287  0.0011\n#&gt; \n#&gt; group = C:\n#&gt;  contrast estimate    SE df t.ratio p.value\n#&gt;  t0 - t1       3.2 1.490 12   2.148  0.0529\n#&gt;  t0 - t2       7.6 1.324 12   5.740  0.0001\n#&gt;  t0 - t3     -16.4 2.058 12  -7.971  &lt;.0001\n#&gt;  t0 - t4      -4.4 1.683 12  -2.614  0.0226\n#&gt;  t1 - t2       4.4 0.913 12   4.820  0.0004\n#&gt;  t1 - t3     -19.6 1.061 12 -18.465  &lt;.0001\n#&gt;  t1 - t4      -7.6 1.525 12  -4.982  0.0003\n#&gt;  t2 - t3     -24.0 1.461 12 -16.432  &lt;.0001\n#&gt;  t2 - t4     -12.0 1.342 12  -8.944  &lt;.0001\n#&gt;  t3 - t4      12.0 1.633 12   7.348  &lt;.0001\n\n\n\n12.3.3 分部计算\n\\[\n\\begin{aligned}\nSS_总&= SS_{受试对象间}+SS_{受试对象内}  \\\\\n&=（SS_{处理方法}+SS_{个体间差异}）+（SS_{时间}+SS_{处理与时间交互}+SS_{个体内差异}）\n\\end{aligned}\n\\]\n\\[\n\\begin{aligned}\n\\nu_总&= \\nu_{受试对象间}+\\nu_{受试对象内}  \\\\\n&=（\\nu_{处理方法}+\\nu_{个体差异}）+（\\nu_{时间}+\\nu_{处理与时间交互}+\\nu_{个体差异}）\n\\end{aligned}\n\\]\n\n\n\n\n\n\n\n\n\n\n\nPage 86-87\n变异\nSS\nv\nMS\nF\nCP\n\n\n\n受试对象间\n处理\n912.24\n2\n456.12\n5.78\n0.0174\n\n\n\n个体差异\n946.48\n12\n78.87\n\n\n\n\n\n\n1858.72\n\n\n\n\n\n\n受试对象内\n时间\n2336.45\n4\n584.11\n106.56\n&lt;0.0001\n\n\n\n处理与时间交互\n837.63\n8\n104.70\n19.10\n&lt;0.0001\n\n\n\n个体差异\n263.12\n48\n5.48\n\n\n\n\n\n\n3437.2\n\n\n\n\n\n\n总\n\n5295.92\n3×15-1=74\n\n\n\n\n\n\n\n12.3.3.1 SS总\n\n\\[\nSS_总=\\sum_i^n{（X_i-\\bar X）^2}\n\\]\n其中，n是观测值的总数，Xi 为每个观测值，\\(\\bar X\\) 是所有观测值的均值。\n\nShow the code\nSBP_data &lt;- c(SBP$t0,SBP$t1,SBP$t2,SBP$t3,SBP$t4)\n\nSBP_mean &lt;- mean(SBP_data)\n\nSS_total &lt;- sum((SBP_data-SBP_mean)^2)\n\nSS_total    \n#&gt; [1] 5295.92\n\n\n\n12.3.3.2 SS受试对象间\n\n\\[\nSS_{受试对象间}=\\sum_{j=1}^m n_{.j}(\\bar X_{.j}-\\bar X)^2\n\\]\n其中，m是受试者数量（15），n.j 是第j 个受试对象的观测值数量，\\(\\bar X.j\\)是第j 个受试对象的观测值的均值，\\(\\bar X\\) 是所有观测值的均值。\n\nShow the codeid_mean &lt;- SBP |&gt; dplyr::select(c(-1,-2)) |&gt; rowMeans()\n\nSS_between &lt;- 0\nfor (i in 1:nrow(SBP)) {\n    SS_between &lt;- SS_between + 5*(id_mean[i]-SBP_mean)^2\n}\nSS_between\n#&gt; [1] 1858.72\n\n\n\nShow the codegroup__summary &lt;- SBP_long |&gt; group_by(group) |&gt; \n    summarise(n=n(),mean=mean(SBP),sum=sum(SBP))\ngroup__summary \n#&gt; # A tibble: 3 × 4\n#&gt;   group     n  mean   sum\n#&gt;   &lt;fct&gt; &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt;\n#&gt; 1 A        25  120.  2992\n#&gt; 2 B        25  124.  3112\n#&gt; 3 C        25  128.  3205\n\n\nSS处理\n\n\\[\nSS_{处理}= \\sum_i^k n_k (\\bar X_k - \\bar X)^2\n\\]\n其中，k为不同处理组的组数，nk 为第 k 处理组观测值的总数，\\(\\bar  X_k\\) 为第k 处理组观测值的均数，\\(\\bar X\\) 是所有观测值的均值。\n\nShow the codeSS_处理 &lt;- 25*( (group__summary$mean[1] - SBP_mean )^2 + \n                       (group__summary$mean[2] - SBP_mean )^2 +\n                       (group__summary$mean[3] - SBP_mean )^2) \nSS_处理\n#&gt; [1] 912.24\n\n\n\nShow the codeSS_between_error &lt;- SS_between-SS_处理\n\nSS_between_error\n#&gt; [1] 946.48\n\n\n\n12.3.3.3 SS受试对象内\n\n\\[\nSS_{受试对象内}=SS_总-SS_{受试对象间}\n\\]\n\nShow the codeSS_within &lt;- SS_total-SS_between\nSS_within\n#&gt; [1] 3437.2\n\n\nSS时间\n\n\\[\nSS_{时间}=\\sum _{t=1}^T n_t （\\bar X_{.t}-\\bar X）^2\n\\]\n其中，T是时间点的数量，nt 是在时间点t的观测值数量，\\bar X.t 是在时间点 t 的均值。\n\nShow the codet_mean &lt;- SBP |&gt; dplyr::select(c(-1,-2)) |&gt; colMeans()\n\nSS_time &lt;- 0\nfor (i in seq_along(t_mean)) {\n    \n    SS_time &lt;- SS_time + 15*(t_mean[i]-SBP_mean)^2\n    \n}\nnames(SS_time) &lt;- \"SS_time\"\nSS_time\n#&gt;  SS_time \n#&gt; 2336.453\n\n\nSS处理与时间交互\n\n\\[\nSS_{处理与时间交互}=\\sum_{i=1}^{k}\\sum_{j=1}^{T}n_{ij}\\left (\\bar X_{ij.} -\\bar X_{i..}-\\bar X_{.j.} + \\bar X_{...} \\right )^2\n\\]\n其中，\n\nk 是处理方法的数量，3\nT 是时间点的数量，5\nnij 是第 i 个处理方法和第 j 个时间点的观测次数，25/5=5\nXij . 是第 i 个处理方法、第 j 个时间点的观测值的平均值\nXi . . 是第 i 个处理方法观测值的平均值，不考虑时间点\nX. j . 是第 j 个时间点观测值的平均值，不考虑处理方法\nX. . . 是所有观测值的平均值，不考虑处理方法和时间点\n\n\nShow the codeinteraction_effect_summary &lt;- SBP_long |&gt;\n    summarise(\n        #n = n(),\n        mean = mean(SBP),\n       # sum = sum(SBP),\n        .by = c(group , time)\n    )\ninteraction_effect_mean &lt;- interaction_effect_summary |&gt; pivot_wider(names_from = c(\"time\"),values_from = \"mean\")\n\n\n\nSS_interaction_effect &lt;- 0\nfor (i in 1:3) {\n    for (j in 1:5) {\n        SS_interaction_effect &lt;- SS_interaction_effect + 5 * (interaction_effect_mean[i, j + 1] -group__summary$mean[i] - t_mean[j] + SBP_mean) ^ 2\n    }\n    \n}\nnames(SS_interaction_effect) &lt;- \"SS_interaction_effect\"\nSS_interaction_effect\n#&gt;   SS_interaction_effect\n#&gt; 1              837.6267\n\n\n\nShow the codeSS_within_error &lt;- SS_within-SS_time-SS_interaction_effect\n\nnames(SS_within_error) &lt;- \"SS_within_error\"\nSS_within_error \n#&gt;   SS_within_error\n#&gt; 1          263.12"
  },
  {
    "objectID": "repeated_measures_anova.html#球形度检验-sphericity",
    "href": "repeated_measures_anova.html#球形度检验-sphericity",
    "title": "\n12  重复测量方差分析\n",
    "section": "\n12.4 球形度检验 sphericity",
    "text": "12.4 球形度检验 sphericity\n重复测量方差分析假设相关条件（或组水平）的所有组合之间的差异方差相等。这被称为球形度假设。\nR中球形度检验\n球度仅针对具有两个以上水平的变量进行评估，因为球形度必然适用于只有两个水平的条件。\n违反球形度假设可能会扭曲方差计算，从而导致更宽松的重复测量方差分析检验（即 I 类错误率增加）。在这种情况下，必须根据违反球形度的程度适当校正重复测量方差分析。文献中使用了两种常见的校正：Greenhouse-Geisser epsilon （GGe） 和 Huynh-Feldt epsilon （HFe）。\n球形度的 Mauchly 检验用于评估是否满足球形度的假设。使用rstatix::anova_test() 时，会自动报告此问题。尽管该方法受到严厉批评，通常无法检测到小样本中的球形偏离，而在大样本中则过度检测到它们，但它仍然是一种常用的方法。\n\n12.4.1 计算步骤\n具体操作步骤如下：\n\n计算相关组的每个组合之间的差异\n计算每个组差的方差\n\n\n\n12.4.2 案例\n\n12.4.2.1 rstatix::anova_test()\n\n\nShow the code\naov_SBP &lt;- rstatix::anova_test(data = SBP_long,\n           dv = SBP,\n           wid = id,\n           within = time,\n           between = group\n           )\n\naov_SBP\n#&gt; ANOVA Table (type II tests)\n#&gt; \n#&gt; $ANOVA\n#&gt;       Effect DFn DFd       F        p p&lt;.05   ges\n#&gt; 1      group   2  12   5.783 1.70e-02     * 0.430\n#&gt; 2       time   4  48 106.558 3.02e-23     * 0.659\n#&gt; 3 group:time   8  48  19.101 1.62e-12     * 0.409\n#&gt; \n#&gt; $`Mauchly's Test for Sphericity`\n#&gt;       Effect     W     p p&lt;.05\n#&gt; 1       time 0.293 0.178      \n#&gt; 2 group:time 0.293 0.178      \n#&gt; \n#&gt; $`Sphericity Corrections`\n#&gt;       Effect   GGe      DF[GG]    p[GG] p[GG]&lt;.05   HFe      DF[HF]    p[HF]\n#&gt; 1       time 0.679 2.71, 32.58 1.87e-16         * 0.896 3.59, 43.03 4.65e-21\n#&gt; 2 group:time 0.679 5.43, 32.58 4.26e-09         * 0.896 7.17, 43.03 2.04e-11\n#&gt;   p[HF]&lt;.05\n#&gt; 1         *\n#&gt; 2         *\n\n\n输出是一个包含三个表的列表：\n\n方差分析结果显示标有（generalized eta squared，ges）的列上的 p 值和效应大小;效应大小本质上是由于受试者内因素而忽略受试者效应而导致的变异量。\nMauchly Sphericity检验。仅报告具有 &gt;2 水平的变量或效应，因为球形度必然适用于只有 2 个水平的效应。原假设是组差的方差相等。因此，显著的 p 值 （p &lt; 0.05） 表示组差的方差不相等。\n球度校正结果，以防我们无法维持球形度假设。提供了文献中使用的两种常见校正：Greenhouse-Geisser epsilon （GGe） 和 Huynh-Feldt epsilon （HFe） 及其相应的 p 值\n\n12.4.2.2 ez::ezANOVA()\n\n\nShow the codelibrary(ez)\n\n# 进行重复测量方差分析\naov_ez &lt;- ezANOVA(data = SBP_long,\n                   dv = SBP,\n                   wid = id,\n                   within = time,\n                   between = group,\n                   detailed = TRUE)\n\n# 查看球形检验结果\nprint(aov_ez)\n#&gt; $ANOVA\n#&gt;        Effect DFn DFd          SSn    SSd            F            p p&lt;.05\n#&gt; 1 (Intercept)   1  12 1155433.0800 946.48 14649.223396 6.784700e-20     *\n#&gt; 2       group   2  12     912.2400 946.48     5.782943 1.743351e-02     *\n#&gt; 3        time   4  48    2336.4533 263.12   106.557616 3.017101e-23     *\n#&gt; 4  group:time   8  48     837.6267 263.12    19.100638 1.621310e-12     *\n#&gt;         ges\n#&gt; 1 0.9989542\n#&gt; 2 0.4299287\n#&gt; 3 0.6588884\n#&gt; 4 0.4091519\n#&gt; \n#&gt; $`Mauchly's Test for Sphericity`\n#&gt;       Effect         W         p p&lt;.05\n#&gt; 3       time 0.2930746 0.1776608      \n#&gt; 4 group:time 0.2930746 0.1776608      \n#&gt; \n#&gt; $`Sphericity Corrections`\n#&gt;       Effect      GGe        p[GG] p[GG]&lt;.05      HFe        p[HF] p[HF]&lt;.05\n#&gt; 3       time 0.678693 1.867336e-16         * 0.896371 4.649080e-21         *\n#&gt; 4 group:time 0.678693 4.262529e-09         * 0.896371 2.041727e-11         *\n\n\n\n12.4.3 当满足球形度假设时\n\n球形度的 Mauchly 检验不显著 （p &gt; 0.05）;这表明，受试者内因素水平之间的差异方差是相等的。因此，我们可以假设协方差矩阵的球形度，并解释方差分析表中可用的标准输出。\n\nShow the code# Display ANOVA table\naov_SBP$ANOVA\n#&gt;       Effect DFn DFd       F        p p&lt;.05   ges\n#&gt; 1      group   2  12   5.783 1.70e-02     * 0.430\n#&gt; 2       time   4  48 106.558 3.02e-23     * 0.659\n#&gt; 3 group:time   8  48  19.101 1.62e-12     * 0.409\n\n\n\nF表示我们正在与 F 分布（F 检验）进行比较; 分别表示 time 和 Error（time） 的自由度; 表示得到的 F 统计量值(2, 18)81.8\np指定 p 值\nges（广义 eta 平方，etaov_SBP[g]）是效应大小（由于受试者内因素引起的变异量）\n\n12.4.4 当违反球形度假设时\n\n如果数据违反了球形度假设（即 Mauchly 检验，p &lt;= 0.05），则应解释表sphericity corrections中的结果，其中对自由度进行了调整，这会影响检验的统计显著性（即 p 值）。校正通过乘法和校正估计值（Greenhouse-Geisser （GG） 和 Huynh-Feldt （HF） ε 值）来应用。\n\n\n\n\n\n\nNote\n\n\n\nepsilon 提供了球形度被侵犯的程度的度量。值为 1 表示不偏离球形度（组差的所有方差均相等）。违反球形度会导致 epsilon 值低于 1。epsilon 离 1 越远，违规越严重。\n\n\n可以看出，即使在球形度校正（p[GG] &lt; 0.001，p[HF] &lt; 0.001）之后，平均自尊得分在不同时间点仍存在统计学差异。\n在两种球形度校正方法中，Huynh-Feldt 校正被认为是最不保守的（高估了 epsilon），而 Greenhouse-Geisser 被认为是更保守的（当 epsilon 接近 1 时低估了 epsilon）。\n一般建议使用 Greenhouse-Geisser 校正，特别是当 epsilon &lt; 0.75 时。在 epsilon 大于 0.75 的情况下，一些统计学家建议使用 Huynh-Feldt 校正 （Girden 1992）。"
  }
]